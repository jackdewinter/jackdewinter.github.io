<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I continued working on some big-ticket items from the issues list, making the most of my New Year Holiday break. Back in “normal time”, I am tackling Block Quote items, to try to get to the prioritized part of my issues list within the next …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Delving Into the Issues - 17 "/>
<meta property="og:url" content="https://jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/" />
<meta property="og:description" content="Summary¶ In my last article, I continued working on some big-ticket items from the issues list, making the most of my New Year Holiday break. Back in “normal time”, I am tackling Block Quote items, to try to get to the prioritized part of my issues list within the next …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2021-01-18T00:00:00-08:00" />
<meta name="twitter:title" content="Markdown Linter - Delving Into the Issues - 17 ">
<meta name="twitter:description" content="Summary¶ In my last article, I continued working on some big-ticket items from the issues list, making the most of my New Year Holiday break. Back in “normal time”, I am tackling Block Quote items, to try to get to the prioritized part of my issues list within the next …">

        <title>Markdown Linter - Delving Into the Issues - 17  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/">
                Markdown Linter - Delving Into the Issues - 17
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#starting-with-something-simple">Starting with Something Simple</a></li>
<li><a href="#rounding-out-multiline-inline-elements">Rounding Out Multiline Inline Elements</a></li>
<li><a href="#adding-glob-support">Adding Glob Support</a></li>
<li><a href="#filling-out-existing-tests">Filling Out Existing Tests</a></li>
<li><a href="#properly-handling-link-reference-definitions">Properly Handling Link Reference Definitions</a><ul>
<li><a href="#setting-the-stage">Setting the Stage</a></li>
<li><a href="#working-through-the-process">Working Through the Process</a></li>
<li><a href="#fixing-the-issue">Fixing the Issue</a></li>
</ul>
</li>
<li><a href="#squeezing-one-more-task-in">Squeezing One More Task In</a><ul>
<li><a href="#regrouping">Regrouping</a></li>
<li><a href="#fixing-the-issue_1">Fixing The Issue</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2021/01/11/markdown-linter-delving-into-the-issues-16/">last article</a>,
I continued working on some big-ticket items from the issues list, making the most
of my New Year Holiday break.  Back in “normal time”, I am tackling Block Quote items,
to try to get to the prioritized part of my issues list within the next week or two.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>While I knew that I was not going to solve the same volume of items as last week, I was
confident that I could use this week to make some good
progress in dealing with Block Quote elements and their interaction with other elements.
I also knew that my mental space was going to be limited this week due to the end of
the holidays.  I was not the only one that took the time off from my day job, as most of
the company that I work for took the same two weeks off.  And with everyone coming back to
work at the same time, there were bound to be lots of meetings to make sure everyone was
resynced for the New Year. And that week there… were… lots… of… meetings.</p>
<p>Factoring that into account, I started my work for that week with a reset of my personal
expectations on what I believe I can accomplish in a week. I felt that it was important to
my sanity to take the time to seriously understand that I did not need to continue taking
care of multiple big-ticket items. Just a handful of normal items would suffice.  I knew
that if I could manage to make the
switch to that mindset, it would be a good week.  So, with that in mind, the work started.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/a6390d02a8dc98e2092e0494f31f5f0a1fd3b5ba">07 Jan 2021</a>
and
<a href="https://github.com/jackdewinter/pymarkdown/commit/8b0e5abc8ba7996ed35387c44914e3696b068885">11 Jan 2021</a>.</p>
<h2 id="starting-with-something-simple">Starting with Something Simple<a class="headerlink" href="#starting-with-something-simple" title="Permanent link">¶</a></h2>
<p>As a matter of pride, I try and keep the PyMarkdown code base clean and following
<a href="https://flake8.pycqa.org/en/latest/">flake8</a> and
<a href="https://pylint.org/">pylint</a>
guidelines.  While I mostly correct any raised issues right away, I often choose to
temporarily disable these issues until another time where I can resolve them. My logic
in making that decision is that it usually better for me to concentrate on the big picture
in the moment, addressing any raised issues when I have some less hectic bursts time.
As such, at various points in the code base, there are comments such as:</p>
<div class="highlight"><pre><span></span><span class="c1"># pylint: disable=too-many-public-methods</span>
</pre></div>
<p>to disable a warning and:</p>
<div class="highlight"><pre><span></span><span class="c1"># pylint: enable=too-many-public-methods</span>
</pre></div>
<p>to enable the warning again.</p>
<p>But as I am only human, I sometimes forget to balance these statements out, disabling a
warning that
is only disabled, not enabling a warning that was disabled, or enabling a warning that was
not disabled.  Writing up a simple Python script, I quickly figured out where these issues
were and corrected them.  While it was not a very important thing to do, it was just nice
to ensure that I had these nailed down.  A good start to the week.</p>
<h2 id="rounding-out-multiline-inline-elements">Rounding Out Multiline Inline Elements<a class="headerlink" href="#rounding-out-multiline-inline-elements" title="Permanent link">¶</a></h2>
<p>One thing that I was sure that I had not covered properly were newline characters
contained with
Code Span elements and Raw HTML elements.  While I had corrected a handful of issues from
this area in the past, I did not feel that I had properly covered all the necessary cases,
and I wanted to address that discrepancy.</p>
<p>Like I normally do, I started with scenario test creation.  This began by taking
a good look at the available scenario tests in the <code>test_markdown_raw_html.py</code> module and
the
<code>test_markdown_code_spans.py</code> module.  For the first module, I added variations of test
function <code>test_raw_html_634</code>, focusing on any container block elements
or leaf block elements that I had not covered elsewhere.  I then repeated this process
for the other module by adding variations on the <code>test_code_spans_346</code> test function.
This resulted in eleven new scenario tests being added, four for the Raw Html element and
seven for the Code Span element.</p>
<p>From a top-level point of view, the scenario tests for Raw HTML elements worked fine, and
did not reveal
any additional issues.  The Code Span element tests were another matter.  While I had
previously dealt with newline characters in the main body of the Code Span element, I had
forgotten to perform the same actions on the leading and trailing whitespace for the
element.  Feeling embarrassed that I forgot the whitespace parts of the token, I quickly
made changes to the <code>handle_inline_backtick</code> function and the <code>__collect_text_from_blocks</code>
function to ensure that the correct tokens were being generated.</p>
<p>To balance these changes out, I also changed the <code>__verify_next_inline_code_span</code> function
in the consistency checks to pay attention to the leading and trailing whitespace.  Like
the changes detailed in the last paragraph, these changes were not difficult once I knew
what the problem was.  But looking at the code while I was making these changes, I realized
that I should not feel embarrassed.  While I was being thorough with my testing, the issues
that I was finding were more corner cases than anything else.  Put bluntly, unless I was
testing corner cases, I was sure that I would not create a Raw Html element like:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">a</span><span class="o">&gt;&lt;</span><span class="n">b</span> <span class="n">href</span><span class="o">=</span><span class="ss">""</span>
<span class="o">&gt;&lt;</span><span class="k">c</span><span class="o">&gt;</span>
</pre></div>
<p>or a Code Span element like:</p>
<div class="highlight"><pre><span></span><span class="n">This</span> <span class="k">is</span> <span class="k">some</span> <span class="o">`</span>
<span class="n">really</span> <span class="n">nasty</span>
<span class="o">`</span> <span class="n">code</span><span class="p">.</span>
</pre></div>
<p>Unless some specific formatting called for it in a really weird circumstance, I believe I
would always write them on one line, not multiple lines.</p>
<p>But it was good to get the corner cases.  In my head, I know that if I am focusing on the
corner cases, I feel confident about the normal cases.  That is a good place for me to be!</p>
<h2 id="adding-glob-support">Adding Glob Support<a class="headerlink" href="#adding-glob-support" title="Permanent link">¶</a></h2>
<p>While not a part of the issues list, one of the things that I had been experimenting on
in some “down time” was adding
<a href="https://docs.python.org/3/library/glob.html">Glob support</a>
to the project.  This work came about as the quick script that I threw together for
validating
<a href="https://jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/#starting-with-something-simple">PyLint disables and enables</a>
needed to be able to specify a targetted set of files with Python <code>glob</code> support. Using
the same type of mainline base as the PyMarkdown project,
I figured the PyLint scanner script was a low-cost, low-risk place to see how much
effort it would take to implement it in the PyMarkdown project.</p>
<p>It turned out to be very easy.  The <code>__determine_files_to_scan</code> function was the main
point of contact for determining the files to process.  It took exact file paths,
to either a directory or a file, and returned set containing all valid paths.  In the
case of a file path, it simply added the full path to that file to the collection to be
returned.  In the case of a directory, the directory was scanned, and all matching files
were added to that same collection.  Nice, self-contained, and simple.</p>
<p>Being self-contained, it was easy to modify this function to add glob support.  To handle
those simple cases, I moved that functionality out of the main function and into a new
helper function <code>__process_next_path</code>.  With that extracted, I rewrote the
<code>__determine_files_to_scan</code> function as follows.</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="s2">"*"</span> <span class="ow">in</span> <span class="n">next_path</span> <span class="ow">or</span> <span class="s2">"?"</span> <span class="ow">in</span> <span class="n">next_path</span><span class="p">:</span>
        <span class="n">globbed_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">next_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">globbed_paths</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s2">"Provided glob path '"</span>
                <span class="o">+</span> <span class="n">next_path</span>
                <span class="o">+</span> <span class="s2">"' did not match any files."</span><span class="p">,</span>
                <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">did_error_scanning_files</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
        <span class="k">for</span> <span class="n">next_globbed_path</span> <span class="ow">in</span> <span class="n">globbed_paths</span><span class="p">:</span>
            <span class="n">next_globbed_path</span> <span class="o">=</span> <span class="n">next_globbed_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__process_next_path</span><span class="p">(</span><span class="n">next_globbed_path</span><span class="p">,</span> <span class="n">files_to_parse</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_next_path</span><span class="p">(</span><span class="n">next_path</span><span class="p">,</span> <span class="n">files_to_parse</span><span class="p">):</span>
            <span class="n">did_error_scanning_files</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
</pre></div>
<p>As the call <code>glob.glob</code> already returns an array of matching elements, I was already
most of the way to having this implemented. All I needed to do was to properly add the
elements returned from the <code>glob</code> call to the collection.  So, instead of rewriting the
code to add matching elements to the <code>files_to_parse</code> variable, I just called the already
debugged <code>__process_next_path</code> function to do all the heavy lifting.</p>
<p>Once that was done, manual testing of the new functionality went fine.  Some new scenario
tests needed to be added, and a couple of existing scenario tests needed to be changed
slightly, but nothing unexpected.  After an hour or so, the work was done and tested.
While not terribly exciting, I could now do some manual testing of the PyMarkdown project
against a set of files that was not a single file, nor every eligible file in that
directory.  And it just felt good to get a small task like that out of the way!</p>
<h2 id="filling-out-existing-tests">Filling Out Existing Tests<a class="headerlink" href="#filling-out-existing-tests" title="Permanent link">¶</a></h2>
<p>Narrowing down the items to work on from the issues list, the one that I settled on was:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">test_block_quotes_extra_02a</span> <span class="k">with</span> <span class="n">extra</span> <span class="n">levels</span> <span class="k">of</span> <span class="n">lists</span><span class="o">?</span>
</pre></div>
<p>To start the work on this item, I added three variations of the
<code>test_block_quotes_extra_02</code> test function, altering the number of lists in the document
and their locations.  Noticing that I could do the same type
of variations for Block Quote elements, I also added ten new scenario test functions
that were variation on the <code>test_block_quotes_extra_04</code> function, mixing Block Quote
elements with the various types of non-inline elements.</p>
<p>Executing the bulk of the new tests, I was pleasantly surprised that everything except for
the consistency checks were passing without any changes being needed.  Even the changes
needed for the consistency checks were relatively minor and in two main groups.</p>
<p>The first group of changes were in the inline handling part of the
<code>verify_line_and_column_numbers</code> function.  These changes were not material in nature
but served to ensure that the <code>leading_text_index</code> field from the Block Quote token
was properly updated.  This required the inspection of each inline token to determine if
any newline characters are encountered.  If any are encountered, the <code>leading_text_index</code>
field is incremented by the number of newline characters, ensuring that any references
to that field reference the correct line prefix.</p>
<p>Seemingly balancing that change, there were a handful of end Leaf tokens that also needed
adjusting to properly support the
<code>leading_text_index</code> field.  Through trial and error, I quickly
isolated each type of token, and was able to properly increment the
<code>leading_text_index</code> field to handle the end token.  It was not a big task, but it was one
that I needed to be very methodical on.  I did find that I needed to do adjust each at
least once as each test was providing coverage for a specific scenario that had been
missed.  While it was not that much extra work for each individual test, the amount of work
required over all the tests added up quickly.</p>
<h2 id="properly-handling-link-reference-definitions">Properly Handling Link Reference Definitions<a class="headerlink" href="#properly-handling-link-reference-definitions" title="Permanent link">¶</a></h2>
<p>In the case of test function <code>test_block_quotes_extra_04f</code>, the issue was that it
was just broken.  No niceties or anything else, just broken.  Added during the
last section’s work and disabled, the Markdown was:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> [
<span class="o">&gt;</span> <span class="nv">abc</span>
<span class="o">&gt;</span> ]<span class="ss">(</span><span class="o">/</span><span class="nv">uri</span><span class="ss">)</span>
<span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="k">end</span>
</pre></div>
<p>What made this test function broken was not the Markdown itself, but the generated tokens
for it.  For whatever reason, the parsing of the Block Quote was both started and ended
on the first line, only to be restarted on the second line.  Because of the container
nature of the Block Quote element, this then spread the text required for the Inline Link
element split over two distinct Block Quotes.  It was just wrong!</p>
<h3 id="setting-the-stage">Setting the Stage<a class="headerlink" href="#setting-the-stage" title="Permanent link">¶</a></h3>
<p>The debugging took a couple of hours to work through, but it was rewarding when I solved
it.  The problem with the parsing boiled down to my favorite element (heavy sarcasm
is implied), the Link Reference Definition element.  Because of the unique nature of this
element and how it is parsed, I had to add the ability to rewind or requeue the parser so
that failed lines from a Link Reference Definition could be properly processed.  And while
it had worked properly until this point, test function <code>test_block_quotes_extra_04f</code>
provided an interesting twist to normal operation, and therefore, an interesting problem.  </p>
<p>Because of design decisions for Markdown, the Link element and the Link Reference
Definition element both start with the same sequence: <code>[link]</code>.  If this sequence is
followed by an
open square bracket character <code>[</code>, then it probably specifies a collapsed or full link.
If this sequence is followed by an open parenthesis character <code>(</code>, then it probably
specifies an inline link.  If this sequence is followed by a colon character <code>:</code>, then it
probably specifies a Link Reference Definition.  And finally, if not followed by any of
the above, it is probably a shortcut link.</p>
<p>Most of those combinations do not matter, except for my friend (once again, heavy sarcasm
implied), the Link Reference Definition.  While the Link element and its types are all
processed in the inline phase of processing, the Link Reference Definition is processed
much earlier in the block phase of processing.  Due to that difference, the Link element
processing is done with the entire contents of the processed Text token being available,
but the Link Reference Definition processing is done one line at a time.</p>
<h3 id="working-through-the-process">Working Through the Process<a class="headerlink" href="#working-through-the-process" title="Permanent link">¶</a></h3>
<p>Why was that information relevant?  In the case of the above Markdown, the specified text
supports both
a Link element and a Link Reference Definition element until line 3.  Before that point,
the Link Reference Definition processing continues forward.  When that point is reached on
line 3, the line is processed for
suitability as a Link Reference Definition, it fails, and the requeue mechanism needs to
be enacted so that the lines can be interpreted properly.  Unlike any previous scenario
tests, in this case, that requeue mechanism was not sufficient.</p>
<p>What was being requeued was only the information after processing.  When the requeue
mechanism kicked in, it was trying to return to the state that was in place when
the Link Reference Definition started.  But when it started processing the requeued
information, it did so with the processed line of information.  That line was missing the
Block Quote prefix, causing the Block Quote to be closed.  It took a while to get there,
but I did figure out why that was happening with the closing of the Block Quote!</p>
<h3 id="fixing-the-issue">Fixing the Issue<a class="headerlink" href="#fixing-the-issue" title="Permanent link">¶</a></h3>
<p>In this case, the line that had been passed to the Link Reference Definition processor
did not have the Block Quote prefix attached to it.  Having been removed at the container
level before being passed on for Leaf Block processing, the lines to requeue were
missing information.  To fix that issue, I had to figure out a way to ensure that I could
retain that information so that it could be requeued if needed.  Therefore, I introduced a
the <code>unmodified_line_to_parse</code> variable that contains the line as read, unmodified by
any processing.</p>
<p>This got me a lot of mileage in fixing this issue, but after rerunning some of the tests,
a couple of the tests were failing because there was another issue somewhere.  Debugging
that issue over the course of
an hour, I found that there was another requeue issue that I needed to address: the
main document and the main token stack.  In a couple of the new scenarios, when the
processing of the Link Reference Definition was started, another type of block element was
ended.  The effect of this was that a new Markdown token was placed in the document and a
new stack token was placed on the main token stack.  While the rewinding took care of the
data, it did not take care of that state information.</p>
<p>Dealing with that issue was somewhat simple but took a while to get right.  Before
starting the processing of the Link Reference Definition, I keep track of the lengths
of both the main document and the token stack.  If I need to requeue elements, I simply
remove any entries that are past that mark.  It is not very graceful, but it was
successful and worked wonderfully.</p>
<h2 id="squeezing-one-more-task-in">Squeezing One More Task In<a class="headerlink" href="#squeezing-one-more-task-in" title="Permanent link">¶</a></h2>
<p>If things are going normally, I organize and write my articles on Sunday, with the
editing the draft article going into Monday evening.  During that time, I do take a
fair number of breaks to ensure that I am writing and editting with a clear mind.
But just because I start
working on the article, it does not mean that I stop thinking about whatever it is I was
working on.  Usually, it is a battle between getting the writing done and my urge to
complete what I started.  Most of the time, the article wins. In this case, it did not.</p>
<p>On Saturday morning, I had started working on figuring out
how to get test function <code>test_block_quotes_extra_03b</code> working.  And while I had made some
progress on it, I was still working on it.  For whatever reason, when placed within a
Block Quote element, Link Reference Definitions were not being recognized properly. I had
started working on this right after fixing test function <code>test_block_quotes_extra_04f</code>
and  I had spent a decent amount of time trying to get it working. But with a busy weekend
in my personal life, I was not able to get a good, solid, contiguous couple of hours to
work on this
issue as I had hoped to do.  As such, I had started to try to figure out this issue about
five times and gave up after each short try.  It gnawed at me that I could not figure it
out.  It had not taken me long to resolve the previous set of issues, why was it
taking me so long with this one?</p>
<h3 id="regrouping">Regrouping<a class="headerlink" href="#regrouping" title="Permanent link">¶</a></h3>
<p>After completing the bulk of the rough draft of the article, I took some time to relax
and clear my head, knowing that I needed to look at the problem again.</p>
<p>This time, I had a lot better results with my debugging.  Starting with the basics,
I turned on debug logging for the test and followed along in the source code as I read each
line of the debug output.  It was then that I noticed the issue: the Block Quote token
itself was wrong.  As I looked through the logs, everything was fine up until the requeue
from the Link Reference Definition happened.  From there, everything was just off.</p>
<p>Taking some time to think about it, I decided to take our dog Bruce for a walk.  During
that walk, I tried hard not to think about the issue, and mostly succeeded.  When I came
back, I was able to examine the log files again, knowing that the Block Quote token was
off, and that I had to find the cause.  Within five minutes, I had the answer.  It was
once again a state issue.  Before the requeue happened, as each line was being processed
within a Block Quote, new information was added to the Block Quote token.  This information
was about the leading text that was removed from each line in the container processor,
ensuring that the leaf processor only had to deal with leaf block related issues.  To
ensure that the Markdown could be properly rehydrated, this information was stored in the
Block Quote token itself.  But when the requeue happened, nothing was done to erase the
information added to the token between the start of the Link Reference Definition parsing
and the start of the requeue.  Or at least that is what I thought had happened.</p>
<p>Doing some quick testing, I quickly proved my theory to be correct.  As I followed
along in the logs for the test function, I saw the amount of leading text in the Block
Quote token increase, but never decrease.  To further prove that I was on the right track,
I compared the number of lines that were requeued to the number of extra lines of leading
text present in the token, and it was a match!</p>
<h3 id="fixing-the-issue_1">Fixing The Issue<a class="headerlink" href="#fixing-the-issue_1" title="Permanent link">¶</a></h3>
<p>With a solid lead on what the cause was, the most concrete manner of proving that I had
the right cause to fix it.  After mulling around various ideas in my head, the one that
won out was to simply store a copy of the Block Quote token in the Link Reference
Definition token at the start of processing.  With the other requeue logic in place,
once I had done all the other requeuing, I simply replaced the changed Block Quote token
with the copy of the original token.  Running through the tests, this worked right away!</p>
<p>After having taken such a long way to get there, I now had it fixed.  But since I had
ended up solving the issue somewhat late on Sunday evening, I decided to put the changed
code
aside and to continue edit that week’s article.  It was enough to knowing that I had
solved it and that it just needed cleaning up before committing.  It was then after I
had completed my final edit of the article on Monday night that I noticed that I had
finished early on Monday night with a lot of time to spare.  With that extra time in hand,
I was able to take the roughly finished solution and polish it up enough to commit it.
While technically it should be a part of next week’s article, it just felt right to
include it with this article, as that is where most of the work occurred.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>After a busy week of getting rid of some big-ticket issues, it was very nice to
reduce my scope and focus on the smaller items.  Not that I mind working on the big
items, it is just that they require me to maintain a larger scope of focus, thereby
tiring me out a bit more.  The smaller items are not always as satisfying to resolve,
but they are also not as draining.</p>
<p>During the article, I mentioned that I was becoming more aware that I was dealing more
with corner cases than anything else, and that was a good feeling.  I am very confident
that any of the main scenarios driving the parser have already been addressed. With those
out of the way, it stands to reason that any issues that I am finding are the weird cases
that do not occur that often.  It just makes sense to me.</p>
<p>It also means that I am getting more confident that I am nearing the end of this testing
phase of the PyMarkdown project.  My main drive for the project was to complete the project
on my own terms, with the level of quality and testing that I expect from other projects.
While I could have started releasing this project a while ago, I wanted to make sure that
I have reached that level before I ship the project, and work on improving it from there.
And with the knowledge that I am cleaning up corner cases, I know that I now closer to
that point with the PyMarkdown project than I have ever been before!</p>
<p>And it is a good feeling!</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>I do not want to sound like a broken record, but it is back to the same process of
finding the next item to work on, and getting it resolved.  The only difference was
that I was getting close to eliminating all the “open range” items in favor of the
prioritized issues.  Progress!</p>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Delving%20Into%20the%20Issues%20-%2017&url=https%3A//jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Delving%20Into%20the%20Issues%20-%2017&amp;body=https%3A//jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-delving-into-the-issues-17"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2021/01/11/markdown-linter-delving-into-the-issues-16/" title="Previous: Markdown Linter - Delving Into the Issues - 16">Markdown Linter - Delving Into the Issues - 16</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2021/01/25/markdown-linter-delving-into-the-issues-18/" title="Next: Markdown Linter - Delving Into the Issues - 18">Markdown Linter - Delving Into the Issues - 18</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~16 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2021-01-18T00:00:00-08:00">Jan 18, 2021</time>
        <h4>Markdown Linter Issues</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/09/28/markdown-linter-delving-into-the-issues-1/" title="Markdown Linter - Delving Into the Issues - 1">Part 1: Markdown Linter - Delving Into the Issues - 1</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/" title="Markdown Linter - Delving Into the Issues - 2">Part 2: Markdown Linter - Delving Into the Issues - 2</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/12/markdown-linter-delving-into-the-issues-3/" title="Markdown Linter - Delving Into the Issues - 3">Part 3: Markdown Linter - Delving Into the Issues - 3</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/19/markdown-linter-delving-into-the-issues-4/" title="Markdown Linter - Delving Into the Issues - 4">Part 4: Markdown Linter - Delving Into the Issues - 4</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/26/markdown-linter-delving-into-the-issues-5/" title="Markdown Linter - Delving Into the Issues - 5">Part 5: Markdown Linter - Delving Into the Issues - 5</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/" title="Markdown Linter - Delving Into the Issues - 6">Part 6: Markdown Linter - Delving Into the Issues - 6</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/09/markdown-linter-delving-into-the-issues-7/" title="Markdown Linter - Delving Into the Issues - 7">Part 7: Markdown Linter - Delving Into the Issues - 7</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/16/markdown-linter-delving-into-the-issues-8/" title="Markdown Linter - Delving Into the Issues - 8">Part 8: Markdown Linter - Delving Into the Issues - 8</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/23/markdown-linter-delving-into-the-issues-9/" title="Markdown Linter - Delving Into the Issues - 9">Part 9: Markdown Linter - Delving Into the Issues - 9</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/30/markdown-linter-delving-into-the-issues-10/" title="Markdown Linter - Delving Into the Issues - 10">Part 10: Markdown Linter - Delving Into the Issues - 10</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/07/markdown-linter-delving-into-the-issues-11/" title="Markdown Linter - Delving Into the Issues - 11">Part 11: Markdown Linter - Delving Into the Issues - 11</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/14/markdown-linter-delving-into-the-issues-12/" title="Markdown Linter - Delving Into the Issues - 12">Part 12: Markdown Linter - Delving Into the Issues - 12</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/21/markdown-linter-delving-into-the-issues-13/" title="Markdown Linter - Delving Into the Issues - 13">Part 13: Markdown Linter - Delving Into the Issues - 13</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/28/markdown-linter-delving-into-the-issues-14/" title="Markdown Linter - Delving Into the Issues - 14">Part 14: Markdown Linter - Delving Into the Issues - 14</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/04/markdown-linter-delving-into-the-issues-15/" title="Markdown Linter - Delving Into the Issues - 15">Part 15: Markdown Linter - Delving Into the Issues - 15</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/11/markdown-linter-delving-into-the-issues-16/" title="Markdown Linter - Delving Into the Issues - 16">Part 16: Markdown Linter - Delving Into the Issues - 16</a>
            </li>
            <li  class="active-part">
            Part 17: Markdown Linter - Delving Into the Issues - 17
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/25/markdown-linter-delving-into-the-issues-18/" title="Markdown Linter - Delving Into the Issues - 18">Part 18: Markdown Linter - Delving Into the Issues - 18</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/02/01/markdown-linter-delving-into-the-issues-19/" title="Markdown Linter - Delving Into the Issues - 19">Part 19: Markdown Linter - Delving Into the Issues - 19</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>44</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>62</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>