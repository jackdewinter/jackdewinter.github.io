<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I talked about my efforts to streamline the rule implementation process and how that went. In this article, I talk about how that effort continues to pay dividends for the project. Introduction¶ What Is the Audience for This Article?¶ While detailed more eloquently in this …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Making Progress On New Rules "/>
<meta property="og:url" content="http://localhost:8000/2021/08/09/markdown-linter-making-progress-on-new-rules/" />
<meta property="og:description" content="Summary¶ In my last article, I talked about my efforts to streamline the rule implementation process and how that went. In this article, I talk about how that effort continues to pay dividends for the project. Introduction¶ What Is the Audience for This Article?¶ While detailed more eloquently in this …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2021-08-09T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Making Progress On New Rules ">
<meta name="twitter:description" content="Summary¶ In my last article, I talked about my efforts to streamline the rule implementation process and how that went. In this article, I talk about how that effort continues to pay dividends for the project. Introduction¶ What Is the Audience for This Article?¶ While detailed more eloquently in this …">

        <title>Markdown Linter - Making Progress On New Rules  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://localhost:8000/theme/webassets-external/2e0a05d0489c41fe874f34c2f7eca087_elegant.prod.css">
<link rel="stylesheet" href="http://localhost:8000/theme/webassets-external/0a9389fbd4491ec3aa2d3cc8a05fd6fa_custom.css">



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="http://localhost:8000/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       http://localhost:8000
                                    >Home</a>
                                </li>
                                <li ><a href="http://localhost:8000/categories">Categories</a></li>
                                <li ><a href="http://localhost:8000/tags">Tags</a></li>
                                <li ><a href="http://localhost:8000/archives">Archives</a></li>
                                <li><form class="navbar-search" action="http://localhost:8000/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="http://localhost:8000/2021/08/09/markdown-linter-making-progress-on-new-rules/">
                Markdown Linter - Making Progress On New Rules
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#working-fast-and-efficiently-part-two">Working Fast and Efficiently - Part Two</a></li>
<li><a href="#rules-md039-and-md040-getting-lucky">Rules Md039 and Md040 - Getting Lucky</a><ul>
<li><a href="#design">Design</a></li>
<li><a href="#implementation-and-testing">Implementation and Testing</a></li>
</ul>
</li>
<li><a href="#rule-md042-no-empty-links">Rule Md042 - No Empty Links</a><ul>
<li><a href="#implementation-and-testing_1">Implementation and Testing</a></li>
</ul>
</li>
<li><a href="#rule-md045-alternate-image-text">Rule Md045 - Alternate Image Text</a><ul>
<li><a href="#implementation-and-testing_2">Implementation and Testing</a></li>
</ul>
</li>
<li><a href="#rule-md046-code-block-style">Rule Md046 - Code Block Style</a><ul>
<li><a href="#design_1">Design</a></li>
<li><a href="#implementation-and-testing_3">Implementation and Testing</a></li>
</ul>
</li>
<li><a href="#rule-md048-code-fence-style">Rule Md048 - Code Fence Style</a><ul>
<li><a href="#implementation-and-testing_4">Implementation and Testing</a></li>
</ul>
</li>
<li><a href="#rule-md044-do-last">Rule Md044 - do last</a></li>
<li><a href="#rule-md034-base-url-used">Rule Md034 - Base Url Used</a><ul>
<li><a href="#design_2">Design</a><ul>
<li><a href="#changing-course-slightly">Changing Course Slightly</a></li>
</ul>
</li>
<li><a href="#implementation-and-testing_5">Implementation and Testing</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            <p id="list-of-translations">
This post is also available in:
    <a href="http://localhost:8000/2021/08/02/markdown-linter-making-progress-on-new-rules/">en</a></p>

            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="http://localhost:8000/2021/08/02/markdown-linter-making-progress-on-new-rules/">last article</a>, I talked
about my efforts to streamline the rule implementation process and how that went.
In this article, I talk about how that effort continues to pay dividends for
the project.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="http://localhost:8000/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please consult the commits that occurred between
<a href="https://github.com/jackdewinter/pymarkdown/commit/20509ae5bb5b11ff8a9fce8de1452bb5016d10d9">05 Aug 2021</a>
and
<a href="https://github.com/jackdewinter/pymarkdown/commit/11f9a632d763c54177e9cc367f53a3c3624e7503">07 Aug 2021</a>.</p>
<h2 id="working-fast-and-efficiently-part-two">Working Fast and Efficiently - Part Two<a class="headerlink" href="#working-fast-and-efficiently-part-two" title="Permanent link">¶</a></h2>
<p>Having completed </p>
<h2 id="rules-md039-and-md040-getting-lucky">Rules Md039 and Md040 - Getting Lucky<a class="headerlink" href="#rules-md039-and-md040-getting-lucky" title="Permanent link">¶</a></h2>
<p>Picking up the next rule, <em>Md039 - Spaces inside link text</em>, I was lucky
and I was able to complete the design within five minutes.  I am not being
flippant or exagerating on my skills, the design was just that easy.  It
was easy enough that I looked at the following rule <em>Md040 - Fenced code
blocks should have a language specified</em>, and found that it followed the
same pattern.  In both scenarios, the rule was acting on something that
was completely stored within a single token.  So, I decided to work on
these two rules together, and get them out of the way.</p>
<h3 id="design">Design<a class="headerlink" href="#design" title="Permanent link">¶</a></h3>
<p>As I mentioned in the last section, the design for these two rules we
trivial compared to other rules.  In the case of Rule Md039, all the text
used for the link label are stored within the token’s <code>text_from_blocks</code>
field.  For Rule Md040, the same applied to the <code>extracted_text</code> field.
That made the design simple: look for the specified token, and check
that field to see if it matches the requirements for triggering the
rules.</p>
<h3 id="implementation-and-testing">Implementation and Testing<a class="headerlink" href="#implementation-and-testing" title="Permanent link">¶</a></h3>
<p>The testing was the hard part to set for Rule Md039.  Because both Link
elements and Image elements are impacted, along with the four types
of notations allowed for each, I created twenty scenario tests to cover
each possibility.  Compared to that, the four scenarios required to
cover Rule Md040 were simple to create.</p>
<p>Once that was covered, the implementation went off without any problems.
For Rule Md039, once a Link element or an Image element was detected,
a simple check to see if there were any spaces on either side of the
link label, stored in <code>text_from_blocks</code>, was added with the following code:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_inline_link</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">is_inline_image</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">text_from_blocks</span> <span class="o">!=</span> <span class="n">token</span><span class="o">.</span><span class="n">text_from_blocks</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_next_token_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</pre></div>
<p>Similarly for Rule Md040, given the start of a Fenced Code Block element,
a simple check was added to determine if the <code>extracted_text</code> field contained
any characters after removing whitespace:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_fenced_code_block</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">extracted_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_next_token_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</pre></div>
<p>While I know I will not always get as lucky as with the design and
implementation of these two rules, it was nice to know it could
happen every so often.</p>
<h2 id="rule-md042-no-empty-links">Rule Md042 - No Empty Links<a class="headerlink" href="#rule-md042-no-empty-links" title="Permanent link">¶</a></h2>
<p>This rule was going to be another rule that would be handled with
a simple implementation. In this case, it was similar to Rule Md039.
But instead of checking for spaces on either side of the link label,
it was checking for a link URI that had not been specified.  As this
is a trick that authors, including myself, often use to ensure that they
fill in link URIs before publishing a document, I wanted to make sure
it was completed.</p>
<h3 id="implementation-and-testing_1">Implementation and Testing<a class="headerlink" href="#implementation-and-testing_1" title="Permanent link">¶</a></h3>
<p>As the design of this rule was so similar to the designs for both
Rule Md039 and Rule Md040, I leveraged their design instead of creating
a new one.  For the testing of this rule, I was fortunate that this
rule only applies to Inline Link elements and Inline Image elements.<sup id="fnref:inline"><a class="footnote-ref" href="#fn:inline">1</a></sup>
As such, I only needed to provide scenarios that deal with both inline
types of links.</p>
<p>With the information that this rule only fires if there is an empty
URI or an empty URI fragment reference, the code for this rule was
quickly implemented:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_inline_link</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">is_inline_image</span><span class="p">:</span>
        <span class="n">stripped_link_uri</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">active_link_uri</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped_link_uri</span> <span class="ow">or</span> <span class="n">stripped_link_uri</span> <span class="o">==</span> <span class="s2">"#"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_next_token_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</pre></div>
<h2 id="rule-md045-alternate-image-text">Rule Md045 - Alternate Image Text<a class="headerlink" href="#rule-md045-alternate-image-text" title="Permanent link">¶</a></h2>
<p>At this point, I was hoping that I would find more of these simple rules
to implement, but also dreading them at the same time.  The way I figured
it out in my head, the more of these rules that there are, the more of a
chance that the other rules would be orders of magnitude more difficult.</p>
<p>But still, this rule fell into the same pattern as the last three rules,
and I was greatful for the chance to keep things going forward.</p>
<h3 id="implementation-and-testing_2">Implementation and Testing<a class="headerlink" href="#implementation-and-testing_2" title="Permanent link">¶</a></h3>
<p>With three scenarios to cover inline Image elements and four scenarios to cover
the other three types of Image elements, the tests were set up and I was
ready to start implementation.  As the Image element’s link label specifies
the alternate image text stored in the <code>img</code> tag’s <code>alt</code> parameter, the
implementation was just to verify that there is text in the <code>text_from_blocks</code>
field, as follows:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_inline_image</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">text_from_blocks</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_next_token_error</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</pre></div>
<h2 id="rule-md046-code-block-style">Rule Md046 - Code Block Style<a class="headerlink" href="#rule-md046-code-block-style" title="Permanent link">¶</a></h2>
<p>While not as simple as the last four rules were to implement, I
quickly found out that this rule was one of the <em>style</em> rules that
I have implmeneted before.  Looking into what I did for
<a href="https://github.com/jackdewinter/pymarkdown/blob/main/pymarkdown/plugins/rule_md_003.py">Rule Md003</a>
and
<a href="https://github.com/jackdewinter/pymarkdown/blob/main/pymarkdown/plugins/rule_md_004.py">Rule Md004</a>,
I did not believe I had to do a complete rewrite of a rule, just a massaging
of the previous work to form a new rule.</p>
<h3 id="design_1">Design<a class="headerlink" href="#design_1" title="Permanent link">¶</a></h3>
<p>In Rule Md003, there was a lot of extra code to determine what the heading
levels were for both the Atx Heading element and the SetExt Heading element.
Rule Md004 was a lot simpler.  In the case of that rule, most of the rule is
geared towards checking to see if the applied style is correct, with only
a handful of lines used to look for Unordered List elements and to track
different levels of styles.  As such, it seemed prudent to base the design
for Rule Md046 on Rule Md004 with a couple of changes.</p>
<p>Those changes were simple and easy to implement.  Instead of tracking Unordered
List elements, Code Block elements were tracked.  And instead of tracking the
multiple levels required for the nesting of List elements, a field containing
the one and only style was good enough.</p>
<h3 id="implementation-and-testing_3">Implementation and Testing<a class="headerlink" href="#implementation-and-testing_3" title="Permanent link">¶</a></h3>
<p>Going through the permutations in my head, there were really only three scenario
tests that I needed to write: two Fenced Code Block elements, two Indented Code
Block elements, and a final test with one of each.  Every other combination of
Code Blocks that I came up with was able to be reduced into one of those three
scenarios.  [more?]</p>
<p>As indicated in the design, after copying the build of the source for Rule Md004
into <code>rule_md046.py</code>, only a couple of changes were required.
Instead of using the styles available for Rule Md004, I defined a new set
of styles to use:</p>
<div class="highlight"><pre><span></span>    <span class="n">__consistent_style</span> <span class="o">=</span> <span class="s2">"consistent"</span>
    <span class="n">__fenced_style</span> <span class="o">=</span> <span class="s2">"fenced"</span>
    <span class="n">__indented_style</span> <span class="o">=</span> <span class="s2">"indented"</span>
    <span class="n">__valid_styles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">__consistent_style</span><span class="p">,</span>
        <span class="n">__fenced_style</span><span class="p">,</span>
        <span class="n">__indented_style</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
<p>Then, in the <code>next_token</code> function, instead of tracking Unordered List
elements, I modified the code to track Code Block elements.  With
that done, I only needed to set the <code>current_style</code> variable to the
current style, and the previously written code did the rest of the
heavy lifting.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_code_block</span><span class="p">:</span>
        <span class="n">current_style</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">RuleMd046</span><span class="o">.</span><span class="n">__fenced_style</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_fenced_code_block</span>
            <span class="k">else</span> <span class="n">RuleMd046</span><span class="o">.</span><span class="n">__indented_style</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__actual_style_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__actual_style_type</span> <span class="o">=</span> <span class="n">current_style</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__actual_style_type</span> <span class="o">!=</span> <span class="n">current_style</span><span class="p">:</span>
            <span class="n">extra_data</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"Expected: "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__actual_style_type</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">"; Actual: "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_style</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_next_token_error</span><span class="p">(</span>
                <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">extra_error_information</span><span class="o">=</span><span class="n">extra_data</span>
            <span class="p">)</span>
</pre></div>
<h2 id="rule-md048-code-fence-style">Rule Md048 - Code Fence Style<a class="headerlink" href="#rule-md048-code-fence-style" title="Permanent link">¶</a></h2>
<p>Having just completed the code for Rule Md046, I was fortunate to look
ahead and find that Rul Md048 was almost indentical in composition to
Rule Md046.  The only difference was that instead of verifying the style
of the type of Code Block element, this rule was focusing on verifying
the style of the character used to define the Fenced Code Block element
itself.</p>
<h3 id="implementation-and-testing_4">Implementation and Testing<a class="headerlink" href="#implementation-and-testing_4" title="Permanent link">¶</a></h3>
<p>Given the last rule that I worked on before this rule, I am sure that
readers will not experience any surprise when finding out that the
implementing and testing of this rule was an almost exact copy of
the work done for Rule Md046.  Besides the names of the available
styles, the only other code that changed was replacing this code:</p>
<div class="highlight"><pre><span></span>    <span class="n">current_style</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">RuleMd046</span><span class="o">.</span><span class="n">__fenced_style</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_fenced_code_block</span>
        <span class="k">else</span> <span class="n">RuleMd046</span><span class="o">.</span><span class="n">__indented_style</span>
    <span class="p">)</span>
</pre></div>
<p>with this code:</p>
<div class="highlight"><pre><span></span>    <span class="n">current_style</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">RuleMd048</span><span class="o">.</span><span class="n">__backtick_style</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">fence_character</span> <span class="o">==</span> <span class="s2">"`"</span>
        <span class="k">else</span> <span class="n">RuleMd048</span><span class="o">.</span><span class="n">__tilde_style</span>
    <span class="p">)</span>
</pre></div>
<h2 id="rule-md044-do-last">Rule Md044 - do last<a class="headerlink" href="#rule-md044-do-last" title="Permanent link">¶</a></h2>
<h2 id="rule-md034-base-url-used">Rule Md034 - Base Url Used<a class="headerlink" href="#rule-md034-base-url-used" title="Permanent link">¶</a></h2>
<p>After the ease of a lot of the previous rule, and the difficulty
of the last rule, it was nice to get a rule that had a medium
level of difficulty to design. [more?] look for “bare” urls.</p>
<h3 id="design_2">Design<a class="headerlink" href="#design_2" title="Permanent link">¶</a></h3>
<p>The first part of this design was easy: eliminate this rule firing
within a Code Block element, an HTML Block element, or a Link element.
Within those elements, it did not make sense to look for Bare URLs,
as text within those types of elements intrinsically meant something
different than a normal section of text.  Those are the ones I needed
to focus on.</p>
<p>Once I had a method to eliminate scanning those types of Text elements,
I had to design a way to properly scan text for a series of characters
that represented an URL.  This is where the design got interesting.
It all centered on one question: what is an URL?</p>
<p>As the documentation that I added to
<a href="https://github.com/jackdewinter/pymarkdown/blob/main/docs/rules/rule_md038.md">Rule Md038</a>
notes, it is an interesting question to answer.  URLs can be anything from
<code>https://google.com</code> to <code>#fragment</code> and everything in between.  It all depends
on the given context as to which definition of an URL is most applicable.  Even once
that decision is made, trying to come up with anything resembling a complete
algorithm for detecting all valid URLs of that type can be troublesome, if not
almost impossible.  I needed to narrow down the URL context that I was
looking for if I had any hope of being able to create a decent algorithm.</p>
<p>It was after experimenting with Visual Code and the
<a href="https://github.com/markdownlint/markdownlint">Markdown Lint</a> plugin
that I use that I determined that the original rule is very tightly focused
on two specific URLs: base URLs for HTTP and FTP.  Every other URL that
I tried to get the rule to recognize failed, so I hope that is the correct
summary.  Regardless, I needed someplace to start, and that information
provided me with a good starting place.</p>
<p>Given the nature of these URLs, I felt that the best option to choose
was a simple <em>search-find-next</em> loop.  While I would have liked
to avoid having to repeat this loop for every valid base URL (<code>http:</code>,
<code>https:</code>, <code>ftp:</code>, and <code>ftps:</code>), I didn’t see any way to avoid it. Small
optimzations like looking for <code>http</code> and then looking for either <code>:</code> or
<code>s:</code> had their merits, but I did not believe they would increase the
performance of the algrithm at all.  So, if any one of those bases matched,
I would pass on that information to another function that would further
evaluate the URL.  Primarily, it would look for the sequence <code>//</code> after
the base URL prefix.</p>
<h4 id="changing-course-slightly">Changing Course Slightly<a class="headerlink" href="#changing-course-slightly" title="Permanent link">¶</a></h4>
<p>It was during this point in the design when I reread the orignal rule
and found it to be way too complicated.  URLs were valid if they were
encased within a small group of bounding characters?  How did that
benefit the user?  To me, it just made my understanding of the rule
more difficult to achieve.</p>
<p>As such, I changed the course of what I wanted to do with this rule
slightly.  Instead of the previous rule’s boundary conditions, I
created a more simpler set of conditions.  The first is that any
character before the base URL must be a whitespace character. The
second is that the base URL must be followed by the sequence <code>//</code>
and at least one non-whitespace character.</p>
<p>[more]</p>
<h3 id="implementation-and-testing_5">Implementation and Testing<a class="headerlink" href="#implementation-and-testing_5" title="Permanent link">¶</a></h3>
<p>Coming up with the fourteen scenarios required to test this rule was
decently easy.  </p>
<p>Moving on to the implementation, it proceded rather quickly.  After
eliminating any Text elements within Code Block elements, Html Block
elements or Link elements, a simple <em>search-find-next</em> loop was added
to look for multiple occurences of a base URL prefix within the
provided text.  Once an occurrence was found, it was handed off to
the unwritten <code>__evaluate_possible_url</code> function for evaluation.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">next_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">token</span><span class="o">.</span><span class="n">is_text</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__in_code_block</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__in_html_block</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__in_link</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">url_prefix</span> <span class="ow">in</span> <span class="n">RuleMd034</span><span class="o">.</span><span class="n">__valid_uri_types</span><span class="p">:</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">found_index</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">url_prefix</span><span class="p">,</span> <span class="n">start_index</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">found_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__evaluate_possible_url</span><span class="p">(</span>
                    <span class="n">token</span><span class="o">.</span><span class="n">token_text</span><span class="p">,</span> <span class="n">url_prefix</span><span class="p">,</span> <span class="n">found_index</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span>
                <span class="p">)</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="n">found_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_prefix</span><span class="p">)</span>
                <span class="n">found_index</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">url_prefix</span><span class="p">,</span> <span class="n">start_index</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">is_code_block</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__in_code_block</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">is_code_block_end</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__in_code_block</span> <span class="o">=</span> <span class="bp">False</span>
<span class="o">...</span>
</pre></div>
<p>Following the design, this function was easy to code.  If there is
no character preceding the location of base URL prefix or if it
is a whitespace character, then the algorithm continues.  From there,
it grabs the next three characters after the found base URL prefix,
verifying that the next two characters are <code>//</code>.  Given that verification,
the only thing left was to make sure that the character after the
sequence <code>//</code> is a non-whitespace character, which was added with ease.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__evaluate_possible_url</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">source_text</span><span class="p">,</span> <span class="n">url_prefix</span><span class="p">,</span> <span class="n">found_index</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">token</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">found_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">source_text</span><span class="p">[</span><span class="n">found_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">):</span>
        <span class="n">url_start_sequence</span> <span class="o">=</span> <span class="n">source_text</span><span class="p">[</span><span class="n">found_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_prefix</span><span class="p">)</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">url_start_sequence</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
            <span class="ow">and</span> <span class="n">url_start_sequence</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"//"</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">url_start_sequence</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="p">(</span>
                <span class="n">column_number_delta</span><span class="p">,</span> <span class="n">line_number_delta</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">adjust_for_newlines</span><span class="p">(</span><span class="n">source_text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">found_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_next_token_error</span><span class="p">(</span>
                <span class="n">context</span><span class="p">,</span>
                <span class="n">token</span><span class="p">,</span>
                <span class="n">line_number_delta</span><span class="o">=</span><span class="n">line_number_delta</span><span class="p">,</span>
                <span class="n">column_number_delta</span><span class="o">=</span><span class="n">column_number_delta</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>8 completed, from 21 to 13</p>
<p>xxx 13 left, 18 done</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Yup, more rules, but I do not know which ones and how many I will get done.
Stay tuned!</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:inline">
<p>For the other three types of links, a Link Reference Definition element must be used.  As a Link Referenced Definition element must contain a URI, and only an Inline Link element does not require one, only the Inline Link element was required for testing. <a class="footnote-backref" href="#fnref:inline" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Making%20Progress%20On%20New%20Rules&url=http%3A//localhost%3A8000/2021/08/09/markdown-linter-making-progress-on-new-rules/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//localhost%3A8000/2021/08/09/markdown-linter-making-progress-on-new-rules/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Making%20Progress%20On%20New%20Rules&amp;body=http%3A//localhost%3A8000/2021/08/09/markdown-linter-making-progress-on-new-rules/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="http://localhost:8000/2021/08/09/markdown-linter-making-progress-on-new-rules/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-beta-release-f"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://localhost:8000/2021/07/26/markdown-linter-getting-back-to-new-rules/" title="Previous: Markdown Linter - Getting Back To New Rules">Markdown Linter - Getting Back To New Rules</a></li>
                <li class="next-article"><a href="http://localhost:8000/2021/08/02/markdown-linter-making-progress-on-new-rules/" title="Next: Markdown Linter - Making Progress On New Rules">Markdown Linter - Making Progress On New Rules</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~10 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2021-08-09T00:00:00-07:00">Aug 9, 2021</time>
        <h4>Markdown Linter Beta Release</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="http://localhost:8000/2021/06/14/markdown-linter-getting-stuff-done/" title="Markdown Linter - Getting Stuff Done">Part 1: Markdown Linter - Getting Stuff Done</a>
            </li>
            <li >
            <a href="http://localhost:8000/2021/06/21/markdown-linter-elevating-extensions/" title="Markdown Linter - Elevating Extensions">Part 2: Markdown Linter - Elevating Extensions</a>
            </li>
            <li >
            <a href="http://localhost:8000/2021/06/28/markdown-linter-sometimes-you-have-to-go-backwards/" title="Markdown Linter - Sometimes You Have To Go Backwards...">Part 3: Markdown Linter - Sometimes You Have To Go Backwards...</a>
            </li>
            <li >
            <a href="http://localhost:8000/2021/07/12/markdown-linter-full-of-sound-and-fury/" title="Markdown Linter - Full Of Sound And Fury">Part 4: Markdown Linter - Full Of Sound And Fury</a>
            </li>
            <li >
            <a href="http://localhost:8000/2021/08/02/markdown-linter-making-progress-on-new-rules/" title="Markdown Linter - Making Progress On New Rules">Part 5: Markdown Linter - Making Progress On New Rules</a>
            </li>
            <li >
            <a href="http://localhost:8000/2021/07/26/markdown-linter-getting-back-to-new-rules/" title="Markdown Linter - Getting Back To New Rules">Part 6: Markdown Linter - Getting Back To New Rules</a>
            </li>
            <li  class="active-part">
            Part 7: Markdown Linter - Making Progress On New Rules
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="http://localhost:8000/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://localhost:8000/tags#core-linter-ref">core linter
                    <span>63</span>
</a></li>
                <li><a href="http://localhost:8000/tags#markdown-linter-ref">markdown linter
                    <span>81</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2021 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>