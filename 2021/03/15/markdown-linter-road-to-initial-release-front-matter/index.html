<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I talked about how I started to focus more on resolving the higher priority issues from the project’s issues list and the problems I faced doing that. In this article, I talk about my own requirements for a front-matter processor and how I added …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Road To Initial Release - Front-Matter "/>
<meta property="og:url" content="https://jackdewinter.github.io/2021/03/15/markdown-linter-road-to-initial-release-front-matter/" />
<meta property="og:description" content="Summary¶ In my last article, I talked about how I started to focus more on resolving the higher priority issues from the project’s issues list and the problems I faced doing that. In this article, I talk about my own requirements for a front-matter processor and how I added …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2021-03-15T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Road To Initial Release - Front-Matter ">
<meta name="twitter:description" content="Summary¶ In my last article, I talked about how I started to focus more on resolving the higher priority issues from the project’s issues list and the problems I faced doing that. In this article, I talk about my own requirements for a front-matter processor and how I added …">

        <title>Markdown Linter - Road To Initial Release - Front-Matter  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2021/03/15/markdown-linter-road-to-initial-release-front-matter/">
                Markdown Linter - Road To Initial Release - Front-Matter
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#markdown-front-matter">Markdown Front-Matter</a><ul>
<li><a href="#why-is-it-needed">Why Is It Needed?</a></li>
<li><a href="#what-is-markdown-front-matter">What Is Markdown Front-Matter?</a></li>
<li><a href="#what-are-the-standards">What Are The Standards?</a><ul>
<li><a href="#group-1-pelican-static-site-generator">Group 1: Pelican Static Site Generator</a></li>
<li><a href="#group-2-commonmark-markdown-parser">Group 2: CommonMark Markdown Parser</a></li>
<li><a href="#group-3-markdown-it-front-matter-extension">Group 3: Markdown IT Front Matter Extension</a></li>
<li><a href="#finding-the-best-of-all-worlds">Finding The Best of All Worlds</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#before-we-go-on">Before We Go On</a></li>
<li><a href="#adding-the-feature">Adding The Feature</a><ul>
<li><a href="#testing-first">Testing First</a></li>
<li><a href="#keeping-a-single-point-of-entrance">Keeping a Single Point of Entrance</a></li>
<li><a href="#filling-out-the-processing">Filling Out The Processing</a></li>
<li><a href="#implementing-the-interesting-stuff">Implementing The Interesting Stuff</a></li>
</ul>
</li>
<li><a href="#rounding-out-the-feature">Rounding Out The Feature</a><ul>
<li><a href="#adding-html-support">Adding HTML Support</a></li>
<li><a href="#adding-markdown-rehydration-support">Adding Markdown Rehydration Support</a></li>
<li><a href="#adding-consistency-check-support">Adding Consistency Check Support</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2021/03/08/markdown-linter-road-to-initial-release-cleaning-up-the-list-and-readability/">last article</a>, I talked about
how I started to focus more on resolving the higher priority issues from the project’s
issues list and the problems I faced doing that.  In this article, I talk about my own
requirements for a front-matter processor and how I added it to the project.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>With a sharper focus, I took a look at the
<a href="https://github.com/jackdewinter/pymarkdown#project-to-do-list">issues list</a>
for the project and made a firm commitment to myself: to work through and complete as
many of the Priority 1 issues as possible as quickly as possible.  But in terms of
importance, there was one of those issues that stood apart from the rest:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">optional</span> <span class="n">YAML</span><span class="o">/</span><span class="k">simple</span> <span class="n">front</span> <span class="n">loader</span>
</pre></div>
<p>Back at the start of the project, I sat down and figured out what the real
requirements for the project were, as
<a href="https://jackdewinter.github.io/2019/12/08/markdown-linter-collecting-requirements/#what-are-the-requirements">detailed here</a>.
However, while it is not explicitly stated in that list of requirements, the
overarching requirement is stated in the last paragraph of that section:</p>
<blockquote>
<p>From my point of view, these requirements help me visualize a project that will help me maintain my website by ensuring that any articles that I write conform to a simple set of rules.</p>
</blockquote>
<p>The big push for me to do this was always to help me maintain my own website.  Since
that website is written as a collection of Markdown documents, I did not think that I
needed to explicitly state that this project must work on my own website’s Markdown
documents. It was just expected. And to do that, I needed to be able to handle the
metadata in the front-matter of my articles.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commit for
<a href="https://github.com/jackdewinter/pymarkdown/commit/f4c785d6d15734208d995067b1de486d30bd6cea">04 Mar 2021</a>.</p>
<h2 id="markdown-front-matter">Markdown Front-Matter<a class="headerlink" href="#markdown-front-matter" title="Permanent link">¶</a></h2>
<p>With respect to Markdown, if all someone has ever done is to use it to format a readme.md
file or to add formatting to a control on a web form, the term <code>front-matter</code> might be
a bit confusing.  But for someone like me, who has a website authored in Markdown,
it is a pivotal piece of the authoring process.  As such, it needs to be done right.</p>
<h3 id="why-is-it-needed">Why Is It Needed?<a class="headerlink" href="#why-is-it-needed" title="Permanent link">¶</a></h3>
<p>When I write an article for my website, the body of the article is approximately 95 percent
of the work. Coming up with a good format, making sure the article flows, and checking for
grammar; these are the harder parts of writing articles on the weekly schedule
that I follow.  Those parts of the article form the content of the article, and once I
fine-tune that content, it is very important to me that the content is presented
properly.  That is where metadata comes in.</p>
<p>To properly ensure that the articles are rendered properly and placed in the right areas
of my website, I need
to have a method that allows me to communicate metadata about the article to my website
generator.  Different website generators structure their content in different ways,  but
every website generator that I have looked at requires some form of additional metadata
provided within each article to be published.  After all, only so much information can be
obtained from a directory structure or the article itself. For most website generators,
that extra information is contained within something referred to as front-matter.</p>
<h3 id="what-is-markdown-front-matter">What Is Markdown Front-Matter?<a class="headerlink" href="#what-is-markdown-front-matter" title="Permanent link">¶</a></h3>
<p>Having experimented with a handful of
<a href="https://jackdewinter.github.io/2019/08/18/static-websites-choosing-a-static-web-site-generator/">static site generators</a>,
I chose the
<a href="https://blog.getpelican.com/">Pelican</a> website generator for my own personal site.
While I admit that I could have gone with something different, I do not regret any part
of my decision to use Pelican as my site generator.  It fits all my needs perfectly, and
my simple tooling around it allows me to focus on the publishing of the articles, not
the site generator.</p>
<p>I believe that one of the reasons that I work well with Pelican is that
Pelican treats article metadata as a first-class object, not as an afterthought.  This is
evident as the first example of creating an article that exists on the Pelican
<a href="https://docs.getpelican.com/en/latest/quickstart.html#create-an-article">Quick Start</a> page
is:</p>
<div class="highlight"><pre><span></span>Title: My First Review
Date: 2010-12-03 10:20
Category: Review

Following is a review of my favorite mechanical keyboard.
</pre></div>
<p>That example is then followed up by a more complete example in the next section on
<a href="https://docs.getpelican.com/en/latest/content.html#file-metadata">Writing Content</a>
with the section on “File Metadata”:</p>
<div class="highlight"><pre><span></span>Title: My super title
Date: 2010-12-03 10:20
Modified: 2010-12-05 19:30
Category: Python
Tags: pelican, publishing
Slug: my-super-post
Authors: Alexis Metaireau, Conan Doyle
Summary: Short version for index and feeds

This is the content of my super blog post.
</pre></div>
<p>These are both great examples of articles containing front-matter metadata.  In its
simplest form, front-matter is
extra metadata that is attached to the beginning of an article, to be consumed by
the website generator and not presented to the reader as content.  While the effects of
one or more of the data fields may influence how the content of the rest of the article is
presented, that information is not explicitly part of the article itself.</p>
<p>A good example of that is the <code>Title</code> field in the above examples.  If I were to publish
this article on my website, the content of the article would be a single paragraph:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This is the content of my super blog post.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>However, at the top of the page, the title itself would be presented as:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
    My super title
<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</pre></div>
<p>Similarly, different parts of Pelican may use other fields to affect how the article
is rendered or where the article is rendered.  When was the article written?  Is this
article part of a series of articles?  What tags are associated with the article? These
are all specified in the front-matter of each article that I write.</p>
<p>That is why front-matter support is so important to me.  This website is how I communicate
with others, and I want to get it right.</p>
<h3 id="what-are-the-standards">What Are The Standards?<a class="headerlink" href="#what-are-the-standards" title="Permanent link">¶</a></h3>
<p>The first thing I need to cover is why any definition or standard around front-matter
is not present in the
<a href="https://github.github.com/gfm/">GFM specification</a>.
The GFM specification itself is specifically focused on the common parts of Markdown
and how it is rendered into HTML.  Front-matter influences how the
content is presented but is not directly part of the content.  Therefore, it feels right
that the GFM specification has no mention of front-matter.</p>
<p>Knowing this, I started looking for any kind of specification for front-matter weeks
before I started to work on this feature.  While information was hard to find, the
information fell into three groups.</p>
<h4 id="group-1-pelican-static-site-generator">Group 1: Pelican Static Site Generator<a class="headerlink" href="#group-1-pelican-static-site-generator" title="Permanent link">¶</a></h4>
<p>The first group that defined front-matter was in the documentation for the
<a href="https://python-markdown.github.io/extensions/meta_data/">Pelican Meta-Data</a> plugin.
This documentation was not easy to define, but provided the following paraphrased rules:</p>
<ul>
<li>keywords are case-insensitive letter, numbers, underscore, dashes and must end with a colon</li>
<li>everything after the colon on the line, including a no data, are acceptable</li>
<li>if a line is idented by 4 or more spaces, that line is added to the data for the previous keyword</li>
<li>the first blank line ends all metadata for the document</li>
<li>alternatively, fences may be used<ul>
<li>the first line of the document must be <code>---</code></li>
<li>the metadata ends at the first blank line or the first line containing <code>---</code> or <code>...</code>, whichever comes first</li>
</ul>
</li>
</ul>
<p>I had been following these rules without knowing them for months, but it was nice to
finally know that they were in a concrete way.  At least it was a start.</p>
<h4 id="group-2-commonmark-markdown-parser">Group 2: CommonMark Markdown Parser<a class="headerlink" href="#group-2-commonmark-markdown-parser" title="Permanent link">¶</a></h4>
<p>The second group that I found was in the documentation for the
<a href="https://github.com/commonmark/commonmark-java#yaml-front-matter">Commonmark</a>
Markdown Parser.  While it it is not explicitly stated as such, after a bit of digging
in the
<a href="https://github.com/commonmark/commonmark-java/blob/main/commonmark-ext-yaml-front-matter/src/main/java/org/commonmark/ext/front/matter/internal/YamlFrontMatterBlockParser.java">Java source code</a>
yielded the following rules by reading through the regular expressions in that code:</p>
<ul>
<li>normal lines are started with 0 to 3 spaces, followed by 1 or more characters in <code>a-z0-9._-</code></li>
<li>in certain cases where a “special” sequence was started, a line that starts with 4 or more spaces may add to the current value (such as literals)</li>
<li>fences are required<ul>
<li>the start fence must start with 3 or more <code>-</code> characters</li>
<li>the end fence must start with 3 or more <code>-</code> or <code>.</code> characters</li>
</ul>
</li>
</ul>
<p>I really love documentation that presents you with a single example and almost nothing
else.  Without being able to read the Java code for details, this one would not have
made the list.</p>
<h4 id="group-3-markdown-it-front-matter-extension">Group 3: Markdown IT Front Matter Extension<a class="headerlink" href="#group-3-markdown-it-front-matter-extension" title="Permanent link">¶</a></h4>
<p>The final group that I found was in the documentation for the
<a href="https://github.com/ParkSB/markdown-it-front-matter">Markdown IT Front Matter Extension</a>.
By far, this was the most complete documentation.  It is so complete and well documented
that I did not have to search any source code or paraphrase any other documentation.
These points are copied verbatim from that website:</p>
<ul>
<li>Indicated by three or more dashes: —</li>
<li>Opening and closing fences must be the same number of dash characters</li>
<li>Opening fence must begin on the first line of the markdown string/file</li>
<li>Opening fence must not be indented</li>
<li>The example above uses YAML but YAML is not required (bring your own front matter parser)</li>
</ul>
<p>As I mentioned before the list: complete and well-documented.</p>
<h4 id="finding-the-best-of-all-worlds">Finding The Best of All Worlds<a class="headerlink" href="#finding-the-best-of-all-worlds" title="Permanent link">¶</a></h4>
<p>Faced with those three groups of definitions, I needed to think about how I was going to
pull these together in a way that made sense.  For this initial release, my big reason
for adding this feature was to enable front-matter for linting my own website files.  As
such, the rules that apply to the Pelican Meta-Data plugin needed to have a bit more
weight than the other rules.  Even so, as I want to be able to add more support for other
types of front-matter in the future, it made sense to only use that as a weighting, not as
a final decision.</p>
<p>The first set of decisions that I needed to make were regarding the “fences” at the start
and end of the metadata.  Each of the sample implementations specify that the metadata
must start at the beginning of the article, so that was one decision neatly out of the
way.  With respect to the fences themselves, while the Pelican plugin provides for them
as an option, the other two implementations do not, so I decided to make them mandatory
for now.  But that left me to decide on the exact format of those fences. The
Pelican plugin
implementation specifies exactly 3 <code>-</code> characters for the start fence and exactly 3 <code>-</code>
or <code>.</code> characters for the end fence.  The CommonMark implementation specifies 3 or more
<code>-</code> characters for the start fence and 3 or more <code>-</code> or <code>.</code> characters for the end fence.
Finally, the Markdown-It implementation specifies 3 or more <code>-</code> characters for the start
fence and 3 or more <code>-</code> characters for the end fence.  This implementation also added
the caveat that the start and end fences must have the same number of characters.
Each one of these was a little different, and I wanted to make a good first choice with
respect to the fences.  That took a bit of thought.</p>
<p>In the end, I decided that for now, having fences with 3 or more <code>-</code> characters
was the best way to go.  Since each of these implementations specifies, either explicitly
or implicitly, that the fences must be at the start of a line, that decision was a simple
one.  Finally, as I like symmetry in my articles, I felt that mandating that the start
fence and the end fence contain the same number and type of characters was the final
decision I had to make with respect to the headers.
As for the content of the front-matter, I felt that since my initial push was to support
the Pelican Meta-Data plugin, using its rules for content were good enough for me.</p>
<p>As I was coming up with these rules, I was cognizant of one big thing: I did not have to
be correct, I just needed a good set of defaults.  I was sure that at some point I was
going to support all three formats, just not right away.  Until I got to that point, I
just needed to have something “good enough”.</p>
<h2 id="before-we-go-on">Before We Go On<a class="headerlink" href="#before-we-go-on" title="Permanent link">¶</a></h2>
<p>I pride myself on my honesty, so here goes: I messed up.  This article is mainly about
the setup around the addition of a new feature to the project, which is mostly complete
in
<a href="https://github.com/jackdewinter/pymarkdown/commit/f4c785d6d15734208d995067b1de486d30bd6cea">this commit</a>.
However, for some reason, I did not add the module <code>front_matter_markdown_token.py</code>
and the module <code>test_markdown_front_matter.py</code> until
<a href="https://github.com/jackdewinter/pymarkdown/commit/8a30dee0c0105898258e6074d5058556c08410ca">this commit</a>
which is where the bulk of the work for parsing is located.  So, while most of the work
is contained within the first commit, I ask for you lenience, dear reader.  Please
pretend that that one file was added in the first commit.  Thank you.</p>
<h2 id="adding-the-feature">Adding The Feature<a class="headerlink" href="#adding-the-feature" title="Permanent link">¶</a></h2>
<p>Starting to add this feature, I was keenly aware that I needed to start thinking about
how to implement new features in an adaptable manner.  This was only the first extension,
and not the last one to come.  To that end, I wanted to start the process of
making sure that extending the parser and the linter were both possible.  This was a good
place to start!</p>
<p>Based on the actions that the front-matter processing needed to perform, I made the
decision that it had to be encapsulated in a Leaf Block token.  It was not a
container and it did not make sense to specify it as an Inline token.  After a bit of
thinking on it, I concluded that it was a special token that contains
other information, although not tokens.  As such, while it was a bit of a reach, I
figured that it made sense to express it as a Leaf Block token, just a specially scoped
token.</p>
<h3 id="testing-first">Testing First<a class="headerlink" href="#testing-first" title="Permanent link">¶</a></h3>
<p>As is my process, while I might have added a bit of simple code here and there to test
some little things out, this feature started with the first of the scenario tests added
to the <code>test_markdown_front_matter.py</code> module.  While this may appear to some as a
backwards way to do things, I consistently return to the process because of one thing: it
works well for me.  Before starting the coding part of the feature, I have a test that
provides a good set of requirements for what is needed to complete that one part.</p>
<p>For me, this is the best way to go.  Write the test to specify your goal for the feature,
and then work towards it.</p>
<h3 id="keeping-a-single-point-of-entrance">Keeping a Single Point of Entrance<a class="headerlink" href="#keeping-a-single-point-of-entrance" title="Permanent link">¶</a></h3>
<p>As I knew that the bulk of the code was going to be provided in an extension module,
it was important to me that there be only one point of entry for the code to process
front-matter.  </p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">__process_header_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token_to_use</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">requeue</span><span class="p">):</span>
        <span class="p">(</span>
            <span class="n">token_to_use</span><span class="p">,</span>
            <span class="n">line_number</span><span class="p">,</span>
            <span class="n">requeue</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">FrontMatterExtension</span><span class="o">.</span><span class="n">process_header_if_present</span><span class="p">(</span>
            <span class="n">token_to_use</span><span class="p">,</span>
            <span class="n">line_number</span><span class="p">,</span>
            <span class="n">requeue</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_provider</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_document</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">token_to_use</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">requeue</span>
</pre></div>
<p>To make sure that it was called exactly once, I added the call to that function at the
start of the <code>__parse_blocks_pass</code> function, right at the <code>try</code> statement:</p>
<div class="highlight"><pre><span></span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">token_to_use</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">requeue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_header_if_present</span><span class="p">(</span>
            <span class="n">token_to_use</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">requeue</span>
        <span class="p">)</span>
        <span class="n">did_start_close</span> <span class="o">=</span> <span class="n">token_to_use</span> <span class="ow">is</span> <span class="bp">None</span>
</pre></div>
<h3 id="filling-out-the-processing">Filling Out The Processing<a class="headerlink" href="#filling-out-the-processing" title="Permanent link">¶</a></h3>
<p>For the most part, the processing was simple.  If anyone is interested in the
actual code that was added, look in
<a href="https://github.com/jackdewinter/pymarkdown/commit/8a30dee0c0105898258e6074d5058556c08410ca">this commit</a>
for <code>process_header_if_present</code> and follow along from there.  I am going to focus on
more description about what is done rather than walk through each function line-by-line.</p>
<p>As I already had the
<code>is_thematic_break</code> function that was 95% of the way to where I needed it to be,
I decided to retrofit that function instead of implementing a new one.  The only
three differences between a thematic break and the start fence were the characters
used, the indentation allowed, and whitespaces being allowed between thematic break
characters.  The characters difference was easily taken care of by adding:</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">start_char</span> <span class="o">==</span> <span class="s2">"-"</span><span class="p">:</span>
</pre></div>
<p>after the call to the <code>is_thematic_break</code> function.  The indentation was also easy
to mitigate by simply not extracting any whitespace from the source string and passing
in an empty string (<code>""</code>) for the extracted whitespace.<sup id="fnref:commonIssue"><a class="footnote-ref" href="#fn:commonIssue">1</a></sup>
The whitespace issue took a bit more finessing.  To deal with that, I modified the
<code>is_thematic_break</code> function by adding a switch called
<code>whitespace_allowed_between_characters</code>.  This allowed the calling function to specify
whether whitespaces were allowed between the characters.</p>
<p>Once there was a valid start to the front-matter section, the
<code>__handle_document_front_matter</code> function was called to handle the rest of the processing.
This enabled me to keep the <code>process_header_if_present</code> function focused on the external
processing of the front-matter section itself.  When the
<code>__handle_document_front_matter</code> function returned, there were only two possibilities.
If a Front Matter token was created, it was added to the document.
Otherwise, if for any reason it failed, every line that was used in determining that the
Front Matter token could not be created was requeued for reprocessing.  That encapsulation
kept things nice and clean.</p>
<h3 id="implementing-the-interesting-stuff">Implementing The Interesting Stuff<a class="headerlink" href="#implementing-the-interesting-stuff" title="Permanent link">¶</a></h3>
<p>Once there was a Front Matter element start fence was detected, it was up to the
<code>__handle_document_front_matter</code> function to collect and validate any front-matter that
was collected.  This meant collecting lines until such time as a blank line or a closing
fence was encountered.  With my initial rule of having the start fence and the end fence
containing the same number of characters, the code simply had to check to see if it
encountered the same fence twice: once at the start and once at the end.</p>
<p>When the end fence was encountered, the processing was passed off to the
<code>__is_front_matter_valid</code> function to determine if the lines formed a valid front-matter
section and to create a dictionary of those values if it did. The logic for this
initial version of the Front Matter token was very simple.  If the number of spaces were
4 or more, add it to the last line.  If not, check to see if it started with a valid
property name.  Any errors along the way aborted the validation, with a good reason
returned to the caller indicating why it was aborted.</p>
<p>Finally, upon return to the <code>__handle_document_front_matter</code> function with a valid
dictionary of values, the <code>FrontMatterMarkdownToken</code> instance was created.  Following
in the steps of other tokens, it was easy to add all the required fields and properties
needed by the token.</p>
<h2 id="rounding-out-the-feature">Rounding Out The Feature<a class="headerlink" href="#rounding-out-the-feature" title="Permanent link">¶</a></h2>
<p>When I was adding the bulk of this feature, I commented out the parts of the scenario
tests that validated the HTML support, the Markdown support, and the consistency checks.
With all the scenario tests passing, I uncommented those parts and cleaned them up.</p>
<h3 id="adding-html-support">Adding HTML Support<a class="headerlink" href="#adding-html-support" title="Permanent link">¶</a></h3>
<p>Even though the Front Matter token does not generate any HTML output, I still
needed to add the proper code to deal with adding nothing to the HTML output.
To do this, I added the following code to the <code>transform_to_gfm.py</code> module:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymarkdown.extensions.front_matter_markdown_token</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FrontMatterExtension</span><span class="p">,</span>
    <span class="n">FrontMatterMarkdownToken</span><span class="p">,</span>
<span class="p">)</span>
    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_handlers</span><span class="p">(</span>
        <span class="n">FrontMatterMarkdownToken</span><span class="p">,</span> <span class="n">FrontMatterExtension</span><span class="o">.</span><span class="n">handle_front_matter_token</span>
    <span class="p">)</span>
</pre></div>
<p>The <code>handle_front_matter_token</code> function was simple, as it had to do nothing:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handle_front_matter_token</span><span class="p">(</span><span class="n">output_html</span><span class="p">,</span> <span class="n">next_token</span><span class="p">,</span> <span class="n">transform_state</span><span class="p">):</span>

    <span class="n">_</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_token</span><span class="p">,</span> <span class="n">transform_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_html</span>
</pre></div>
<h3 id="adding-markdown-rehydration-support">Adding Markdown Rehydration Support<a class="headerlink" href="#adding-markdown-rehydration-support" title="Permanent link">¶</a></h3>
<p>While this was not exactly like adding the HTML support, there were a lot of
similarities.  Instead of adding code to the <code>transform_to_gfm.py</code> module, code
was added to the <code>transform_to_markdown.py</code> module:</p>
<div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">register_handlers</span><span class="p">(</span>
        <span class="n">FrontMatterMarkdownToken</span><span class="p">,</span> <span class="n">FrontMatterExtension</span><span class="o">.</span><span class="n">rehydrate_front_matter</span>
    <span class="p">)</span>
</pre></div>
<p>As PyMarkdown tokens capture all the information pertaining to how that token was
created, it was easy to write the rehydrate function:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rehydrate_front_matter</span><span class="p">(</span><span class="n">current_token</span><span class="p">,</span> <span class="n">previous_token</span><span class="p">):</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">previous_token</span>

    <span class="n">front_matter_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_token</span><span class="o">.</span><span class="n">boundary_line</span><span class="p">]</span>
    <span class="n">front_matter_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">current_token</span><span class="o">.</span><span class="n">collected_lines</span><span class="p">)</span>
    <span class="n">front_matter_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">current_token</span><span class="o">.</span><span class="n">boundary_line</span><span class="p">,</span> <span class="s2">""</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">newline_character</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">front_matter_parts</span><span class="p">)</span>
</pre></div>
<h3 id="adding-consistency-check-support">Adding Consistency Check Support<a class="headerlink" href="#adding-consistency-check-support" title="Permanent link">¶</a></h3>
<p>While I am sure that I will have to add more functions later, when adding this extension,
there were only two functions that I needed to add: <code>__validate_block_token_height</code> and
<code>__calc_initial_whitespace</code>.  Both the <code>__validate_block_token_height</code> function and the
<code>__validate_first_token</code> function are a long series of <code>if</code> statements that probably
need refactoring.  But the immediate need was to enable the Front Matter token to be
handled properly by these functions.</p>
<p>In both cases, I used the <code>is_extension</code> property of the token to indicate that the token
itself would calculate these values.  For the <code>__validate_block_token_height</code> function,
I added this code at the start of the <code>if</code> statement chain:</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">last_token</span><span class="o">.</span><span class="n">is_extension</span><span class="p">:</span>
        <span class="n">token_height</span> <span class="o">=</span> <span class="n">last_token</span><span class="o">.</span><span class="n">calculate_block_token_height</span><span class="p">(</span><span class="n">last_token</span><span class="p">)</span>
</pre></div>
<p>and for the <code>__calc_initial_whitespace</code> function, I added this code:</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">calc_token</span><span class="o">.</span><span class="n">is_extension</span><span class="p">:</span>
        <span class="n">indent_level</span><span class="p">,</span> <span class="n">had_tab</span> <span class="o">=</span> <span class="n">calc_token</span><span class="o">.</span><span class="n">calculate_initial_whitespace</span><span class="p">()</span>
</pre></div>
<p>The bodies were easy to fill out because the token is so simple:</p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">calculate_block_token_height</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">last_token</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_token</span><span class="o">.</span><span class="n">collected_lines</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">calculate_initial_whitespace</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">False</span>
</pre></div>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>Let me get the good things out of the way first.  It was easy to add the new
Front Matter token, even in a raw form.  While I realize that this token is a very
easy token to add, I was able to add it cleanly and with only minimal issues.  Hopefully,
this means that adding future extensions will be somewhat easy, even if they are not as
easy as this feature.  In addition, the changes to the HTML generator, the Markdown
generator, and the consistency checks were very easy to add.  Once again, that bodes
well for future extensions.  But even so, I was cognizant that most of the ease of
adding this feature came from the fact that this new token is very specialized and
only occurs at the start of the document.  So, I hope things will be good going forward,
but I also realize that I got lucky in this case.  For now, that is a good mindset for
me to have.</p>
<p>While the bad things is not a really big bad thing, it is still something that I mostly
missed implementing in a real fashion: application configuration.  I have little bits and
pieces of it wired in as dictionaries containing hierarchical structures, I do not have
a good start to end story around application configuration that I can live with.  And
after a few searches for “Python application configuration”, it seems that there are no
easy answers to this need.  That means I will need to write something.  A bit of a miss,
but I can recover from it.</p>
<p>After taking a bit of a break when writing this article, I reread the above two paragraphs
and realized something that put both paragraphs into a new perspective.  While I was
previously looking at the Front Matter token as present and configuration as “should have
been done in the past”, I believe I had the time frames wrong.  With my new viewpoint,
I realized that I am adding the Front Matter token because I want to use the project now,
and both parts help me accomplish that goal.  In essence, these are both concepts that
are needed for a release.  If I am now worrying about them, it means the release is near!</p>
<p>Sometimes, it just takes a bit of a break and a fresh point of view.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>As the Front Matter token is non-GFM compliant, I need to make sure that I have a decent
way to enable it when needed.  Next up, application configuration.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:commonIssue">
<p>During various points in development, a common issue was the improper passing of the correct whitespace to functions like this.  It was neat using this “issue” as a positive for once. <a class="footnote-backref" href="#fnref:commonIssue" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Road%20To%20Initial%20Release%20-%20Front-Matter&url=https%3A//jackdewinter.github.io/2021/03/15/markdown-linter-road-to-initial-release-front-matter/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2021/03/15/markdown-linter-road-to-initial-release-front-matter/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Road%20To%20Initial%20Release%20-%20Front-Matter&amp;body=https%3A//jackdewinter.github.io/2021/03/15/markdown-linter-road-to-initial-release-front-matter/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2021/03/15/markdown-linter-road-to-initial-release-front-matter/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-road-to-release-f"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2021/03/08/markdown-linter-road-to-initial-release-cleaning-up-the-list-and-readability/" title="Previous: Markdown Linter - Road To Initial Release - Cleaning Up The List and Readability">Markdown Linter - Road To Initial Release - Cleaning Up The List and Readability</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2021/03/22/markdown-linter-road-to-initial-release-configuration/" title="Next: Markdown Linter - Road To Initial Release - Configuration">Markdown Linter - Road To Initial Release - Configuration</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~16 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2021-03-15T00:00:00-07:00">Mar 15, 2021</time>
        <h4>Markdown Linter Road To Initial Release</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2021/02/08/markdown-linter-road-to-initial-release-learned-and-useful-things/" title="Markdown Linter - Road To Initial Release - Learned and Useful Things">Part 1: Markdown Linter - Road To Initial Release - Learned and Useful Things</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/02/15/markdown-linter-road-to-initial-release-refactoring/" title="Markdown Linter - Road To Initial Release - Refactoring">Part 2: Markdown Linter - Road To Initial Release - Refactoring</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/02/22/markdown-linter-road-to-initial-release-starting-performance/" title="Markdown Linter - Road To Initial Release - Starting Performance">Part 3: Markdown Linter - Road To Initial Release - Starting Performance</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/03/01/markdown-linter-road-to-initial-release-measured-performance-increases/" title="Markdown Linter - Road To Initial Release - Measured Performance Increases">Part 4: Markdown Linter - Road To Initial Release - Measured Performance Increases</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/03/08/markdown-linter-road-to-initial-release-cleaning-up-the-list-and-readability/" title="Markdown Linter - Road To Initial Release - Cleaning Up The List and Readability">Part 5: Markdown Linter - Road To Initial Release - Cleaning Up The List and Readability</a>
            </li>
            <li  class="active-part">
            Part 6: Markdown Linter - Road To Initial Release - Front-Matter
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/03/22/markdown-linter-road-to-initial-release-configuration/" title="Markdown Linter - Road To Initial Release - Configuration">Part 7: Markdown Linter - Road To Initial Release - Configuration</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/03/29/markdown-linter-road-to-initial-release-command-lines/" title="Markdown Linter - Road To Initial Release - Command Lines">Part 8: Markdown Linter - Road To Initial Release - Command Lines</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/04/05/markdown-linter-road-to-initial-release-cleaning-up/" title="Markdown Linter - Road To Initial Release - Cleaning Up">Part 9: Markdown Linter - Road To Initial Release - Cleaning Up</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/04/12/markdown-linter-road-to-initial-release-creating-a-package/" title="Markdown Linter - Road To Initial Release - Creating A Package">Part 10: Markdown Linter - Road To Initial Release - Creating A Package</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/04/19/markdown-linter-road-to-initial-release-gearing-up-for-plugins/" title="Markdown Linter - Road To Initial Release - Gearing Up For Plugins">Part 11: Markdown Linter - Road To Initial Release - Gearing Up For Plugins</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/05/03/markdown-linter-road-to-initial-release-finalizing-plugins/" title="Markdown Linter - Road To Initial Release - Finalizing Plugins">Part 12: Markdown Linter - Road To Initial Release - Finalizing Plugins</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/05/10/markdown-linter-road-to-initial-release-fine-tuning-plugins/" title="Markdown Linter - Road To Initial Release - Fine Tuning Plugins">Part 13: Markdown Linter - Road To Initial Release - Fine Tuning Plugins</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/05/17/markdown-linter-road-to-initial-release-dotting-the-is/" title="Markdown Linter - Road To Initial Release - Dotting The Is">Part 14: Markdown Linter - Road To Initial Release - Dotting The Is</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/05/24/markdown-linter-road-to-initial-release-crossing-the-ts/" title="Markdown Linter - Road To Initial Release - Crossing The Ts">Part 15: Markdown Linter - Road To Initial Release - Crossing The Ts</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/05/31/markdown-linter-road-to-initial-release-triple-check-everything/" title="Markdown Linter - Road To Initial Release - Triple Check Everything">Part 16: Markdown Linter - Road To Initial Release - Triple Check Everything</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>92</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>110</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2021 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>