<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Introduction¶ For any readers that have been waiting with bated breath since last week when I posted my article titled “Markdown Linter - Rules - Headings - Part 1”, I will now break the suspense. This week’s article is titled… drum roll please… “Markdown Linter - Rules - Headings - Part 2”. Yeah, I know …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, linter rules, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Rules - Headings - Part 2 "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/" />
<meta property="og:description" content="Introduction¶ For any readers that have been waiting with bated breath since last week when I posted my article titled “Markdown Linter - Rules - Headings - Part 1”, I will now break the suspense. This week’s article is titled… drum roll please… “Markdown Linter - Rules - Headings - Part 2”. Yeah, I know …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-05-25T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Rules - Headings - Part 2 ">
<meta name="twitter:description" content="Introduction¶ For any readers that have been waiting with bated breath since last week when I posted my article titled “Markdown Linter - Rules - Headings - Part 1”, I will now break the suspense. This week’s article is titled… drum roll please… “Markdown Linter - Rules - Headings - Part 2”. Yeah, I know …">

        <title>Markdown Linter - Rules - Headings - Part 2  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/">
                Markdown Linter - Rules - Headings - Part 2
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#dealing-with-an-omission">Dealing with An Omission</a></li>
<li><a href="#and-now-more-rules">And Now, More Rules</a></li>
<li><a href="#rule-md023-headings-must-start-at-the-beginning-of-the-line">Rule MD023 - Headings must start at the beginning of the line</a><ul>
<li><a href="#why-does-this-rule-make-sense">Why Does This Rule Make Sense?</a></li>
<li><a href="#adding-the-rule">Adding the Rule</a></li>
</ul>
</li>
<li><a href="#rule-md024-multiple-headings-with-the-same-content">Rule MD024 - Multiple headings with the same content</a><ul>
<li><a href="#why-does-this-rule-make-sense_1">Why Does This Rule Make Sense?</a></li>
<li><a href="#adding-the-rule_1">Adding the Rule</a></li>
</ul>
</li>
<li><a href="#rule-md026-trailing-punctuation-in-heading">Rule MD026 - Trailing punctuation in heading</a><ul>
<li><a href="#why-does-this-rule-make-sense_2">Why Does This Rule Make Sense?</a><ul>
<li><a href="#aside-so-why-keep-it-like-that">Aside: So, Why Keep It Like That?</a></li>
</ul>
</li>
<li><a href="#adding-the-rule_2">Adding the Rule</a></li>
</ul>
</li>
<li><a href="#rule-md036-emphasis-used-instead-of-a-heading">Rule MD036 - Emphasis used instead of a heading</a><ul>
<li><a href="#why-does-this-rule-make-sense_3">Why Does This Rule Make Sense?</a></li>
<li><a href="#adding-the-rule_3">Adding the Rule</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>For any readers that have been waiting with bated breath since last week when I posted
my article titled “Markdown Linter - Rules - Headings - Part 1”, I will now break the
suspense.  This week’s article is titled… drum roll please…</p>
<p>“Markdown Linter - Rules - Headings - Part 2”.</p>
<p>Yeah, I know, the title is terribly unoriginal, but like the previous article, there is
nothing special about this article except that it details the second group of
heading rules that I am creating.</p>
<p>With this group of rules completed, except for the two rules mentioned in
<a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/#what-about-those-two-rules-that-were-left-out">the previous article</a>,
every rule in the initial heading rules group will be completed.  Even though I know
these rules will not be the last group of rules that I write, the writing of these
rules serves an important purpose.  The process of writing these rules will help to
paint a reliable picture of the stability of the project at this point.  This picture
will then allow me to determine whether writing more rules or fixing some issues is the
best course of action for the project.</p>
<p>To be clear, I am not pro-rules nor am I pro-issues, I am pro-project.  If the
picture that emerges gives me a level of confidence with which to write more rules, so
be it.  If that level of confidence is not achieved, then I will address any issues
that I feel are getting in the way of me being able to add more rules with confidence.
Basically, the tests and the issues provide me data, and I will interpret that data to
determine the proper next step.  Simple.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/006eed187e212bb2c425ebebe1202193be327708">28 April 2020</a> and
<a href="https://github.com/jackdewinter/pymarkdown/commit/816a1fb5fcf07c765ee3858e5d9292129800478c">02 May 2020</a>.</p>
<h2 id="dealing-with-an-omission">Dealing with An Omission<a class="headerlink" href="#dealing-with-an-omission" title="Permanent link">¶</a></h2>
<p>As I started to write this article, I went over the 15 different rules that I know
contain headings: 3 in the
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/">“First Three” article</a>,
5 in
<a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/">the last article</a>,
2 rules
<a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/#what-about-those-two-rules-that-were-left-out">to skip</a>,
and 4 rules in this article.  Huh?  I double checked my numbers, and as far as my math
is concerned, 3 + 5 + 2 + 4 = 14.  Where did the missing rule go?</p>
<p>At the end of implementing the last rule group, I determined that the development of
<a href="https://github.com/DavidAnson/markdownlint/blob/master/doc/Rules.md#md025---multiple-top-level-headings-in-the-same-document">rule MD025</a>
needed to be put on hold, for the same reasons as
<a href="https://github.com/DavidAnson/markdownlint/blob/master/doc/Rules.md#md041---first-line-in-file-should-be-a-top-level-heading">rule MD041</a>:
YAML front matter.  Rule MD025 exists to make sure that there is one and only one
top-level heading present in each document. The description for rule MD041 allows that
top-level heading to be specified in the metadata for the file, and the plan for rule
MD025 is to follow that same pattern.  As rule MD041 was put on hold until that
metadata support is added, it only makes sense that rule MD025 is also put on hold
pending the addition of that same metadata support.</p>
<h2 id="and-now-more-rules">And Now, More Rules<a class="headerlink" href="#and-now-more-rules" title="Permanent link">¶</a></h2>
<p>With this group of 4 rules, the total number of implemented heading rules will
be 12.  I believe that is a good sampling of rules with which to decide whether to
fix more issues or create new rules.  To that extent, let’s go!</p>
<h2 id="rule-md023-headings-must-start-at-the-beginning-of-the-line">Rule MD023 - Headings must start at the beginning of the line<a class="headerlink" href="#rule-md023-headings-must-start-at-the-beginning-of-the-line" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_023.py">Rule MD023</a>.</p>
<h3 id="why-does-this-rule-make-sense">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense" title="Permanent link">¶</a></h3>
<p>For this rule, the first answer that popped into my mind was the usual answer:
consistency. According to the GFM specification, there is no syntactic difference
between:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">Heading</span>
</pre></div>
<p>and</p>
<div class="highlight"><pre><span></span>   <span class="o">#</span> <span class="n">Heading</span>
</pre></div>
<p>As they are equivalent, just like with previous rules, it makes sense to use the simpler
form of the heading to keep things consistent.</p>
<p>However, on a more thorough examination, a better purpose for this rule is
compatibility.  While I recognize that the initial parser features and tests are based
on the
<a href="https://github.github.com/gfm/">GFM specification</a>,
knowing where other parsers diverge from that specification allows me to start thinking
about future “tunings” for the project.  I do not know how possible it is, but I am
wondering if I can tune PyMarkdown’s output based on a profile set up for a given
Markdown parser being used.  While this is still in the “far-future thinking” stage,
one of the pieces of data I need to understand for that endeavor is how far from my
chosen base specification are the specifications for those other parsers.</p>
<p>To get an idea of how compatible a normal Atx heading is across parsers, I submitted
the text <code># Heading 1</code> to
<a href="https://johnmacfarlane.net/babelmark2/?text=%23+Heading+1%0A%0A">Babelmark</a><sup id="fnref:Babelmark"><a class="footnote-ref" href="#fn:Babelmark">1</a></sup>.
Except for the presence of an <code>id</code> attribute in the <code>h1</code> tag (and that
attribute’s value varying only slightly), the results were the same across all the
parsers,
indicating wide compatibility. When I added 2 spaces at the start of the text and
submitted that text to
<a href="https://johnmacfarlane.net/babelmark2/?text=++%23+Heading+1%0A%0A">Babelmark</a>,
only 12 out of the 31 available parsers interpreted the line as an Atx heading.  With
only 39% of the parsers at Babelmark recognizing the changed text as an Atx heading,
it was far from being widely compatible.</p>
<p>Based on those results, for the sake of compatibility, it made sense to create a rule
to recommend the removal of
any whitespace at the start of an Atx heading line.  While a standard GFM
Markdown parser will treat it properly, with less than half of the sampled parsers
handling it properly, it just made sense to avoid that extra
whitespace.  If PyMarkdown tuning is a feature that I add in the future, I can always
revisit this rule and make it aware of the added tuning.  As that feature is currently
only a maybe, a current, solid rule for headings means no spaces at the start of
heading lines.</p>
<h3 id="adding-the-rule">Adding the Rule<a class="headerlink" href="#adding-the-rule" title="Permanent link">¶</a></h3>
<p>Adding the code to implement this rule was trivial.  The rule simply looks at the
<code>extracted_whitespace</code> field of the Atx heading token where the captured whitespace
from before the start of the Atx heading is stored.  If the value of
<code>extracted_whitespace</code> is not empty, whitespace is present, and the rule fails.</p>
<p>Using the process from the previous section to test Markdown samples with multiple
parsers, I then tested variations of SetExt headings like:</p>
<div class="highlight"><pre><span></span><span class="n">My</span> <span class="n">heading</span>
<span class="c1">----------</span>
</pre></div>
<p>where there was extra spacing at the start of the first line, the second line, or both
lines.  In each of those cases, the results showed that there was at least one parser
that did not recognize it as a proper SetExt heading.  If I want a linter that can
be useful for a wide variety of parsers, the failure of one parser to recognize
the above text as a SetExt heading is still somewhat of a failure.</p>
<p>To deal with whitespace before SetExt headings, only a small amount of extra parsing
was required above what was added for the Atx headings.  When the SetExt token is
observed, that token is stored in the
<code>setext_start_token</code> variable, with the storing of the presence of any leading
whitespace in the <code>any_leading_whitespace_detected</code> variable.  As Text tokens are
observed, if the
<code>any_leading_whitespace_detected</code> variable has not already been set, a simple
decomposition of the text is performed to look for leading whitespace on each line, the
<code>any_leading_whitespace_detected</code> variable being set to <code>True</code> if any whitespace is
found.  Finally, when the SetExt’s end token is observed, one final check is made
against the end token for whitespace.  When that is complete, if any whitespace was
detected in any of these three phases, the rule fails with the value stored in the
<code>setext_start_token</code> variable being used as the failure token.</p>
<p>The code for implementing this rule, the tests, and test data were all trivial.  Once I
understood the constraints that I needed for the rule, it was easy to
translate those constraints into test data and source code.  Perhaps I am a bit jaded
in my viewpoint, but after implementing 8 other rules for headings, adding this rule
was just easy.</p>
<p>The real interesting part about implementing this rule was using Babelmark and looking
at the output from the various parsers.  Seeing the different HTML variations that
arose from the different interpretations of a single Markdown element made it clearer to
me why the GFM specification was written.  If there is not a single, clear picture of
how parsers translate Markdown into HTML, the authors start to get confused, tailoring
their use of Markdown to a specific parser and its output. Seeing that Babelmark output
just really drove that point home for me.</p>
<h2 id="rule-md024-multiple-headings-with-the-same-content">Rule MD024 - Multiple headings with the same content<a class="headerlink" href="#rule-md024-multiple-headings-with-the-same-content" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_024.py">Rule MD024</a>.</p>
<h3 id="why-does-this-rule-make-sense_1">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense_1" title="Permanent link">¶</a></h3>
<p>If the parser is following the GFM specification exactly or is a bare bones parser,
this rule does not make any sense.  When presented with Markdown such as:</p>
<div class="highlight"><pre><span></span>## <span class="k">Next</span> <span class="nv">Heading</span>

<span class="nv">some</span> <span class="nv">text</span>

## <span class="k">Next</span> <span class="nv">Heading</span>

<span class="nv">some</span> <span class="nv">text</span>
</pre></div>
<p>the parser will generate HTML that is close to the following:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Next Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>some text<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Next Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>some text<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>However, either through its own configuration or through a plugin, most Markdown
parsers allow for a
mode in which some transformation of the heading text is added to the <code>&lt;h2&gt;</code> tag,
usually in an <code>id</code> attribute.  Some parsers go
further than that, providing an anchor point allowing the reader to navigate directly
to the heading by using a full URL with the contents of the <code>href</code> attribute after the
normal part of the URL.</p>
<p>Once such example is this HTML, which was rendered by one of the parsers for the
first heading in the previous sample:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span> <span class="na">id</span><span class="o">=</span><span class="s">"h2-next-heading"</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">"user-content-next-heading"</span> <span class="na">class</span><span class="o">=</span><span class="s">"anchor"</span> <span class="na">href</span><span class="o">=</span><span class="s">"#next-heading"</span><span class="p">&gt;</span>
Next Heading
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</pre></div>
<p>This kind of generated HTML output is popular for two main reasons.  First, various
combinations
of the heading tag’s <code>id</code> attribute, the anchor tag’s class, and the anchor tag’s <code>id</code>
attribute allow for stylesheets to be applied to the generated page in a clean and
unambiguous manner.
Secondly,
assuming that the normal URL to the page is <code>https://www.website.com/that-page.html</code>,
since the <code>href</code> attribute for the anchor tag is specified as <code>#next-heading</code>, the
reader can go directly to that section on the page by using the URL
<code>https://www.website.com/that-page.html#next-heading</code>.  This concept is so useful that
multiple “Table of Contents” plugins that I looked at required another plugin to
already be enabled that provides this information that is the repurposed by the Table
of Contents plugin.</p>
<p>Specifically related to this rule, the part that I want to focus on is the generation
of the <code>id</code> attributes and the
<code>href</code> attribute.  If a naïve generator implementation is used, the heading text
<code>Next Heading</code> will always be reduced to some form of the text <code>next-heading</code>, without
any regard for duplicates.  When a more advanced implementation is used, the plugin
remembers that it has already generated the text <code>next-heading</code> for the current
document.  To avoid any duplication, when the parser goes to generate another instance
of a heading <code>id</code> based on the text <code>Next Heading</code>, it generates it as normal but also
appends a suffix to the generated text, usually something like <code>-1</code> to keep the
generated ids unique.</p>
<p>Because Markdown parsers are not guaranteed to perform the proper, advanced generator
implementation, this rule plays it safe by failing when it detects heading text that is
duplicated.  However, to provide further configuration for more compliant parsers,
this rule
can also be set to only fail the rule in cases where sibling heading elements have
the same name.  While it is not stated, my guess is that some parsers include extra
information in their generated ids that only causes duplication issues when sibling
headings have the same text.</p>
<h3 id="adding-the-rule_1">Adding the Rule<a class="headerlink" href="#adding-the-rule_1" title="Permanent link">¶</a></h3>
<p>Using the default configuration, the evaluation for this rule is
very simple.  When an Atx heading token or a SetExt heading token is observed, the
rule starts collecting the text until it encounters the appropriate end token.  At
that point, one of two things happen.  If this is the first time that text has been
seen, it is saved in a dictionary that is cleared at the start of each document.  If it
is not the first time that the text has been seen, the rule fails.  Simple and clear
cut.</p>
<p>If this rule’s configuration is changed to only search for duplicates in siblings,
a small amount of a change is required in the algorithm, but not much.  The first
change is that each of the 6 levels of headings must have its own dictionary. Instead
of looking up the collected text in a single dictionary, the text is looked for in the
dictionary assigned to its heading level.  Basically, if a heading is a level
2 heading, then it needs to verify against the level 2 heading dictionary, and so on.
As the heading level that determines which dictionary to use is an integer, it made
sense to create an
array that contains 6 dictionaries, one for each heading level and initialized to an
empty dictionary for each new document.</p>
<p>With those changes in place, a bit of working through multiple scenarios provided the
rest of the answers. For the increasing heading level case, consider the general case
of:</p>
<div class="highlight"><pre><span></span><span class="o">##</span> <span class="k">Level</span> <span class="mi">2</span>
<span class="o">###</span> <span class="k">Level</span> <span class="mi">3</span>
</pre></div>
<p>While it is appropriate to only increase the heading level by 1, hence the creation of
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/#rule-md001-incrementing-heading-levels">rule MD001</a>,
the general case for this rule applies to any increase in heading levels.  When
going to the new heading level, the level’s dictionary must be cleared to ensure that
any previous headings do not pollute the rule’s sense of duplication.  If multiple
levels are involved, it makes logical  sense to clear all the dictionaries up to and
including the new heading level.</p>
<p>The other case to consider is where the heading levels decrease, such as with:</p>
<div class="highlight"><pre><span></span><span class="o">###</span> <span class="k">Level</span> <span class="mi">3</span>
<span class="o">##</span> <span class="k">Level</span> <span class="mi">2</span>
</pre></div>
<p>Once again, the general case for this applies to any decrease in heading levels.  As
the new <code>Level 2</code> heading is separated from any previous level 2 headings by the
<code>### Level 3</code> heading, those headings are no longer considered siblings.  As such,
when moving to the lower levels, the dictionaries must be cleared down to and including
the new heading level.</p>
<p>Other than figuring out the logic for this rule, and taking a while to do it, the rest
of the coding for this rule went smoothly.  While the new algorithm based on that logic
took longer to figure out than I hoped it would, it was useful to be able to have the
test data and test cases on hand from VSCode’s output.  Taking the information from
the <code>Problems</code> window of that editor saved a lot of time when coded into my tests for
this rule.  I did have a couple of false starts but knowing that the algorithm passed
the tests using the VSCode derived test data really increased my confidence that I got
the algorithm right.</p>
<h2 id="rule-md026-trailing-punctuation-in-heading">Rule MD026 - Trailing punctuation in heading<a class="headerlink" href="#rule-md026-trailing-punctuation-in-heading" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_026.py">Rule MD026</a>.</p>
<h3 id="why-does-this-rule-make-sense_2">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense_2" title="Permanent link">¶</a></h3>
<p>This rule seems to be largely derived from Ciro Santilli’s
<a href="https://cirosantilli.com/markdown-style-guide#punctuation-at-the-end-of-headers">Markdown Style Guide</a>.
In this document, Ciro claims that headings are not complete sentences, and as such,
should not
end with punctuation.  Specifically, his examples show very good cases for
not ending a heading with the <code>:</code> character or the <code>.</code> character.  My best guess is
that David Anson, when creating his rule based on that document, wanted to allow his
linter’s users to be able to extend this concept to include any headings that end
with a set of common punctuation characters. As such, the default for David’s rule is
to fail the rule if any heading ends with any of the <code>.,;:!?。，；：！？</code> characters,
and that set of characters can be easily changed with configuration.</p>
<p>While I do not completely agree with this rule, I do agree with the premise
behind the rule: headings should never be considered complete sentences.  To properly
describe that statement and how it applies to various headings, I needed to
brush up on my English grammar rules.  Even though it has been a few years since I
was in high school, I was quickly able to find a good solid definition:</p>
<blockquote>
<p>a complete sentence starts with a capital letter, ends with a punctuation character, and expresses a complete thought.</p>
</blockquote>
<p>Using that definition as a rubric, I feel it is useful to demonstrate how that rule
applies to the headings in my own documents.  For this comparison, I used the layout
of the current section of this article as a good example of how to conceptually apply
this rule.</p>
<p>For each rule in this section, the level 2 heading is always the id of the
rule followed by the description.  In the case of this rule, that heading is
<code>Rule MD026 - Trailing punctuation in heading</code>.  That heading is not a valid
sentence because it is not a complete thought and does not end with punctuation.
The level 3 heading following this section is <code>Adding the Rule</code>.  There is a bit more
nuance involved with that heading, as I can easily argue that it can be interpreted as
a complete sentence, just a very weak one.  The saving grace for that heading is that
it does not end with punctuation, so it is not advertising itself as a complete
sentence.</p>
<p>That leaves the heading for this section which is <code>Why Does This Rule Make Sense?</code>. When
I first looked at my grammar references for this, it seemed to fail at every point.
It starts with a capital letter, ends with punctuation, and looks like a complete
sentence.  Yes, I said “looks”… and it took me a bit to get there as well.  Remember
above when I said that a complete sentence expresses a complete thought?  That is where
context comes in.  Without the context imposed by this document, the obvious question
to ask is “What rule?”.  Because I tied the context of the heading to document’s
structure, it is not a complete thought unless it remains in the document. As it is not
a complete thought on its own, it narrowly fails the complete sentence test.</p>
<h4 id="aside-so-why-keep-it-like-that">Aside: So, Why Keep It Like That?<a class="headerlink" href="#aside-so-why-keep-it-like-that" title="Permanent link">¶</a></h4>
<p>I know that using partial questions as headings is not a popular choice, and I know it
narrowly fails the complete sentence test.  So why keep it?</p>
<p>For me, it all boils down to using my own voice in my writing, and the authenticity of
my writing in that voice.  For each of these rules, if I were reading someone else’s
document, I would ask two questions:</p>
<ul>
<li>Why is it good to do this?</li>
<li>What did it take to do this?</li>
</ul>
<p>Wording the second question as a statement is relatively easy.  Instead of “What did it
take to do this?” I used the heading “Adding the Rule”.  It is not glamourous, but it
concisely and accurately conveys the image that I want to convey for that section.</p>
<p>For the first question, I struggled for a long while trying to rephrase that question
as anything other than a question, and it just did not seem correct.  It either was
missing something, or it just felt like something that I would not say unless I was
prompted to.  So instead of
settling for something that I was not confident about, I opted for using a question that
did capture the essence that I wanted in a heading for that section.</p>
<p>And yes, I purposefully worded the heading of this section to emphasize that point.
That, and it is the kind of question I would ask myself if I was reading someone else’s
article.</p>
<h3 id="adding-the-rule_2">Adding the Rule<a class="headerlink" href="#adding-the-rule_2" title="Permanent link">¶</a></h3>
<p>At this point in the development of heading rules, I believe the term “ditto” is
appropriate.  Like a fair number of the rules before this one, any text that
is seen between either the Atx heading token or the SetExt heading token is collected
for later examination.  As that process of collecting the heading text has been
well documented in the other rules, I will avoid documenting it from here on out,
assuming that avid readers already know it fairly well, instead focusing on the
unique bits and differences in the algorithms.</p>
<p>Once the heading text is collected and the heading’s end token is encountered, 
the rule’s comparison logic is then activated.  Quite simply, when the end token is
encountered, the
last text character of the collected text is checked against the configured set of
punctuation characters.  If there is a match, the rule fails.  If configuration is
provided to change the set of punctuation characters to check against, the check
is simply performed against that list of characters instead of the default list.</p>
<p>At first, I was a bit let down that I saw this as being a simple rule, as the both
the code and testing for this rule were very trivial.  While I was initially
disappointed, after a while I was able to see it as a good thing. One benefit that I
started to see is that if these rules are performing a consistent action, it reduces
the chance that I am going to get the logic wrong.  Perhaps more obvious to me is the
benefit that if the logic is indeed very similar, it may be encapsulated into a base
class or helper class in a future refactoring, thereby reducing the maintenance costs.</p>
<p>When I realized what those benefits were, I became okay with this rule being a mundane
rule to write.  Mundane equals refactorable equals lower maintenance.</p>
<h2 id="rule-md036-emphasis-used-instead-of-a-heading">Rule MD036 - Emphasis used instead of a heading<a class="headerlink" href="#rule-md036-emphasis-used-instead-of-a-heading" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_036.py">Rule MD036</a>.</p>
<h3 id="why-does-this-rule-make-sense_3">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense_3" title="Permanent link">¶</a></h3>
<p>This rule is another rule that was largely derived from Ciro Santilli’s
<a href="https://cirosantilli.com/markdown-style-guide#emphasis-vs-headers">Markdown Style Guide</a>.
If I had to guess, it seems that Ciro had seen cases where people were using
emphasis as headings in Markdown documents, something that is confusing.  Doing a bit
of easy research, most Markdown tutorial sites, such as
<a href="https://www.markdowntutorial.com/">Markdown Tutorial</a>,
address headings in their first 3 lessons.   For people who may ignore tutorials and
go straight to cheat sheets, both
<a href="https://www.markdownguide.org/cheat-sheet">Markdown Guide’s Cheat Sheet</a> and
<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Adam Pritchard’s Cheatsheet</a> deal with headings on their first page where they are immediately
visible. From this research alone, it is hard to figure out why someone would use
emphasis over headings.  However, I started wondering if perhaps there were historical
reasons for this rule?</p>
<p>If you start looking at the tutorials and cheat sheets from a different angle,
perhaps the historical angle to justify this rule does make sense.  Perhaps these
distinct sources put
headings near the start of their documents because people were not using headings
properly at the time that those documents were written.
Thinking as an author, by putting headings near the start of the tutorial or cheat
sheet, I would expect that placement to strongly hint that they are important and
should be looked at before going with the rest of the document.</p>
<p>To explore that concept further, I assumed that I did not know about headings, forcing
me to theorize on how to make a heading-like element would work.  Trying to forget
about this rule, I started working on a list of the elements that I could use.
With headings out of the picture, and every one of the other blocks having a very
distinct purpose, that left only inline elements.  Line breaks are not immediately
visible, and links are really meant for navigation, so they were removed from the
possibilities list early on.  That left backslashes, character references, code spans,
and emphasis. Out of those 4, only the emphasis made sense to use to draw attention to
some text.</p>
<p>Based on those restrictions, the best heading-like element that I came up with was this
example:</p>
<div class="highlight"><pre><span></span><span class="o">*</span><span class="n">My</span> <span class="k">Not</span> <span class="n">So</span> <span class="n">Heading</span><span class="o">*</span>

<span class="k">More</span> <span class="nb">text</span>
</pre></div>
<p>What a surprise! That is exactly what this rule is looking for.  In particular:</p>
<ul>
<li>the paragraph is a single line, surrounded by emphasis</li>
<li>the contents of the paragraph are only simple text, no inline Markdown except for the surrounding emphasis</li>
<li>for the same reasons as
<a href="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/#rule-md026-trailing-punctuation-in-heading">rule MD026</a>,
the text does not end with a punctuation character</li>
</ul>
<p>Basically, if the only action I do is to remove the emphasis around the text, instead
prefixing the line with the text <code>#</code>, it should become a valid heading.</p>
<p>As I now had a working theory on why this rule may have been created and what a good
justification was for it, it was time to start writing the rule.</p>
<h3 id="adding-the-rule_3">Adding the Rule<a class="headerlink" href="#adding-the-rule_3" title="Permanent link">¶</a></h3>
<p>While the logic for the rules has been somewhat simple before the point, even a simple
glance at this rule led me to believe that the logic for this rule was going to need
some heft to it.  As it often is with many complex parsing scenarios, it was
time to use a Finite State Machine.  While there are many good articles on Finite
State Machines, such as this decently complete one at
<a href="https://en.wikipedia.org/wiki/Finite-state_machine">Wikipedia</a>, these complex
machines boil down to this simple statement:  the machine has a finitely small number
of states and for each state there are 0 or more transitions from that state to other
states.</p>
<p>From my experience, there is a certain level in parsing or pattern recognition where a
simple comparison is not enough, and a formal Finite State Machine is required.  The
inverse of this is also true, where the formality and setup required for a proper
Finite State Machine may get in the way of a small, efficient algorithm. Consider the
algorithm and code for
<a href="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/#rule-md026-trailing-punctuation-in-heading">rule MD026</a>
in the previous section.  A simple <code>if</code> statement was used to look for 3 types of
tokens: a start heading token, any contained text tokens, and an end heading token.
While not called out as such, this algorithm was a small state machine with
clear states and clear transitions between states.  Once the contents of the heading
were collected, then rule MD026 did an analysis on it, and determined whether
to fail the rule based on that analysis.</p>
<p>Breaking that logic out into a full-fledged Finite State Machine had little benefit,
as the simple logic was able to complete the task without less than 5 states and
without any complicated transition logic.  On the other hand, the logic for this
rule as defined in the last section reveals that this rule’s algorithm requires 5
distinct states:</p>
<ol>
<li>look for a paragraph start token</li>
<li>look for an emphasis start token</li>
<li>look for a text token</li>
<li>look for an emphasis end token</li>
<li>look for a paragraph end token</li>
</ol>
<p>If at any point the next token that we encounter is not the type of token required to
go to the next state, the machine resets back to state 1 and the machine starts to look
for a new paragraph.  While the transition logic remained simple, I felt that
the “large” number of different states made using a Finite State Machine the best
alternative.</p>
<p>Once I had the states and transitions figured out, the writing of the rule was
trivial.  The states were represented by a simple set of <code>if</code> statements, each one
clearly looking for the correct condition to move the state machine to the next state.
If that condition is not found,
the current state is reset to state 1, causing it to look for the initial condition
again.  If the Finite State Machine gets past the final state, the rule fails and the
current state is again reset back to state 1, looking for another candidate paragraph
to evaluate.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>From the viewpoint of adding new rules, this was a good experience.  My feelings,
as expressed in
<a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/##what-was-my-experience-so-far">the last article</a>,
were easily extended to cover this set of rules as well.  While I still want to jump
ahead sometimes, my confidence in the process of writing rules and the framework in
which I write those rules is getting deeper with the authoring of each rule. A good
part of that confidence boost is that when I create new rules, the bulk of the time used
to author those rules is focused on the rules themselves, and not on how to wring the
required data from the framework.  It is only the rare exception where I need to figure
out how to get some data from the framework.</p>
<p>But it is those exceptions that caused me to pause and think when trying to answer the
question that I posed at the start of the article: write more rules or fix more issues?
This answer is a difficult one for me to arrive at, as there is good data to support
both sides.  Writing more rules would round out the framework some more, while focusing
on the framework will fix known issues with the framework, allowing future rules to
be written with less friction.</p>
<p>This choice was also complicated by the arrival of new ideas for the project as I am
implementing the rules.  A good example of this is the Markdown parser “tunings” that
I briefly talked about back in the documentation for
<a href="http://localhost:8000/2020/05/25/markdown-linter-rules-headings-part-2/#rule-md023-headings-must-start-at-the-beginning-of-the-line">rule MD023</a>.
While it is nice to think about these concepts and how they could make the project
better, doing anything more than thinking about them at this stage would be
distracting.  Even worse, it could derail the project by having me follow that
concept down the
<a href="https://www.merriam-webster.com/dictionary/rabbit%20hole">rabbit hole</a>.  If I want
to be able to explore concepts such as “tunings”, which of the two options would
allow me to get there faster while maintaining my require level of quality?</p>
<p>In the end, I determined that I wanted some more time to think about this.  There
are a few issues in my backlog, and fixing those issues will give me some more
time to determine the best course of action.  Sometimes, the best decision is not to
decide, but to collect more information.  I firmly believe that this is one of those
cases.  And if I am wrong?  It just means the foundation for the project will be
that much cleaner and stronger than it was before.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>As I mentioned in the previous section, I feel that the best course of action is to do
some refactoring.  While it is not a glorious task, it will give me some time
to determine if whether to choose line/column support in the parser or adding more
rules.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:Babelmark">
<p>Babelmark is a useful online tool that converts a given piece of Markdown text into HTML using a wide variety of Markdown parsers.  I find tools like this very useful in exploring possibilities for how to solve issues that I have. <a class="footnote-backref" href="#fnref:Babelmark" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Rules%20-%20Headings%20-%20Part%202&url=https%3A//jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/&hashtags=markdown-linter,linter-rules" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Rules%20-%20Headings%20-%20Part%202&amp;body=https%3A//jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-rules-headings-part-2"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/" title="Previous: Markdown Linter - Rules - Headings - Part 1">Markdown Linter - Rules - Headings - Part 1</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Next: Markdown Linter - Taking Time To Evaluate">Markdown Linter - Taking Time To Evaluate</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~21 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-05-25T00:00:00-07:00">May 25, 2020</time>
        <h4>Markdown Linter Rules</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/" title="Markdown Linter - Rules - The First Three">Part 1: Markdown Linter - Rules - The First Three</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/" title="Markdown Linter - Rules - Headings - Part 1">Part 2: Markdown Linter - Rules - Headings - Part 1</a>
            </li>
            <li  class="active-part">
            Part 3: Markdown Linter - Rules - Headings - Part 2
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#linter-rules-ref">linter rules
                    <span>3</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>125</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2021 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>