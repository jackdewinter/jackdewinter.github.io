<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Introduction¶ After setting up a good, easy process for writing new rules, it was now time to make some headway on the task of writing those new rules. While the title “Headings - Part 1” is not glamorous, it is a very apt description for the way that I planned out …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, linter rules, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Rules - Headings - Part 1 "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/" />
<meta property="og:description" content="Introduction¶ After setting up a good, easy process for writing new rules, it was now time to make some headway on the task of writing those new rules. While the title “Headings - Part 1” is not glamorous, it is a very apt description for the way that I planned out …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-05-18T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Rules - Headings - Part 1 ">
<meta name="twitter:description" content="Introduction¶ After setting up a good, easy process for writing new rules, it was now time to make some headway on the task of writing those new rules. While the title “Headings - Part 1” is not glamorous, it is a very apt description for the way that I planned out …">

        <title>Markdown Linter - Rules - Headings - Part 1  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/">
                Markdown Linter - Rules - Headings - Part 1
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#what-about-those-two-rules-that-were-left-out">What About Those Two Rules That Were Left Out?</a></li>
<li><a href="#why-is-this-group-of-rules-important">Why Is This Group of Rules Important?</a></li>
<li><a href="#rule-md018-no-space-after-hash-on-atx-style-heading">Rule MD018 - No space after hash on atx style heading</a><ul>
<li><a href="#why-does-this-rule-make-sense">Why Does This Rule Make Sense?</a></li>
<li><a href="#adding-the-rule">Adding the Rule</a></li>
</ul>
</li>
<li><a href="#rule-md019-multiple-spaces-after-hash-on-atx-style-heading">Rule MD019 - Multiple spaces after hash on atx style heading</a><ul>
<li><a href="#why-does-this-rule-make-sense_1">Why Does This Rule Make Sense?</a></li>
<li><a href="#adding-the-rule_1">Adding the Rule</a></li>
</ul>
</li>
<li><a href="#rules-md020-and-md021">Rules MD020 and MD021</a><ul>
<li><a href="#these-rules-look-very-familiar">These Rules Look Very Familiar</a></li>
<li><a href="#adjusting-the-old-rules">Adjusting the Old Rules</a></li>
<li><a href="#adding-the-new-rules">Adding the New Rules</a></li>
<li><a href="#is-this-really-a-failure">Is This Really A Failure?</a></li>
</ul>
</li>
<li><a href="#rule-md022-headings-should-be-surrounded-by-blank-lines">Rule MD022 - Headings should be surrounded by blank lines</a><ul>
<li><a href="#why-does-this-rule-make-sense_2">Why Does This Rule Make Sense?</a></li>
<li><a href="#adding-the-rule_2">Adding the Rule</a><ul>
<li><a href="#testing-done-right">Testing Done Right</a></li>
<li><a href="#writing-the-rule">Writing the Rule</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>After setting up a good, easy process for
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/#adding-the-rule">writing new rules</a>,
it was now time to make some headway on the task of writing those new rules.  While the
title “Headings - Part 1” is not glamorous, it is a very apt description for the way
that I planned out the development of this group of rules dealing with Markdown
headings. In
<a href="https://github.com/DavidAnson/markdownlint">David Anson’s MarkDownLint</a>,
there are a total of 15 linter rules that specifically deal with headings.
The first 3 of those rules were used as examples in the previous article, leaving
12 rules to implement.  For reasons I will follow up on, I decided to leave the
implementation of rules MD041 and MD043 for later, reducing the number of rules to
a nice manageable 10.</p>
<p>Without any unnecessary embellishment, the article’s title simply denotes that I am
going to talk about the implementation of the first half of those rules.  Sure, I could
come up with a name like “The 5 Most Important Rules for Headings!” or “5 Rules
for Headings That You Cannot Live Without!”, but the truth is that they were simply the
next group of rules.  Nothing fancy, nothing misleading, just the plain truth.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/c07dd31cf85db9905693191fb022705b4d641305">24 April 2020</a> and
<a href="https://github.com/jackdewinter/pymarkdown/commit/1c4a87c88f45417ddc70c537a3c598a4349ed7ad">26 April 2020</a>.</p>
<h2 id="what-about-those-two-rules-that-were-left-out">What About Those Two Rules That Were Left Out?<a class="headerlink" href="#what-about-those-two-rules-that-were-left-out" title="Permanent link">¶</a></h2>
<p>Just to get this out of the way: because it was expedient.</p>
<p>I started to look at rule MD041 when I was implementing rule MD002, as documented in
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/#rule-md002-deprecated-first-heading-should-be-top-level">the last article</a>.
At that time, I looked at rule MD041 to determine if I could just include the work for
MD041 with the work to write rule MD002.  While the only difference between the two
rules is the inclusion of “YAML front matter” into the rule, I felt that the
difference was a large one at that stage of the project.  I knew that I needed to
added metadata support to the parser as a requirement for my use of the linter.  But
the overriding question I had to answer was: Was this the right time to add this
new feature to the parser?</p>
<p>After a decent amount of back and forth on the subject, I decided against adding it at
that moment. From my point of view, at that time it was better to focus on additional
linter rules for the project rather than focus on additional features for the parser.
While it would be fun to add more functionality to the parser to allow for MD041 to be
implemented, I made a judgement call that it could wait a bit.</p>
<p>For rule MD043, my decision was based on a combination of the
complexity of the feature and the usefulness of the feature to me.  Without a deep dive
into the rule, it looks like there will be a fair number of edge cases that I will have
to consider for rule MD043, easily increasing its complexity.  From the usefulness
point of view, while I can
see how it may be useful, this is not a feature that I see myself using a lot.  While I
took a different path to the judgement call, the result was the same: Rule MD043 could
wait for later.</p>
<h2 id="why-is-this-group-of-rules-important">Why Is This Group of Rules Important?<a class="headerlink" href="#why-is-this-group-of-rules-important" title="Permanent link">¶</a></h2>
<p>While I didn’t think about it at the time, I needed this group of rules to prove
two important things to myself: that I had chosen the right base framework to write
linter rules with, and that I had chosen a good development process with which to
write and test those rules.  It was only after the development was completed and
I was writing this article that I was able to recognize their importance in proving
or disproving those two things to myself.</p>
<h2 id="rule-md018-no-space-after-hash-on-atx-style-heading">Rule MD018 - No space after hash on atx style heading<a class="headerlink" href="#rule-md018-no-space-after-hash-on-atx-style-heading" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_018.py">Rule MD018</a>.</p>
<h3 id="why-does-this-rule-make-sense">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense" title="Permanent link">¶</a></h3>
<p>This rule is all about catching a
<a href="https://www.merriam-webster.com/dictionary/typo">typo</a>.
This rule surmises that when someone types:</p>
<div class="highlight"><pre><span></span><span class="o">#</span><span class="n">Heading</span> <span class="mi">1</span>
</pre></div>
<p>they probably forgot to add a space and really meant to type this:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">Heading</span> <span class="mi">1</span>
</pre></div>
<p>While it is possible that the author intended to start a new line with the text
<code>#Heading</code>, I believe that it is far more likely that a typo occurred.</p>
<h3 id="adding-the-rule">Adding the Rule<a class="headerlink" href="#adding-the-rule" title="Permanent link">¶</a></h3>
<p>The two important parts of adding this rule were recognizing that it can take place
in a normal paragraph and that it can occur at the start of any line in that paragraph.</p>
<p>While I did consider the possibility of text like <code>#Heading</code> being
captured as part of another block element, my experimentation with the CommonMark
parser did not reveal any case that causes another block element to stop
capturing on a line like <code># Heading</code>.  As such, by default the text ends up being
captured within a paragraph block using a text token. As is shown in
<a href="https://github.github.com/gfm/#example-47">example 47</a>,
an Atx heading can interrupt other blocks, but more importantly, it can interrupt a
paragraph block.  With these two constraints understood, I was ready to start
coding the rule.</p>
<p>Leveraging the first constraint allowed me to add code to the <code>next_token</code>
function to consider any text token within a paragraph block eligible for further
examination.  From there, I applied the second constraint by enhancing the
rule to look for an Atx heading-like pattern at the start of each line within those
eligible text tokens.
This was accomplished by breaking down each text token into separate lines and checking
them against a
<a href="https://docs.python.org/3/howto/regex.html">Python regular expression</a>.
By carefully reading the GFM specification’s section on
<a href="https://github.github.com/gfm/#atx-headings">Atx headings</a>,
I was able to construct the regular expression <code>^\s{0,3}#{1,6}\S</code>, which breaks down
into the following components:</p>
<ul>
<li><code>^</code> - start matching at the start of the line</li>
<li><code>\s{0,3}</code> - look for between 0 and 3 whitespace characters</li>
<li><code>#{1,6}</code> - look for between 1 and 6 <code>#</code> characters</li>
<li><code>\S</code> - look for one non-whitespace character</li>
</ul>
<p>I needed the regular expression to be a form of the regular expression to recognize the
proper GRM specification form but modified to look for the specific case that I wanted
to look for.  In this instance, I was looking for heading-like text that is missing
at least one space after the starting <code>#</code> characters.  To satisfy this constraint I
used the <code>\S</code> sequence,
matching any single non-whitespace character, at the end of the regular expression
specifically looking for no whitespace characters at the end of the expression. Using my
favorite online <a href="https://pythex.org/">Python regular expression tester</a>, I was able to
verify that I had the correct regular expression right away.</p>
<p>The rigorous testing for this rule involved more testing of cases where the rule should
not fail than cases where it should fail.  But when I boiled all those tests down into
what was relevant, there were a couple of patterns that I just needed to test.  In
testing, this is referred to as equivalence class testing.</p>
<p>While sites like
<a href="https://www.professionalqa.com/equivalence-class-testing">this one</a>
go on and on about what it is, it breaks down into one statement.  Unless there
is something special (usually around boundary conditions), entire groups of tests can
be considered equivalent and be represented by a single test, if their relevant
behavior is consistent across that entire group.  Consider a simple calculator
application that allows for the addition of 2 integers together.  The testing of that
application does not need to test every single integer added to every single integer.
Just thinking about the work required for that is exhausting!  Instead, the testing can
be broken down into representative
groups such as “any integer added to 0 equals that integer”, drastically reducing the
number of tests required to cover a specific component.</p>
<p>Applying this concept to the test cases for this rule, I was able to reduce over 20
tests down to a more reasonable 8 tests.  Some of these groups were making sure
the rule does not fail if eligible text is in any of the text-containing leaf blocks
except for the paragraph block, in which it should fail.  The rest of the groups were
simple cases based on variations of the regular expression above, that regular
expression a reflection of the specification.</p>
<p>Confident that I had covered all the conditions for this rule, it was time to move
on to the next one!</p>
<h2 id="rule-md019-multiple-spaces-after-hash-on-atx-style-heading">Rule MD019 - Multiple spaces after hash on atx style heading<a class="headerlink" href="#rule-md019-multiple-spaces-after-hash-on-atx-style-heading" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_019.py">Rule MD019</a>.</p>
<h3 id="why-does-this-rule-make-sense_1">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense_1" title="Permanent link">¶</a></h3>
<p>Like a fair number of the other rules that are defined, this rule is about
consistency.  While the opening paragraph for the GFM specification for
<a href="https://github.github.com/gfm/#atx-headings">Atx headings</a>
does allow for more than one space after the initial set of <code>#</code> characters, it also
specifies that those leading spaces are stripped before the rest of the line is
parsed as inline content.  Essentially:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">Heading</span> <span class="mi">1</span>
</pre></div>
<p>and</p>
<div class="highlight"><pre><span></span><span class="o">#</span>                                            <span class="n">Heading</span> <span class="mi">1</span>
</pre></div>
<p>are syntactically equivalent.  As they are equivalent, it makes sense to use the simpler
form of the heading to keep things consistent.</p>
<h3 id="adding-the-rule_1">Adding the Rule<a class="headerlink" href="#adding-the-rule_1" title="Permanent link">¶</a></h3>
<p>The code to evaluate this rule was very simple.  When the content of the Atx heading is
parsed into a text token, any spaces that are stripped from that token are kept as part
of the text token in a separate part specifically reserved for stripped whitespace.  To
check for multiple spaces, I simply added code that checked to see if a
text token existed within an Atx heading, and if so checked to see if that token
contained more than one space in that stripped whitespace area of the token.</p>
<p>As the code was simple, the tests themselves were simple.  The examples from the
<a href="https://github.com/DavidAnson/markdownlint/blob/master/doc/Rules.md#md019---multiple-spaces-after-hash-on-atx-style-heading">MD019 rule description page</a>
were used verbatim as the only cases needed as that is how simple this rule is.  At
least it was that simple until I looked more closely at the next two rules.</p>
<h2 id="rules-md020-and-md021">Rules MD020 and MD021<a class="headerlink" href="#rules-md020-and-md021" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_020.py">Rule MD020</a> and
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_021.py">Rule MD021</a>.</p>
<h3 id="these-rules-look-very-familiar">These Rules Look Very Familiar<a class="headerlink" href="#these-rules-look-very-familiar" title="Permanent link">¶</a></h3>
<p>While preparing for the work detailed in
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/">the last article</a>,
I quickly read through the list of rules before starting that work.  I believe that
because I was focusing on those first 3 rules, I missed an interesting
piece of information on rules MD020 and MD021.  The piece of information is that
rules MD020 and MD021 are variations of the rules for MD018 and MD019 that apply
specifically to Atx headings with the
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/#atx-headings-vs-atx_closed-headings">Atx_Closed style</a>.</p>
<p>That information was both good news and bad news.  The good news part was that since I
had the code and tests already written for the previous two rules, I could repurpose a
lot of that code for these new rules.  The bad news part was that I was going to have
to rewrite parts of those two previous rules to exclude cases where the latter two rules
will fail.  However, I believe that the good news here definitely outweighs the bad
news, so on to the coding!</p>
<h3 id="adjusting-the-old-rules">Adjusting the Old Rules<a class="headerlink" href="#adjusting-the-old-rules" title="Permanent link">¶</a></h3>
<p>The first part of adding these new rules was modifying the old rules to not fail if an
Atx_Closed style of Atx heading is found.  Rule Md019 was the easiest one to adjust,
requiring only a small change. As part of the normal Atx heading parsing, the number of
trailing <code>#</code> characters in the heading is collected in the Atx heading’s
<code>remove_trailing_count</code> variable.  The small change I made was to only fail rule MD019
if that variable was zero, an easy change in anyone’s viewpoint.
The change for rule MD018 was only slightly more difficult, adding an additional check
for the regular expression <code>#\s*$</code><sup id="fnref:closeAtx"><a class="footnote-ref" href="#fn:closeAtx">1</a></sup> to the existing condition.  In both
cases, simple test cases were added to expressly test the rule to make sure they did
not fail if presented with an Atx_Closed style heading.</p>
<p>Simple changes, and simple tests to verify those changes.</p>
<h3 id="adding-the-new-rules">Adding the New Rules<a class="headerlink" href="#adding-the-new-rules" title="Permanent link">¶</a></h3>
<p>Adjusting rule MD019 to fit the parameters of rule MD021 was interesting, but not too
difficult.  The original check for spaces was modified to set the variable
<code>is_left_in_error</code> instead of failing immediately.  When the end token for the Atx
heading token is seen, it checks to see if that <code>is_left_in_error</code> was set or if the
closing <code>#</code>
count is greater than 1, failing if either part is true.  Checking the end token was
required as the parser’s pattern is that any leading spaces are applied to the token
that follows those spaces, meaning that those spaces before the closing <code>#</code> characters
is stored with the Atx heading’s end token.</p>
<p>Making similar changes to rule MD020 proved to be a bit more difficult.  The
constraints from rule MD018 were still present, but rule MD020 added the constraint of
looking for bad spacing before the closing set of <code>#</code> characters.  Starting with the
previous regular expression for finding normal Atx headings in paragraphs
(<code>^\s{0,3}#{1,6}\S</code>) and merging it together with the the regular expression
for excluding Atx_Closed line failures from rule MD019 (<code>#\s*$</code>), I ended up with the
expression <code>^\s{0,3}#{1,6}.*#+\s*$</code>.  To merge the two expression together, I made two
small changes.  The <code>\S</code> expression used to indicate the matching of any character that
is not whitespace was replaced with the <code>.*</code> expression to match zero or
more instances of any character.  The <code>#</code> character used to indicate a single <code>#</code>
character was then replaced with the <code>#+</code> expression to match 1 or more <code>#</code> characters,
allowing for any number of closing <code>#</code> characters in the Atx heading.  </p>
<p>Before adding any extra test cases, I used my favorite
<a href="https://pythex.org/">Python regular expression tester</a> to do some extensive testing
on the regular expression.  I am happy to report that except for a simple
typo, I got the regular expression right on the first try!</p>
<p>With the regular expression
verification concluding successfully, I moved to add the test cases for both rules.
For both rules, I started by adding copies of the test cases from the original rules
but modified each one to represent missing spaces at the start of the Atx_Closed style
headings instead of normal Atx style headings.  From there, I added test cases where
spaces were
missing from both the start and the end of the Atx heading as well as where spaces
were only missing from the end of the Atx_Closed style headings.  It was there that I
ran into an interesting case.</p>
<h3 id="is-this-really-a-failure">Is This Really A Failure?<a class="headerlink" href="#is-this-really-a-failure" title="Permanent link">¶</a></h3>
<p>While the original rules do not specifically identify this as a distinct case, consider
the following Markdown:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">Heading</span><span class="o">#</span>
</pre></div>
<p>While this obviously qualifies as an Atx heading, I can credibly argue that it should
be included in MD020’s definition of a typo in an Atx_Closed styled heading.  While I
could have left it out, I felt strongly that this was most likely a typo and the rule
should fail on this input as well.  </p>
<p>Adding this into the rule for MD020 was easy.  If the last token is a text token and the
rule is currently looking at an end Atx heading token, the rule checks to see if that
previous text token ends with a <code>#</code> character.  If the <code>#</code> character is found, it fails
the rule.</p>
<p>After adding the code for this newly discovered case, I spent some time exploring
different possible combinations, making sure that I had the right equivalence classes
for all 4 new rules.  When I was satisfied that I had not missed anything, I move on
to the next rule.</p>
<h2 id="rule-md022-headings-should-be-surrounded-by-blank-lines">Rule MD022 - Headings should be surrounded by blank lines<a class="headerlink" href="#rule-md022-headings-should-be-surrounded-by-blank-lines" title="Permanent link">¶</a></h2>
<p>This section describes the initial implementation of PyMarkdown’s
<a href="https://github.com/jackdewinter/pymarkdown/blob/master/pymarkdown/plugins/rule_md_022.py">Rule MD022</a>.</p>
<h3 id="why-does-this-rule-make-sense_2">Why Does This Rule Make Sense?<a class="headerlink" href="#why-does-this-rule-make-sense_2" title="Permanent link">¶</a></h3>
<p>While I could stay with the consistency answer I used for MD019, a better answer for
this rule is  compatibility and readability.  Speaking to compatibility,
there are some Markdown parsers that will not recognize Atx headings unless they are
preceded by a blank line or followed by a blank line.  To keep things simple, having
at least one blank line on either side of the Atx heading keeps the options for parser
choices open.</p>
<p>From a readability point of view, hopefully it is obvious that:</p>
<div class="highlight"><pre><span></span><span class="nv">Lorem</span> <span class="nv">ipsum</span> <span class="nv">dolor</span> <span class="nv">sit</span> <span class="nv">amet</span>, <span class="nv">consectetur</span> <span class="nv">adipiscing</span>.

## <span class="k">Next</span> <span class="nv">Section</span>

<span class="nv">Morbi</span> <span class="nv">dictum</span> <span class="nv">tortor</span> <span class="nv">a</span> <span class="nv">diam</span> <span class="nv">volutpat</span>, <span class="nv">ut</span>.
</pre></div>
<p>is a lot easier to read than:</p>
<div class="highlight"><pre><span></span><span class="nv">Lorem</span> <span class="nv">ipsum</span> <span class="nv">dolor</span> <span class="nv">sit</span> <span class="nv">amet</span>, <span class="nv">consectetur</span> <span class="nv">adipiscing</span>.
## <span class="k">Next</span> <span class="nv">Section</span>
<span class="nv">Morbi</span> <span class="nv">dictum</span> <span class="nv">tortor</span> <span class="nv">a</span> <span class="nv">diam</span> <span class="nv">volutpat</span>, <span class="nv">ut</span>.
</pre></div>
<p>Between the coloring of the Atx heading in my editor and the spacing around the Atx
heading, it is easy to find the different sections.  Without that spacing, I know it
takes me a lot more effort to find headings, especially in a large document.</p>
<p>In addition to these reasons, I believe that different people have varying requirements
on what is acceptable or proper amounts of spacing before and after a heading.  I
personally know of a few people with visual impairments that find it easier to
acknowledge the change in sections if accompanied by extra spacing.  To support varying
requirements like these, rule MD022 has the <code>lines_above</code> and <code>lines_below</code>
configuration values that allows the user to alter the required number of blank lines
before and after each heading element.  From my point of view, the benefit provided
by allowing the user to configure this rule easily outweighs the work that was
required to add it.</p>
<h3 id="adding-the-rule_2">Adding the Rule<a class="headerlink" href="#adding-the-rule_2" title="Permanent link">¶</a></h3>
<p>In documenting the previous 4 rules, I noticed that I almost always talk about
testing as a final step, which is far from my practice.  As such, I thought it would
be useful to use this rule’s development as an example of my normal development
process.</p>
<h4 id="testing-done-right">Testing Done Right<a class="headerlink" href="#testing-done-right" title="Permanent link">¶</a></h4>
<p>As I documented in <a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/">my last post</a>,
my usual process for developing a new rule is:</p>
<ul>
<li>Creating a New Rule</li>
<li>Creating the Initial Tests</li>
<li>Implementing the Rule</li>
<li>Thorough Rule Validation</li>
</ul>
<p>I usually talk about running the tests after I talk about creating a rule, because it
is in the “Thorough Rule Validation” phase that most of the interesting things happen.
In this case, it was the “Creating the Initial Tests” phase that was interesting.</p>
<p>Creating a new rule is a task that I can now perform while sleeping, as I have done it
enough times that adding a new rule to the project only requires a little bit of my
attention to accomplish correctly.  I was then wakened out of slumber when I proceeded
to the next step and started going through the initial combinations of test data for
this rule.  Honestly, keeping all that data in my head caused me to get confused
somewhat quickly.  There were simply too many
combinations to keep in my head with any degree of confidence.  As such, I started
creating the initial test cases for rule MD022, adding
one test case per file just like normal.  Working through each set of combinations,
I was surprised that at the end of that exercise, I had 22 test files ready to go for
testing.  Reviewing the variations of text block types, SetExt/Atx headings,
valid/invalid spacing, and alternate spacing configurations, it did seem justified that
22 test files were required to properly test the rule. And that number was kept low as
I cheated a little bit, leaving any combinations with container blocks (block quotes
and list blocks) out of the
equation until I could do a bit more research and thinking on them.</p>
<h4 id="writing-the-rule">Writing the Rule<a class="headerlink" href="#writing-the-rule" title="Permanent link">¶</a></h4>
<p>Having so many test cases, I was concerned that the logic was going to be incredibly
complex, but I was able to boil it down to two simple metrics: the number of blank lines
before a heading and the number of blank lines after a heading.  The count
of lines before any heading is equal to the number of blank lines after a leaf block
completes and the heading block starts.  The count of lines after any heading is equal
to the number of blank lines after the end of the heading until the next leaf block
starts.  This is where excluding the container blocks paid off, as adding those blocks
in to this rule with their containing conditions and ending conditions would have
complicated those calculations by a fair amount.</p>
<p>Given the calculations as specified in the last paragraph, the code to determine these
values was simple, but required some thinking.  The <code>blank_line_count</code> variable is
incremented if it is not
<code>None</code> and is greater than zero.  At the start of the document, the <code>blank_line_count</code>
variable is set to <code>-1</code> to make sure it does not fail for a heading at the very start of
the document.  Whenever the end of a leaf block is encountered, the <code>blank_line_count</code>
variable is set to <code>0</code> to allow the counting of blank lines to commence.  The end token
for anything other than leaf blocks is not important to this rule, so in that case, the
<code>blank_line_count</code> is set to <code>None</code> to stop counting until the next qualifying end token
starts it again.</p>
<p>Once I had the calculation of <code>blank_line_count</code> worked out properly, the rest was a
matter of perspective.  The before count is simply the value of <code>blank_line_count</code> at
the time that the Atx heading is encountered.  Likewise, the after count is the value
of <code>blank_line_count</code> at the time that the next leaf block is encountered.  But what
if there is no next leaf block?  What if the heading block is the last block in the
document?  That is where the <code>completed_file</code> function comes in handy. Added
to the plugin manager for cases like this, this function is called after all the
line and token processing for the Markdown has completed.  When the
<code>completed_file</code> function is called for this rule, it performs the usual check for
closing conditions, failing the rule if the conditions are right.</p>
<p>With the 22 test cases identified at the start of the development for this rule,
the testing was simple, with almost no errors in the implementation of the rule
itself, just the normal semantic and typo stuff.  I do feel that I must acknowledge
that I believe part of the reason this went off so cleanly was because the container
blocks are not yet implemented.  I do think those 2 blocks alone will easily
<a href="https://idioms.thefreedictionary.com/throw+a+wrench+in+the+works">throw a monkey wrench</a>
into the works.  But for now, it is a good place to stop with development of this rule.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>After the stress of adding the first three rules, as documented in
<a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/">the previous article</a>,
adding these rules to PyMarkdown was comparatively easy.  While I still had to contend
with the line numbers and column numbers not being reported<sup id="fnref:yes"><a class="footnote-ref" href="#fn:yes">2</a></sup>, everything else in
my “rule development process” was working fine.  There are times that I want to skip
the tests and get to the development of the rule and have fun, as I am only human.
But if there is anything that
my experience as a developer has taught me, it is that having a clear picture of what
you want to do before your write the code is essential to shaping the code.  If you
start with a poor picture for what your code will do, you get poor results.  I find it
almost always pays off to take the time to draw that good picture, getting together
solid test cases and manually calculating their anticipated results once executed
against the project.</p>
<p>While the ease of rule development is nice, it is the solid nature and usefulness of the
core rule engine that is making me happy.  In implementing this batch of 5 rules, I
did not have to make any changes to the core rule engine.  At the same time, the
development of the rules was easy, my focus centering on the particulars of the rule
itself, and not the infrastructure required to support the rule.  While I am not sure
if it is happiness or pride, it is a good
feeling that the work to get the project to this point is paying off.  And while I
do know refactoring is needed in some areas, I also have a growing collection of
proof that my approach to this project is solid and should be continued.</p>
<p>Based on those observations, I believe that any earlier questions about whether I
had chosen the right framework and the right development process were answered
positively.  As an added benefit, I also sincerely believe that my early choices to do
things “this way” are paying off for the project.  While not 100% frictionless,
the minimal effort that I require to write new rules is challenging but not difficult,
increasing the “fun quotient” for the project.</p>
<p>I honestly couldn’t wait to keep the progress going with the next set of rules.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Without much fanfare, since this first group of 5 heading rules was accomplished
with ease, next on the list if the second group of 5 rules.  I do hope that I
will have a similar result with those rules!</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:closeAtx">
<p>Look for any <code>#</code> character followed by any number of whitespace characters, anchored to the end of the line. <a class="footnote-backref" href="#fnref:closeAtx" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:yes">
<p>Yes, I am still kicking myself over that, just not as much. <a class="footnote-backref" href="#fnref:yes" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Rules%20-%20Headings%20-%20Part%201&url=https%3A//jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/&hashtags=markdown-linter,linter-rules" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Rules%20-%20Headings%20-%20Part%201&amp;body=https%3A//jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/05/18/markdown-linter-rules-headings-part-1/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-rules-headings-part-1"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/" title="Previous: Markdown Linter - Rules - The First Three">Markdown Linter - Rules - The First Three</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/" title="Next: Markdown Linter - Rules - Headings - Part 2">Markdown Linter - Rules - Headings - Part 2</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~17 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-05-18T00:00:00-07:00">May 18, 2020</time>
        <h4>Markdown Linter Rules</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/" title="Markdown Linter - Rules - The First Three">Part 1: Markdown Linter - Rules - The First Three</a>
            </li>
            <li  class="active-part">
            Part 2: Markdown Linter - Rules - Headings - Part 1
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/05/25/markdown-linter-rules-headings-part-2/" title="Markdown Linter - Rules - Headings - Part 2">Part 3: Markdown Linter - Rules - Headings - Part 2</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#linter-rules-ref">linter rules
                    <span>3</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>81</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2021 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>