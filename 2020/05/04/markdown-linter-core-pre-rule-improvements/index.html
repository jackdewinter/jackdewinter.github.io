<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Introduction¶ Way back in 2019 November, I started this project with a bare-bones framework using a simple dynamic plugin loader. It was a simple proof of concept to determine whether I could create the basis for an extensible linter framework in Python. Once I verified that I could write that …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Core - Pre-Rule Improvements "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" />
<meta property="og:description" content="Introduction¶ Way back in 2019 November, I started this project with a bare-bones framework using a simple dynamic plugin loader. It was a simple proof of concept to determine whether I could create the basis for an extensible linter framework in Python. Once I verified that I could write that …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-05-04T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Core - Pre-Rule Improvements ">
<meta name="twitter:description" content="Introduction¶ Way back in 2019 November, I started this project with a bare-bones framework using a simple dynamic plugin loader. It was a simple proof of concept to determine whether I could create the basis for an extensible linter framework in Python. Once I verified that I could write that …">

        <title>Markdown Linter - Core - Pre-Rule Improvements  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/">
                Markdown Linter - Core - Pre-Rule Improvements
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#source-providers">Source Providers</a><ul>
<li><a href="#starting-with-the-inmemorysourceprovider">Starting with the InMemorySourceProvider</a></li>
<li><a href="#continuing-with-the-filesourceprovider">Continuing with the FileSourceProvider</a></li>
<li><a href="#testing-the-source-providers">Testing the Source Providers</a></li>
</ul>
</li>
<li><a href="#replacing-print-with-log">Replacing Print with Log</a><ul>
<li><a href="#side-note">Side Note</a></li>
</ul>
</li>
<li><a href="#better-error-reporting">Better Error Reporting</a></li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>Way back in 2019 November, I started this project with a bare-bones framework using a
simple dynamic plugin loader.  It was a simple proof of concept to determine whether I
could create the basis for an extensible linter framework in Python.  Once I verified
that I could write that framework, I implemented a very simple case to test against:
checking to make sure the provided Markdown text ends with an empty line.  While that
rule was easy to implement, it was when I looked for another rule to implement that
I determined that to properly lint Markdown text, I needed a Markdown tokenizing
parser.  From my viewpoint, unless I had a parser that
emitted tokens that were a good representation of the Markdown to lint, the linting
rules that I wanted to write would require too much guess work for my own liking.  If I
wanted to write good, solid rules, I needed to have the right information
available for those rules to act upon.  I needed a Markdown parser that emits Markdown
tokens that I had confidence would be the required, correct information for the rules.</p>
<p>Having now written such a parser against the
<a href="https://github.github.com/gfm/">Github Flavored Markdown specification</a>,
it was time to move on to the next part of the project: writing rules.  However, since
almost 5 months had passed since the project started, there were a few changes
that were required in the linter’s core before I could continue.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/51bb1cf945ad5171bd1c41829a48beceb95a3ab0">12 April 2020</a> and
<a href="https://github.com/jackdewinter/pymarkdown/commit/c8ee25446a425cabf9886b65ad1d4922949bbf44">16 April 2020</a>, and the commit from
<a href="https://github.com/jackdewinter/pymarkdown/commit/562600457654234aa7cabefa8e2a6b56665d936c">18 April 2020</a>.</p>
<h2 id="source-providers">Source Providers<a class="headerlink" href="#source-providers" title="Permanent link">¶</a></h2>
<p>In my experience, following the
<a href="https://en.wikipedia.org/wiki/Rule_of_three_(computer_programming)">threefold rule for refactoring</a>
is usually a good idea, as its wisdom has borne out true in my projects many times.
While not a
literal copy of the threefold rule, I choose to remember the rule as follows:</p>
<blockquote>
<p>Write it once, write it neat.  Write it twice, think about extracting it.  Write it three times, extract it without a second thought.</p>
</blockquote>
<p>The original text of “three strikes and you refactor” always seemed a little too harsh
for me with its negative connotation. In addition, I feel that it does not provide good
enough guidance on what to do in the first two cases, just the third one.  My
version of the rule still adheres to the spirit of the original rule, while
fixing the specific issues that I perceive with it.</p>
<p>Source providers for the parser are a concept that fits that refactoring pattern very
well.  When the
original framework for the parser was written, it was designed to parse a line at a
time to conserve memory.  In the parser tests, this information is provided to the
<code>TokenizedMarkdown</code> class as a single string, with the internal functions of the
<code>TokenizedMarkdown</code> class breaking down that data
into individual lines for further processing. With the exception of a single
feature’s error case<sup id="fnref:linkReferenceDefinitionError"><a class="footnote-ref" href="#fn:linkReferenceDefinitionError">1</a></sup>, this design has proven to be very
useful in reducing the complexity of the parser.
It made sense to me to refactor this section of code when considering how to
add support for the second source of Markdown data: Markdown files.</p>
<h3 id="starting-with-the-inmemorysourceprovider">Starting with the InMemorySourceProvider<a class="headerlink" href="#starting-with-the-inmemorysourceprovider" title="Permanent link">¶</a></h3>
<p>Now that the project was moving into the rule-development phase, it was necessary to
ensure that it was just as easy to feed the parser information from a string as it was
to feed it information from a file.  As the initial development
kept things neat, it was relatively simple to take the logic for grabbing the next line
and encapsulate it within the <code>InMemorySourceProvider</code> class as follows:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InMemorySourceProvider</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Class to provide for a source provider that is totally within memory.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span> <span class="o">=</span> <span class="n">source_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the next line from the source provider.</span>
<span class="sd">        """</span>
        <span class="n">token_to_use</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_token</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">token_to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span>
                <span class="n">token_to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_token</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">token_to_use</span>
</pre></div>
<p>This class contains very simple logic.  When the instance of the class is initialized,
it starts by breaking down the input text into a tuple.  The first element of the
resultant tuple contains the next line to be parsed and the second element of that same
tuple contains the input text to be parsed in the immediate future.  Once that
calculation has been performed, the rest of the processing is relatively simple.
If <code>get_next_line</code> is called and the tuple contains 2 elements, the first element is
returned as the next line, and the <code>next_token</code> variable (for next time) is
recalculated using the same expression as was used in the <code>__init__</code> function.
When the <code>get_next_line</code> is called at the end of the file, the tuple contains only 1
element.  At that point, that singular element is returned as the next line to be
parsed, and
the <code>next_token</code> variable is set to <code>None</code> to make sure we end the processing
properly.  Finally, when <code>get_next_line</code> is called and the tuple is set to <code>None</code>,
there is nothing left to parse and <code>None</code> is returned, signaling that the provider has
reached the end of its available text.</p>
<p>To be clear, this is the exact code that was in place for the duration of the parser
testing, just repackaged to be in a more reusable form.  Its interface is plain and
simple: it either returns the next line as a string, or it
returns a <code>None</code> object if there are no more lines.  Nothing fancy as a class either,
just a simple interface: one function to create the instance and get it setup, and one
function to read the next line.</p>
<h3 id="continuing-with-the-filesourceprovider">Continuing with the FileSourceProvider<a class="headerlink" href="#continuing-with-the-filesourceprovider" title="Permanent link">¶</a></h3>
<p>By keeping things simple, creating the class <code>FileSourceProvider</code> was almost as simple
as the refactoring to create the <code>InMemorySourceProvider</code> class.  While I want to keep
options open for future performance experimentation, I just needed something simple
for reading a file from the file system.  Based on those qualifications, I came up with
this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FileSourceProvider</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Class to provide for a source provider that is on media as a file.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_to_open</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_to_open</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_to_parse</span><span class="p">:</span>
            <span class="n">file_as_lines</span> <span class="o">=</span> <span class="n">file_to_parse</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">did_line_end_in_newline</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">next_line</span> <span class="ow">in</span> <span class="n">file_as_lines</span><span class="p">:</span>
            <span class="n">did_line_end_in_newline</span> <span class="o">=</span> <span class="n">next_line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">did_line_end_in_newline</span><span class="p">:</span>
                <span class="n">next_line</span> <span class="o">=</span> <span class="n">next_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">did_line_end_in_newline</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
</pre></div>
<p>Basically, open the file, read in the lines, and process the lines into the format
that we expect.  The only tricky bit with the class’s <code>__init__</code> function was handling
line terminators properly.  In fact, that is the only
purpose for the <code>did_line_end_in_newline</code> variable, remembering if the current line
ended with a newline character before it is removed.  Based on independent unit testing
of the class, I had problems with the characters at the end of the file, which adding
that variable and the final <code>if</code> statement resolved cleanly.  I am not sure if I feel
that the <code>did_line_end_in_newline</code> variable is a kludge or not, but I do feel that it
was the right thing to do in order to maintain the fidelity of the data being read in
from the file.</p>
<p>Because care was taken in the provider’s <code>__init__</code> function to do all the necessary
processing, the <code>get_next_line</code> function is very basic:</p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">get_next_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Get the next line from the source provider.</span>
<span class="sd">        """</span>
        <span class="n">token_to_use</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_lines</span><span class="p">):</span>
            <span class="n">token_to_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">token_to_use</span>
</pre></div>
<p>While this function could be more complicated (or simplified depending on your
viewpoint), I feel that this is a good example of keeping things basic.  The provider
reads the information into an array of strings during the <code>__init__</code> function, and this
function simply uses an index to iterate through and return each element of that
array.  Nothing fancy for now, just some code that
is very functional.  Fancy code can always be added later.</p>
<h3 id="testing-the-source-providers">Testing the Source Providers<a class="headerlink" href="#testing-the-source-providers" title="Permanent link">¶</a></h3>
<p>To make sure both providers are adhering to the interface in the same way, I
added a decent number of tests in the <code>test_source_providers.py</code> file.  In all the
tests, the big thing that is being tested is if the source providers return the correct
lines given the correct input.  If there are 2 line terminators in the input, each
provider must return 3 lines, even if the last one is empty.  Every test is a variation
on that, thoroughly exercising each provider to ensure that both adhere to the
interface flawlessly.  After all, if the parser gets bad input to tokenize, it cannot
help but to produce bad output, even if is only off by a line terminator.</p>
<h2 id="replacing-print-with-log">Replacing Print with Log<a class="headerlink" href="#replacing-print-with-log" title="Permanent link">¶</a></h2>
<p>This improvement was a long time coming: replacing all of the <code>print</code> statements in the
parser with <code>log.debug</code> statements.  When I was developing the parser, adding a simple
Python <code>print</code> statement was the easiest way to add extra debug to the output of the
tests.  This information was pivotal in my ability to debug the parser and quickly
add new features to the parser with confidence.  And in the cases where there were
problems with those features, those same <code>print</code> statements were also pivotal in
helping me ensure the flow of each function was as I had designed it.</p>
<p>Why did I avoid using <code>log.debug</code> statements from the beginning of development, and
instead use <code>print</code> statements?  I am honestly not sure.  I do recall an early
experiment in which I used both types of statements, to see which one worked better for
me.  I remember the experiment, I remember choosing <code>print</code> statements, but I cannot
remember why I chose them, knowing I would have to replace them later. I even checked
my notes from back then, and nothing about logging vs print.  Interesting.</p>
<p>Regardless of why I did it, the time to fix it was now.  It was a mostly painless
transition and didn’t take that long to accomplish.  To the start of most files, I
added the following import:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
</pre></div>
<p>and at the start of many blocks of processing, I added the following line:</p>
<div class="highlight"><pre><span></span>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
<p>Then, for each time I called the print function, like this example:</p>
<div class="highlight"><pre><span></span>        <span class="k">print</span><span class="p">(</span><span class="s2">"Line:"</span> <span class="o">+</span> <span class="n">line_to_parse</span> <span class="o">+</span> <span class="s2">":"</span><span class="p">)</span>
</pre></div>
<p>I replaced it with the exact same arguments, just changing the name of the called
function from <code>print</code> to <code>logger.debug</code> as follows:</p>
<div class="highlight"><pre><span></span>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Line:"</span> <span class="o">+</span> <span class="n">line_to_parse</span> <span class="o">+</span> <span class="s2">":"</span><span class="p">)</span>
</pre></div>
<p>After the initial changes to replace <code>print</code> with <code>log.debug</code>, everything looked okay
until I ran the normal <code>clean</code> script that I use with the project.  This script is a
simple script to execute the
<a href="https://pypi.org/project/black/">black</a>
code formatter, the
<a href="https://pypi.org/project/flake8/">Flake8</a>
and
<a href="https://www.pylint.org/">PyLint</a>
linters, and the full set of tests for the project.  When the script got to PyLint,
it seemed to go crazy and was emitting lots or warning lines, each line essentially
being the same.</p>
<p>Reading the warnings carefully and looking at the source code, PyLint seemed to be
complaining about each logging function call that
involved concatenation.  In each case where I was concatenating strings to arrive at
what I wanted to log, PyLint raised a warning that I wasn’t doing it right.  According
to PyLint, the proper way to log a message for the above example is:</p>
<div class="highlight"><pre><span></span>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Line:</span><span class="si">%s</span><span class="s2">:"</span><span class="p">,</span> <span class="n">line_to_parse</span><span class="p">)</span>
</pre></div>
<p>Doing a bit more research, the reason for the warning is because the logging library
was purposefully created to be lazy.  If the log level for a given call is not high
enough to cause the string to be logged, doing any kind of formatting or concatenation
on that string is wasted effort.  Following that logic, the logger follows the same
conventions that are used with the percent character (<code>%</code>) as the
<a href="https://docs.python.org/3/library/stdtypes.html?highlight=interpolation#printf-style-string-formatting">string interpolation operator</a>,
delaying the evaluation of the actual string until the logger determines
whether the specified string is actually going to be logged.  Once a positive
determination has been made, the format and the arguments are applied to each other,
a resolved string is produced, and that string that is then logged.</p>
<p>It took a while to go through each of those messages. I had to examine each
concatenation sequence, break it down into its component parts, and verify my changes.
Each string that was concatenated needed to be represented in either the format string
or the arguments passed to the logger.  It was slow and pedantic work, but in the end,
I was happy to have a logging solution that was more performant than before.</p>
<h3 id="side-note">Side Note<a class="headerlink" href="#side-note" title="Permanent link">¶</a></h3>
<p>Note that as a Python logging newbie, I am not 100% sure if I created more work for
myself by
frequently creating logging instances inside of the project’s static functions.  It is
possible that I can get away with a static logger variable created in the module’s
namespace at the top of the file, and not worry about creating any other loggers within
the same file.
However, in all the examples I have seen to date, the logger is
either declared at the top of a simple file or within the <code>__init__</code> method of a
class.  As a lot of the helper classes are a collection of functions that are labelled
with the <code>@staticmethod</code> annotation, I am not sure if one instance at the top of the
file is the correct way to go.  While
it might be more effort than I really need, I am confident that I am covering all
the logging situations properly.  If I learn something differently about logging, I
will come back and revisit it.</p>
<h2 id="better-error-reporting">Better Error Reporting<a class="headerlink" href="#better-error-reporting" title="Permanent link">¶</a></h2>
<p>When I initially proofed out the plugin architecture for the linter, I added a
<code>BadPluginError</code> class to help identify plugin issues and report them back to the
command line.  Using this same pattern to integrate error handling for the parser to
the linter, I added the <code>BadParsingError</code> class, raising this error when there were
exceptions raised during the parser’s tokenization of the Markdown text.  A bit more
typing and a short while later, I had the <code>__handle_error</code> function with refactored
content.  This newly minted function reused the error handling meant for the
<code>BadPluginError</code> class to handle both the <code>BadPluginError</code> class and the
<code>BadParsingError</code> class in the same manner.</p>
<p>With that tweak done, I had confidence that the error reporting was done, and I wouldn’t
need anything more serious until far later in the project. That is what I foolishly
thought until about 2 days later. After doing some work on implementing the first two
rules, I realized that some things needed to be fixed with error reporting.</p>
<p>The first change I made was to change the name of the error class from <code>BadParsingError</code>
to <code>BadTokenizationError</code> to reflect the problem area more accurately.  While it is
more of a mouthful to say, it accurately describes that it is a problem with the
tokenization of the document, not a generic “parsing” issue. A good example of this is
when the <code>TokenizedMarkdown</code> class is created.  Upon creation, one of the things
that it does is load the <code>entities.json</code> file from the resources directory, as detailed
in
<a href="https://jackdewinter.github.io/2020/02/24/markdown-linter-starting-inline-processing/#character-references">this article</a>.
If that resource file is not
loaded properly, that code was changed to raise a <code>BadTokenizationError</code> instead of
what it was previously doing.  Without this file, parsing the Markdown text would still
be possible without any issues.  But to properly tokenize the Markdown text, the parser
needs to know if the named character entities that are provided in the Markdown
document refer to valid named entities.  It may
appear to be a semantic difference to some, but in my experience, it is the attention
to detail on little things like that which help improve the project’s maintainability.</p>
<p>In addressing the above case, I stumbled into the second issue: too many exit
points.
While it does not show it in the commit for the <code>BadTokenizationError</code> fix documented
in the paragraph above, the first pass at addressing that issue was messy. It caught
any raised error, did some bare bones reporting, and then performed a <code>sys.exit(1)</code> to
stop the program with an error code of 1.  Doing a quick search through the code, I
stopped counting once I hit the third instance of a <code>sys.exit(1)</code> call in the code.
It was time for a refactor.</p>
<p>Beginning with the initial case that started the search, I took a quick look at the
various search results and came up with a good rubric to follow.  If possible,
I would try and more correctly classify the error using one of the two existing error
classes, <code>BadTokenizationError</code> or <code>BadPluginError</code>, which were already handled at the
top level by the <code>__handle_error</code> function.  If the error occurred in the
<code>main.py</code> file and didn’t fall into either of those categories, I would call the
<code>__handle_error</code> function directly, striving to give a clean and concise message on
what that error was and why it occurred.  If I encountered any errors outside of those
parameters, I would save them for last and re-evaluate my rules.</p>
<p>Based on what I found in the project, the first two rules were enough, as I did
not find an error that could not neatly fit into one of those two categories.
Instead of a few different ways of exiting the linter with an error condition,
<code>__handle_error</code> was now the sole conduit for exiting with an error.  I went over the
tests in the <code>test_main.py</code>,
<code>test_plugin_manager.py</code> and <code>test_markdown_entity_and_numeric_character_references.py</code>
files to make sure everything looked consistent, and things were good!</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>As I have mentioned in previous articles, I like refactoring, and this stretch of
refactoring was no
exception.  Each of these tasks were little tasks, but I felt better knowing that they
were addressed before I shifted my focus to writing the rules for the linter.  The
change to using source providers would be pivotal in dealing with test sources (strings)
and live sources (files) as sibling concepts. Replacing <code>print</code> with <code>log.debug</code> was
also pivotal to using live sources, keeping the ability to debug what was going
on for experienced users, but not flooding a casual user with all of that information.
Finally, getting
all of the error reporting to go through one conduit just seems cleaner and more
concise to me.  Getting these taken care of just felt like the right refactoring to
do at the right time.</p>
<p>I also realized that I enjoy the cadence I have established with refactoring.  While
there are
short bursts where it is just adding new features, for the most part I have tried to
switch off between refactoring and adding new features.  I feel that for my development
style, I have found a good balance between fixing things and adding things, even if it
needs tweaking every so often.  Perhaps it is because of that sense of balance that I
have been able to focus on this project for so long without losing energy on it.
For me, I believe it boils down to a feeling that this project is not about adding
features as much as it is about continual improvement of the project towards its goal,
taking my time to do things right as I go.</p>
<p>Looking forward, I am sure I am not done adding features, refactoring code,
or learning something new and interesting.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Taking a bit of a jump back in time a couple of days from where I am leaving off,
in the next article I am going to start talking about the rules that I am developing,
and how their development proceeded.  Please stay tuned!</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:linkReferenceDefinitionError">
<p>Due to link reference definitions being a multiline element, some of the error cases required the parser to be rewritten to handle lines that need to be “rewound”, as documented in <a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/#hitting-implementation-issues">this previous article</a>. <a class="footnote-backref" href="#fnref:linkReferenceDefinitionError" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Core%20-%20Pre-Rule%20Improvements&url=https%3A//jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Core%20-%20Pre-Rule%20Improvements&amp;body=https%3A//jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-core-pre-rule-improvements"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/05/03/markdown-linter-splitting-up-the-articles/" title="Previous: Markdown Linter - Splitting Up The Articles">Markdown Linter - Splitting Up The Articles</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/05/11/markdown-linter-rules-the-first-three/" title="Next: Markdown Linter - Rules - The First Three">Markdown Linter - Rules - The First Three</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~14 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-05-04T00:00:00-07:00">May 4, 2020</time>
        <h4>Markdown Linter Core</h4>
    <ul class="multi-parts-list">
            <li  class="active-part">
            Part 1: Markdown Linter - Core - Pre-Rule Improvements
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Markdown Linter - Taking Time To Evaluate">Part 2: Markdown Linter - Taking Time To Evaluate</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Markdown Linter - Adding Line and Column Support">Part 3: Markdown Linter - Adding Line and Column Support</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" title="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks">Part 4: Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Markdown Linter - Rabbit Hole 2 - Losing My Way">Part 5: Markdown Linter - Rabbit Hole 2 - Losing My Way</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Markdown Linter - Weeding the Project's Issue List">Part 6: Markdown Linter - Weeding the Project's Issue List</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" title="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out">Part 7: Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" title="Markdown Linter - Improving Consistency">Part 8: Markdown Linter - Improving Consistency</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Markdown Linter - Transforming Back to Markdown">Part 9: Markdown Linter - Transforming Back to Markdown</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/27/markdown-linter-addressing-the-initial-markdown-transformer-issues/" title="Markdown Linter - Addressing the Initial Markdown Transformer Issues">Part 10: Markdown Linter - Addressing the Initial Markdown Transformer Issues</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/03/markdown-linter-improving-the-markdown-transformer/" title="Markdown Linter - Improving the Markdown Transformer">Part 11: Markdown Linter - Improving the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/" title="Markdown Linter - Adding Links to the Markdown Transformer">Part 12: Markdown Linter - Adding Links to the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" title="Markdown Linter - Adding Lists to the Markdown Transformer">Part 13: Markdown Linter - Adding Lists to the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/25/markdown-linter-adding-consistency-to-block-quotes/" title="Markdown Linter - Adding Consistency to Block Quotes">Part 14: Markdown Linter - Adding Consistency to Block Quotes</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/31/markdown-linter-adding-consistency-to-token-heights/" title="Markdown Linter - Adding Consistency to Token Heights">Part 15: Markdown Linter - Adding Consistency to Token Heights</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/" title="Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens">Part 16: Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/14/markdown-linter-adding-consistency-checks-for-emphasis-and-text-tokens/" title="Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens">Part 17: Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/21/markdown-linter-adding-remaining-inline-tokens/" title="Markdown Linter - Adding Remaining Inline Tokens">Part 18: Markdown Linter - Adding Remaining Inline Tokens</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>27</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>45</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>