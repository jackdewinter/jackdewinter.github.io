<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I started adding the proper support for line and column numbers for both the text tokens and the emphasis tokens. In this article, I add the consistency checks for those two inline tokens and add the same support for the remaining inline tokens. Introduction¶ What …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Finishg Add Line/Column Numbers For Inline Tokens "/>
<meta property="og:url" content="http://localhost:8000/2020/09/14/markdown-linter-finishg-add-linecolumn-numbers-for-inline-tokens/" />
<meta property="og:description" content="Summary¶ In my last article, I started adding the proper support for line and column numbers for both the text tokens and the emphasis tokens. In this article, I add the consistency checks for those two inline tokens and add the same support for the remaining inline tokens. Introduction¶ What …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-09-14T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Finishg Add Line/Column Numbers For Inline Tokens ">
<meta name="twitter:description" content="Summary¶ In my last article, I started adding the proper support for line and column numbers for both the text tokens and the emphasis tokens. In this article, I add the consistency checks for those two inline tokens and add the same support for the remaining inline tokens. Introduction¶ What …">

        <title>Markdown Linter - Finishg Add Line/Column Numbers For Inline Tokens  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://localhost:8000/theme/webassets-external/c843160cb3809a5812fff6e168b9d4db_elegant.prod.css">
<link rel="stylesheet" href="http://localhost:8000/theme/webassets-external/78ddd4ea7393d1ac1fd9f91c21aa8b5f_custom.css">



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="http://localhost:8000/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       http://localhost:8000
                                    >Home</a>
                                </li>
                                <li ><a href="http://localhost:8000/categories">Categories</a></li>
                                <li ><a href="http://localhost:8000/tags">Tags</a></li>
                                <li ><a href="http://localhost:8000/archives">Archives</a></li>
                                <li><form class="navbar-search" action="http://localhost:8000/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="http://localhost:8000/2020/09/14/markdown-linter-finishg-add-linecolumn-numbers-for-inline-tokens/">
                Markdown Linter - Finishg Add Line/Column Numbers For Inline Tokens
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#getting-started-with-inline-token-validation">Getting started with inline token validation</a><ul>
<li><a href="#clearly-defining-the-problem">Clearly defining the problem</a></li>
<li><a href="#validating-the-first-element">Validating the First element</a></li>
<li><a href="#what-did-i-discover">What Did I Discover?</a></li>
</ul>
</li>
<li><a href="#xxx">XXX</a><ul>
<li><a href="#emphasis-tokens">Emphasis Tokens</a></li>
<li><a href="#text-tokens">Text Tokens</a></li>
<li><a href="#blank-line-tokens">Blank Line Tokens</a></li>
</ul>
</li>
<li><a href="#was-xxx">Was XXX</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="http://localhost:8000/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/">last article</a>,
I started adding the proper support for line and column numbers for both the text
tokens and the emphasis tokens.  In this article, I add the consistency checks for
those two inline tokens and add the same support for the remaining inline tokens.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="http://localhost:8000/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commit of
<a href="https://github.com/jackdewinter/pymarkdown/commit/c6cc992fa4c5c7c25f2a93038010dfab84a22da8">02 Sep 2020</a>.</p>
<h2 id="getting-started-with-inline-token-validation">Getting started with inline token validation<a class="headerlink" href="#getting-started-with-inline-token-validation" title="Permanent link">¶</a></h2>
<p>At the start of the week, the code used to verify the consistency of inline tokens was
simple:</p>
<div class="highlight"><pre><span></span>    <span class="k">print</span><span class="p">(</span><span class="s2">"&gt;&gt;last_token:"</span> <span class="o">+</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">make_value_visible</span><span class="p">(</span><span class="n">last_token</span><span class="p">))</span>
    <span class="n">next_token_index</span> <span class="o">=</span> <span class="n">last_token_index</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">actual_tokens</span><span class="p">[</span><span class="n">next_token_index</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_token</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s2">"-token:"</span> <span class="o">+</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">make_value_visible</span><span class="p">(</span><span class="n">actual_tokens</span><span class="p">[</span><span class="n">next_token_index</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">next_token_index</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
<p>Added in as a placeholder to allow me to see what was going on with the inline tokens,
it served its purposed well.  But now that I am starting to work on the inline tokens
and their line/column numbers, I need to facilitate better consistency checking of
those tokens.</p>
<p>To start, I removed that placeholder code in both places that it existed, and replaced
it with a call to a new function <code>verify_inline</code>.  The only difference between the two
invocations of the function are the forth argument, <code>current_token</code>.  The first time
it is called, from the_<code>__verify_token_height</code> function, the <code>current_token</code> variable
is set to the block token after a number of inline tokens.  The second time it is
called, it is called at the end of processing to capture any inline tokens that are
within one of the valid text elements, but at the very end of the document.</p>
<h3 id="clearly-defining-the-problem">Clearly defining the problem<a class="headerlink" href="#clearly-defining-the-problem" title="Permanent link">¶</a></h3>
<p>Before doing any real processing with the inline tokens, I needed to create a simple
list containing the actual inline tokens that I wanted to check.  While I could do that
with the main list of tokens, I preferred the concept of having a simple list that just
contained the tokens that I was concerned about.  Once I had all the inline tokens
between the two block tokens in that new list, I still had a small amount of work to do
before the list was usable.  While it wasn’t difficult, the new list had some extra
end tokens at the end of the list.  Working around those extra end tokens would have
been okay, but I felt it was just simpler to remove them from the list before I did any
further processing.</p>
<p>Having a simple list of the inline tokens to work with, the first iteration of the
checking algorithm was easy to start:</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">inline_tokens</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">token_index</span><span class="p">,</span> <span class="n">current_inline_token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inline_tokens</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">token_index</span><span class="p">:</span>
                <span class="n">__verify_first_inline</span><span class="p">(</span><span class="n">last_token</span><span class="p">,</span> <span class="n">inline_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">__verify_next_inline</span><span class="p">(</span>
                    <span class="n">last_token</span><span class="p">,</span>
                    <span class="n">inline_tokens</span><span class="p">[</span><span class="n">token_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">current_inline_token</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># verify_last_inline(inline_tokens[-1], current_inline_token)</span>
</pre></div>
<p>From my viewpoint, the processing of the inline tokens had 3 distinct phases: the first
element in that list, each element after it, and the last element in that list.  Based
on their locations, the first and last elements are special in that they anchor the
other inline tokens to the block tokens on either side of the middle elements.  I wasn’t
sure how difficult the validation of the last element was going to be, so I added in a
placeholder to the code.</p>
<p>The first element was a different story.  Without validating the first element,
validating any of the elements on the inside of the list would be useless.  So whether I
liked the idea or not, validation of the first element in the list was mandatory.</p>
<h3 id="validating-the-first-element">Validating the First element<a class="headerlink" href="#validating-the-first-element" title="Permanent link">¶</a></h3>
<p>Following the pattern that I have used for validation in the past, I created the
<code>__verify_first_inline</code> function with my standard starting template:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__verify_first_inline</span><span class="p">(</span><span class="n">last_non_inline_token</span><span class="p">,</span> <span class="n">first_inline_token</span><span class="p">):</span>
    <span class="k">if</span> <span class="o">&lt;</span><span class="n">something</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span>
</pre></div>
<p>As this function is comparing the starting position of the first inline token to the
last valid block token, the <code>&lt;something&gt;</code> in the above code sample was quickly replaced
with:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_atx_heading</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_setext_heading</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_paragraph</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_fenced_code_block</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_indented_code_block</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_html_block</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">token_name</span>
</pre></div>
<p>and one by one I added the validation functions.  Following that same pattern for
resolving these as I have before, I ran the scenario tests over the entire project
using the command line:</p>
<div class="highlight"><pre><span></span>pipenv run pytest -m gfm
</pre></div>
<p>Each time, I just picked one of the failing tests, and worked on that tests in that
group until they were all passing.  For each of the functions that performed the
validation for that block token, I repeated the same pattern with the first inline
token that was observed.  For example, the <code>__verify_first_inline_atx</code> function quickly
evolved to look like:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__verify_first_inline_atx</span><span class="p">(</span><span class="n">last_non_inline_token</span><span class="p">,</span> <span class="n">first_inline_token</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Handle the case where the last non-inline token is an Atx Heading token.</span>
<span class="sd">    """</span>

    <span class="n">col_pos</span> <span class="o">=</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">column_number</span> <span class="o">+</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">hash_count</span>

    <span class="k">if</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_text</span><span class="p">:</span>
        <span class="n">replaced_extracted_whitespace</span> <span class="o">=</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">resolve_replacement_markers_from_text</span><span class="p">(</span>
            <span class="n">first_inline_token</span><span class="o">.</span><span class="n">extracted_whitespace</span>
        <span class="p">)</span>
        <span class="n">col_pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">replaced_extracted_whitespace</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">line_number</span>
        <span class="k">assert</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">column_number</span> <span class="o">==</span> <span class="n">col_pos</span>
    <span class="k">elif</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_inline_hard_break</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
        <span class="o">...</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">first_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_inline_link</span>
            <span class="ow">and</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">token_name</span>
            <span class="o">!=</span> <span class="n">EndMarkdownToken</span><span class="o">.</span><span class="n">type_name_prefix</span> <span class="o">+</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_inline_link</span>
        <span class="p">),</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">token_name</span>
</pre></div>
<h3 id="what-did-i-discover">What Did I Discover?<a class="headerlink" href="#what-did-i-discover" title="Permanent link">¶</a></h3>
<p>Predictably, I discovered that there are 2 groups of text within block tokens: ones
that support
inline tokens and ones that do not.  The ones that do not support inline tokens are
mostly easy: assert that the inline token is a Text token, and then assert on a simple
calculation of the first line/column number.  The validation of the HTML Block token and
the Indented Code Block token both followed this pattern, with very simple validation.</p>
<p>The Fenced Code Block tokens required a bit more effort, but not much. As the Fenced
Code Blocks can start with 0-3 space characters that then need to be managed on any
subsequent line in the code block, the owning block token’s <code>leading_spaces</code> variable
holds the information on what leading spaces were already removed.  As such, when
calculating the proper position of the first Text token inside of a Fenced Code Block,
that removed space needs to be accounted for.  To properly facilitate that, the
<code>last_token_stack</code> argument needed to be plumbed through so the verification function
could calculate the proper owning blocking token.</p>
<p>The second group of block tokens were the more interesting group of tokens to deal with.
This group of tokens includes the Atx Heading tokens (as shown in the above example),
SetExt Heading tokens, and Paragraph tokens.  The <code>__verify_first_inline_atx</code> function
and the <code>__verify_first_inline_setext</code> function ended up looking similar: the Text
inline token case was populated, but all the other types of inline tokens were handled
with <code>assert False</code> statements.  The <code>__verify_first_inline_paragraph</code> function was
similar, but also slightly different.  The same template was used to generate the
function, but each of the conditions in the <code>if-elif-else</code> block were met at least once.
However, since only the Text token and the Emphasis token have line/column numbers,
allowing this comparison to be performed for them:</p>
<div class="highlight"><pre><span></span>        <span class="k">assert</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">line_number</span>
        <span class="k">assert</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">column_number</span> <span class="o">==</span> <span class="n">last_non_inline_token</span><span class="o">.</span><span class="n">column_number</span>
</pre></div>
<p>All the other inline tokens, the ones that did not currently have a line/column assigned
to them (yet), used the following comparison:</p>
<div class="highlight"><pre><span></span>        <span class="k">assert</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">first_inline_token</span><span class="o">.</span><span class="n">column_number</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
<p>It wasn’t much, but it gave me two important bits of information.  The first was that
there was at least one case where each available inline token was the first inline
token inside of a Paragraph token.  The second was that both heading tokens, the Atx
Heading token and the SetExt Heading token, only contained scenario tests that started
with Text tokens.  I made a note of that observation in the issue’s list, and moved on.</p>
<h2 id="xxx">XXX<a class="headerlink" href="#xxx" title="Permanent link">¶</a></h2>
<p>With the validation of the first element out of the way, it was time to start working
on the <code>__verify_next_inline</code> method to verify each of the middle inline tokens against
the inline token that preceded it.  Since I knew that most of the inline tokens hadn’t
been handled yet, I started out that function with a slight change to the template:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__verify_next_inline</span><span class="p">(</span>
    <span class="n">last_token</span><span class="p">,</span> <span class="n">pre_previous_inline_token</span><span class="p">,</span> <span class="n">previous_inline_token</span><span class="p">,</span> <span class="n">current_inline_token</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="ow">and</span> <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">column_number</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">):</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">current_inline_token</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="ow">and</span> <span class="n">current_inline_token</span><span class="o">.</span><span class="n">column_number</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">):</span>
        <span class="k">return</span>

    <span class="n">estimated_line_number</span> <span class="o">=</span> <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">line_number</span>
    <span class="n">estiated_column_number</span> <span class="o">=</span> <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">column_number</span>
    <span class="k">if</span> <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_text</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span>
    <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">token_name</span>

    <span class="k">assert</span> <span class="n">estimated_line_number</span> <span class="o">==</span> <span class="n">current_inline_token</span><span class="o">.</span><span class="n">line_number</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">"&gt;&gt;est&gt;"</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">estimated_line_number</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">"&gt;act&gt;"</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_inline_token</span><span class="o">.</span><span class="n">line_number</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">estiated_column_number</span> <span class="o">==</span> <span class="n">current_inline_token</span><span class="o">.</span><span class="n">column_number</span><span class="p">,</span> <span class="p">(</span>
        <span class="s2">"&gt;&gt;est&gt;"</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">estiated_column_number</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">"&gt;act&gt;"</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_inline_token</span><span class="o">.</span><span class="n">column_number</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
<p>The first set of <code>if</code> statements made sure that if either the previous or current token
was one that I hadn’t worked on yet, it would return right away.  While this assumed
that the line/column numbers were correct to a certain extent, I was okay with that
assumption in the short term.  The second part computed a starting point for the new
line/column numbers, and then went into the usual pattern of dealing with
each of the eligible tokens by name.  Finally, the third part compared the modified
line/column numbers against the actual line/column numbers of the current token,
asserting with meaningful information if there were any issues.</p>
<h3 id="emphasis-tokens">Emphasis Tokens<a class="headerlink" href="#emphasis-tokens" title="Permanent link">¶</a></h3>
<p>I thought it would be quick to get emphasis out of the way, and it was!  As both the
start and end Emphasis tokens contain the <code>emphasis_length</code>, it was a quick matter of
adjusting the column number by that amount.  As both of these tokens are confined to
a single line, there was no adjusting of the line number to worry about.</p>
<h3 id="text-tokens">Text Tokens<a class="headerlink" href="#text-tokens" title="Permanent link">¶</a></h3>
<h3 id="blank-line-tokens">Blank Line Tokens<a class="headerlink" href="#blank-line-tokens" title="Permanent link">¶</a></h3>
<p>That left the Blank Line tokens to deal with, and I hoped that the effort needed to
complete them was more in line with the Emphasis tokens than the Text tokens.  I was
lucky, and the Blank Line tokens were easy, but with a couple of small twists.
Intrinsically, a blank line
increases the line number and resets the column number to 1.  That was the easy part.
The first twist is that if the current token is a Text token, that text token can
provide leading whitespace that needs to be taken into account.  That was easily dealt
with by adding the following lines to the handler:</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">current_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_text</span><span class="p">:</span>
            <span class="n">estiated_column_number</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_inline_token</span><span class="o">.</span><span class="n">extracted_whitespace</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">current_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_blank_line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">previous_inline_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_blank_line</span><span class="p">:</span>
            <span class="n">estimated_line_number</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">estiated_column_number</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
<h2 id="was-xxx">Was XXX<a class="headerlink" href="#was-xxx" title="Permanent link">¶</a></h2>
<p>The interesting part about defensive code is that sometimes you are not aware of how
good that defense is.  Using the analogy of a castle, is a castle better defensible if
it can withstand attack or if it deters others from attacking the castle?</p>
<p>Two issues that were found:
600 -&gt; assumed that start link size of 1, not start image size of 2</p>
<p>__handle_inline_image_link_start_character
inline_response.delta_column_number = 1</p>
<p>183 -&gt; needed for atx heading, single ws, showing up in text part, moved to ws part
__process_inline_text_block
- moved empty whitespace from whitesapce arg to text arg, made more sense</p>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Finishg%20Add%20Line/Column%20Numbers%20For%20Inline%20Tokens&url=http%3A//localhost%3A8000/2020/09/14/markdown-linter-finishg-add-linecolumn-numbers-for-inline-tokens/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//localhost%3A8000/2020/09/14/markdown-linter-finishg-add-linecolumn-numbers-for-inline-tokens/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Finishg%20Add%20Line/Column%20Numbers%20For%20Inline%20Tokens&amp;body=http%3A//localhost%3A8000/2020/09/14/markdown-linter-finishg-add-linecolumn-numbers-for-inline-tokens/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="http://localhost:8000/2020/09/14/markdown-linter-finishg-add-linecolumn-numbers-for-inline-tokens/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-starting-to-add-line-column-numbers-for-inline-tokens"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://localhost:8000/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/" title="Previous: Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens">Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens</a></li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~8 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-09-14T00:00:00-07:00">Sep 14, 2020</time>
        <h4>Markdown Linter Core</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="http://localhost:8000/2020/05/04/markdown-linter-core-pre-rule-improvements/" title="Markdown Linter - Core - Pre-Rule Improvements">Part 1: Markdown Linter - Core - Pre-Rule Improvements</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Markdown Linter - Taking Time To Evaluate">Part 2: Markdown Linter - Taking Time To Evaluate</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Markdown Linter - Adding Line and Column Support">Part 3: Markdown Linter - Adding Line and Column Support</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" title="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks">Part 4: Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Markdown Linter - Rabbit Hole 2 - Losing My Way">Part 5: Markdown Linter - Rabbit Hole 2 - Losing My Way</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Markdown Linter - Weeding the Project's Issue List">Part 6: Markdown Linter - Weeding the Project's Issue List</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" title="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out">Part 7: Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/07/13/markdown-linter-improving-consistency/" title="Markdown Linter - Improving Consistency">Part 8: Markdown Linter - Improving Consistency</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Markdown Linter - Transforming Back to Markdown">Part 9: Markdown Linter - Transforming Back to Markdown</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/07/27/markdown-linter-addressing-the-initial-markdown-transformer-issues/" title="Markdown Linter - Addressing the Initial Markdown Transformer Issues">Part 10: Markdown Linter - Addressing the Initial Markdown Transformer Issues</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/08/03/markdown-linter-improving-the-markdown-transformer/" title="Markdown Linter - Improving the Markdown Transformer">Part 11: Markdown Linter - Improving the Markdown Transformer</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/" title="Markdown Linter - Adding Links to the Markdown Transformer">Part 12: Markdown Linter - Adding Links to the Markdown Transformer</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" title="Markdown Linter - Adding Lists to the Markdown Transformer">Part 13: Markdown Linter - Adding Lists to the Markdown Transformer</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/08/25/markdown-linter-adding-consistency-to-block-quotes/" title="Markdown Linter - Adding Consistency to Block Quotes">Part 14: Markdown Linter - Adding Consistency to Block Quotes</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/08/31/markdown-linter-adding-consistency-to-token-heights/" title="Markdown Linter - Adding Consistency to Token Heights">Part 15: Markdown Linter - Adding Consistency to Token Heights</a>
            </li>
            <li >
            <a href="http://localhost:8000/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/" title="Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens">Part 16: Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens</a>
            </li>
            <li  class="active-part">
            Part 17: Markdown Linter - Finishg Add Line/Column Numbers For Inline Tokens
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="http://localhost:8000/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://localhost:8000/tags#core-linter-ref">core linter
                    <span>20</span>
</a></li>
                <li><a href="http://localhost:8000/tags#markdown-linter-ref">markdown linter
                    <span>38</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>