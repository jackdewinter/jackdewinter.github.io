<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I continued in my quest to reduce the size of the issues list. In this article, I make good progress in removing items from the issues list. Introduction¶ After having a week where I felt like I barely made any progress, it was nice to …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Delving Into the Issues - 6 "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/" />
<meta property="og:description" content="Summary¶ In my last article, I continued in my quest to reduce the size of the issues list. In this article, I make good progress in removing items from the issues list. Introduction¶ After having a week where I felt like I barely made any progress, it was nice to …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-11-02T00:00:00-08:00" />
<meta name="twitter:title" content="Markdown Linter - Delving Into the Issues - 6 ">
<meta name="twitter:description" content="Summary¶ In my last article, I continued in my quest to reduce the size of the issues list. In this article, I make good progress in removing items from the issues list. Introduction¶ After having a week where I felt like I barely made any progress, it was nice to …">

        <title>Markdown Linter - Delving Into the Issues - 6  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/">
                Markdown Linter - Delving Into the Issues - 6
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#finishing-up-the-work">Finishing Up the Work</a><ul>
<li><a href="#digging-in">Digging In</a></li>
<li><a href="#fixing-the-issue">Fixing the Issue</a></li>
</ul>
</li>
<li><a href="#being-more-precise">Being More Precise</a><ul>
<li><a href="#debugging">Debugging</a></li>
</ul>
</li>
<li><a href="#paragraphs-ending-with-multiline-non-text-inlines">Paragraphs Ending with Multiline Non-text Inlines</a></li>
<li><a href="#expanding-paragraph-tests-to-setext-heading-tests">Expanding Paragraph Tests to SetExt Heading Tests</a></li>
<li><a href="#are-links-being-verified-properly">Are Links Being Verified Properly?</a></li>
<li><a href="#adding-proper-link-verification">Adding Proper Link Verification</a><ul>
<li><a href="#step-1">Step 1</a></li>
<li><a href="#step-2">Step 2</a></li>
<li><a href="#step-3">Step 3</a></li>
<li><a href="#testing-the-changes-and-further-adjustments">Testing the Changes and Further Adjustments</a></li>
</ul>
</li>
<li><a href="#needing-some-extra-emphasis">Needing Some Extra Emphasis</a></li>
<li><a href="#just-before-the-end">Just Before the End</a><ul>
<li><a href="#the-research">The Research</a></li>
<li><a href="#fixing-the-issue_1">Fixing the Issue</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2020/10/26/markdown-linter-delving-into-the-issues-5/">last article</a>,
I continued in my quest to reduce the size of the issues list.  In this article, I
make good progress in removing items from the issues list.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>After having a week where I felt like I barely made any progress, it was nice to get
a week where I was able to get some work done while keeping balance with my personal
life.  For some reason, the stop-and-go nature of last week was not repeated this
week, and I was grateful for it.  But this week was not really about any one of
those issues, just getting some good, solid work in to reduce the size of the
issues list.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/ea62ec32ce232668df57c232a94d5311cc6107f9">14 Oct 2020</a>
and
<a href="https://github.com/jackdewinter/pymarkdown/commit/7ac7e655e3aabe6b220e9ba179f59620284ac9e1">18 Oct 2020</a>.</p>
<h2 id="finishing-up-the-work">Finishing Up the Work<a class="headerlink" href="#finishing-up-the-work" title="Permanent link">¶</a></h2>
<p>After a day’s rest from writing that week’s article, I looked at my notes and noticed
there was one little issue that was left over from the last weeks’ worth of work:</p>
<div class="highlight"><pre><span></span>- test_paragraph_extra_b5 - adding extra newline somewhere, possibly not clearing after previous image?
</pre></div>
<p>Basically, I was not able to get the <code>test_paragraph_extra_b5</code> function to pass before
the end of the previous week, so I marked it with <code>@pytest.mark.skip</code> to disable the
test until I could look at it.  Not wanting to leave things undone, this was the number
one thing on my list for this week.</p>
<p>Looking at the Markdown document and the HTML output, everything looked fine.  It was
when I looked at the tokens and saw the issue that it came flooding back to me: there
was a problem with the newlines.  Specifically, there was a problem with the Text token
following the test document’s Image token:</p>
<div class="highlight"><pre><span></span>    <span class="s2">"[text(3,19):</span><span class="se">\n</span><span class="s2">def::</span><span class="se">\n\n</span><span class="s2">]"</span><span class="p">,</span>
</pre></div>
<p>If things are working properly, the number of newline characters in the text field is
equal to the number of new characters in the extracted field.  In this case, the text
field contains one newline character, but the extracted whitespace contains two newline
characters.  And once I saw that pattern, I was able to see it in other similar tests.
In total, there were 16 Paragraph token tests and 12 SetExt Heading token tests that
exhibited this behavior.  The key was that in each case, the Text token followed an
Image token and preceded the end of block token.</p>
<h3 id="digging-in">Digging In<a class="headerlink" href="#digging-in" title="Permanent link">¶</a></h3>
<p>Now I had a pattern, so it was time to fix it. I started by turning the debug log on and
working my way through the data for the test.  There was a substantial amount of data,
but using my experience on the project, I was able to quickly narrow the search to
something
in the inline processing section.  Taking a look at the tokens produced right before
the inline processing started, everything looked right.  I then decided to focus on the
inline processing based on that information.</p>
<p>Digging into the Inline Processor, I followed the processing along token by token,
right up to and including the Image token and everything looked fine.  Even the
processing for the Text token itself looked fine if it was not for that extra newline
character in the extracted whitespace field.  To narrow down where that character was
being added,
I started with some debug to log the tokens at various stages of the processing,
and the data confirmed my previous statement.  From a token point of view, everything
looked perfect.</p>
<p>To me, that just left the tidying up after the tokens.  Because of the way the parser
is designed, the inline text is accumulated until an inline token is required.  Once
that token is created, the parser then grabs all the characters up to the start of that
token, creates a Text token with that information, and adds it before adding the new
token.  I stared at the code that created the token, and wondered what the problem
could be.</p>
<div class="highlight"><pre><span></span>    <span class="n">inline_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">TextMarkdownToken</span><span class="p">(</span>
            <span class="n">current_string</span><span class="p">,</span>
            <span class="n">starting_whitespace</span><span class="p">,</span>
            <span class="n">end_whitespace</span><span class="o">=</span><span class="n">end_string</span><span class="p">,</span>
            <span class="n">line_number</span><span class="o">=</span><span class="n">last_line_number</span><span class="p">,</span>
            <span class="n">column_number</span><span class="o">=</span><span class="n">last_column_number</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
<p>It was on a hunch more than anything else that I decided to look at the <code>end_string</code>
variable. This variable is where the extra whitespace stripped from the end of the line
is stored. Looking at this variable’s impact on the logs, I noticed a couple of “holes”
that I filled with extra debug log statements.  It was with that information that I was
able to pinpoint that along the way to the creation of that Text token, the extra
newline character was appearing.  Tracking backwards, it soon became clear that the
issue was that the <code>end_string</code> was being assigned that newline character, but it was
not been cleared properly.</p>
<h3 id="fixing-the-issue">Fixing the Issue<a class="headerlink" href="#fixing-the-issue" title="Permanent link">¶</a></h3>
<p>After about 45 minutes of additional debugging and fiddling, the answer final came to
me.  When the <code>inline_response.consume_rest_of_line</code> field was set, four different
fields and variables were being reset.  The thinking here was that if the different
handlers indicated that they had consumed the rest of the data on the line, there
was not anything else to do.  But one thing was forgotten: the resetting of the
<code>end_string</code> variable.</p>
<p>Sometimes a fix is rewriting some logic, and sometimes a fix is adding some new logic to
handle a missed case. This time, the fix was just about completing the reset action.
Adding a single line in the <code>if inline_response.consume_rest_of_line:</code> block was
all that was needed:</p>
<div class="highlight"><pre><span></span>        <span class="n">end_string</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
<p>Anticlimactic that it was only resetting one variable on one line, but that is the way
it sometimes is.  Lots of looking only to find out something small was missed.  With
the research I completed, it did make sense though.  Without that variable being reset
to <code>None</code>, the newline character from a previous line was being carried through to
the Text token after the Image token.</p>
<p>Once I verified that the fix worked with that one test, I ran the entire suite of tests
with the new code in place.  Comparing the test failures to the set of 16 Paragraph
token tests and 12 SetExt Heading token tests, there was a 100% match!  After
approximately 3 hours of work, I had found that small but required change!</p>
<h2 id="being-more-precise">Being More Precise<a class="headerlink" href="#being-more-precise" title="Permanent link">¶</a></h2>
<p>The first part of this task was to perform some catch-up work on code coverage.  Having
forgotten to check the coverage with recent changes, I was happy that there were only
two small areas that
I needed to improve on.  Even better, both were cases where I had added defensive
code that was not being utilized.  As such, removing that code from the
<code>__consume_text_for_image_alt_text</code> function and the
<code>__complete_inline_block_processing</code> function returned the code coverage numbers to
their normal levels.</p>
<p>With that task under my belt, I decided to address an issue that has been bugging me
for a couple of weeks: the <code>rehydrate_index</code> assert.  Located in the
<code>__handle_last_token_text</code> function, I have improved this assert over the last few
weeks.  While it started off as a simple “less than” expression, it was now down
to a comparison between the count of newlines in the tokens and the <code>rehydrate_index</code>
field.  My problem with it?  As improved as it was, it was still checking to see if
the <code>rehydrate_index</code> field was either equal to <code>num_newlines</code> or <code>num_newlines + 1</code>.</p>
<p>As documented in past articles, I have incrementally improved this check to the
point where it was when I started this work.  But the real target was always to get
that assert statement down to a one-part expression.  Specifically, based on its usage,
the goal was to get the statement down to:</p>
<div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">last_block_token</span><span class="o">.</span><span class="n">rehydrate_index</span> <span class="o">==</span> <span class="p">(</span><span class="n">num_newlines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">¶</a></h3>
<p>Starting the work on this task, the first thing I did was to figure out the amount of
work I needed to do.  In this case, the best way to do this was to make the change
detailed at the end of the last section and look for failures.  While it was not
research in the typical way that I do it, it was useful.  It pointed out that all the
scenario test expect for approximately 15 scenario tests were passing.  This was
useful for both marking a starting point and for my confidence.</p>
<p>As I started digging into the failures, those tests started to separate themselves
into two distinct groups: those with code spans including newline characters and
Text tokens occurring at the end of Paragraph blocks.  While the work took a long
time, in both cases the process was the same.  I started by isolating one test in the
group I was looking at, then looked at the consistency check output to find a pattern
that made sense.  Then I just kept on drilling and adding debug where needed until
the pattern became visible to me.  Now, as I have been working on this project for
a while, the “until a pattern became visible” to me is guided by experience and
enhanced by luck, and both just take time.</p>
<p>After a while, the pattern that leapt out at me for the code span tests was simple:
the line number was being updated properly, but the <code>rehydrate_index</code> field was not
being updated.  Adding some extra debug, I was able to validate that quickly, then
adding the follow code to remedy that problem:</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="n">last_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_paragraph</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">link_stack</span><span class="p">:</span>
            <span class="n">last_token</span><span class="o">.</span><span class="n">rehydrate_index</span> <span class="o">+=</span> <span class="n">num_columns</span>
</pre></div>
<p>Having found and fixed that issue, the second group was then easier to see.  Seeing
as a not updated <code>rehydrate_index</code> field was the issue with the problem, I gave it
a short with this one, and it worked here as well!  Once again, a quick fix solved
the issue.  Executing the tests with the new changes in place, the consistency checks
were now testing against my intended target of:</p>
<div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">last_block_token</span><span class="o">.</span><span class="n">rehydrate_index</span> <span class="o">==</span> <span class="p">(</span><span class="n">num_newlines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
<h2 id="paragraphs-ending-with-multiline-non-text-inlines">Paragraphs Ending with Multiline Non-text Inlines<a class="headerlink" href="#paragraphs-ending-with-multiline-non-text-inlines" title="Permanent link">¶</a></h2>
<p>That title is a mouthful, but accurate.  The next issue that I tackled was:</p>
<div class="highlight"><pre><span></span> - repeat __handle_last_token_text with paragraphs ending with other inlines
</pre></div>
<p>I was not sure if this was going to be a problem, but I can see why I added this to
the issues list.  Most of the existing tests were focused on a specific Markdown
element and either ended with that element or text following that element.  Even
harder to find were tests where the element at the end of the block contained a
newline character in the middle of it.  So, while I found an isolated scenario test
here and there that tackled some of these combinations, there was not a good solid
“here it is” block of tests.</p>
<p>Time to change that!  To address this, I added test functions <code>test_paragraph_extra_c7</code>
to <code>test_paragraph_extra_d4</code>.  Quite simply, I added 8 tests, 4 tests for links and
4 tests for images.  Within each group of 4 tests, I added a split Text element,
a split Code Span element, a split Raw Html element, and a split Emphasis element.
It was not rocket science, but it was good to have all those tests in one place,
ensuring that I was addressing that concern.  Even better?  They all worked on the
first try.</p>
<h2 id="expanding-paragraph-tests-to-setext-heading-tests">Expanding Paragraph Tests to SetExt Heading Tests<a class="headerlink" href="#expanding-paragraph-tests-to-setext-heading-tests" title="Permanent link">¶</a></h2>
<p>With a metaphorical bounce in my step after addressing the last issue,  I decided to
tackle the copying and transformation of Paragraph tests to SetExt Heading tests.
While not officially on the issues list, my goal was to keep the extra Paragraph tests
synced up with their cousins, the extra SetExt Heading tests.  I am not sure if the
right term is cousins, but that is how I thought of them, as the only difference between
the two groups of tests was their
parent blocks.  The contents of the tests remaining the same, except for the addition
of a SetExt Heading block terminator.</p>
<p>As I knew that these tests were based off existing Paragraph tests, it was pretty
simple to go through the new tests and adjust them to use a SetExt Heading token instead
of a Paragraph heading token.  While simple, even the creation of copied test
functions <code>test_setext_headings_extra_a3</code> to <code>test_setext_headings_extra_d4</code> took some
time to get right.  But once again, I was rewarded for my hard work with tests that all
passed, with no failures.</p>
<h2 id="are-links-being-verified-properly">Are Links Being Verified Properly?<a class="headerlink" href="#are-links-being-verified-properly" title="Permanent link">¶</a></h2>
<p>This task was not to solve the following issue, but to research it:</p>
<div class="highlight"><pre><span></span>- are links getting verified properly in checks? images are, cannot find link code for same
</pre></div>
<p>Based on previous tasks, I have done extensive work on making sure that any image
links were verified properly.  However, I have previously noticed that the same
rigor had not been applied to the Link token.  While I did not want to solve the
issue right away, I wanted to make sure I had the right information to resolve it
later.</p>
<p>And it did not take me long to finally figure out why this issue that had been bothering
me for a while.  The big issue here was that I was missing validation in cases where
an end token was present.  Specifically, while the end Emphasis token has a line/column
number attached to it, the end Link token does not.  That meant that when the previous
token validation was occurring, the existing code was doing the equivalent of a digital
shrug and letting it go.  That was the real crux of the problem.</p>
<p>Additionally, the Image token was of interest.  Doing a double check of my findings, it
became
immediately obvious why it escaped the same fate: it is a whole token.  Whereas the
Link token has a start token, the inner text, and then an end token, the Image token is
entirely self-contained.  As such, everything is processed at one time, and no end token
handling is required, thus the processing for an empty line/column number was avoided.</p>
<p>It was clear to me that solving this would require some serious planning and thinking.</p>
<h2 id="adding-proper-link-verification">Adding Proper Link Verification<a class="headerlink" href="#adding-proper-link-verification" title="Permanent link">¶</a></h2>
<p>Given the research from the last section, I decided to take the time needed to tackle
that issue properly.  Dedicating a minimum of 4 hours to this task, I sat down and
started to work the problem.</p>
<p>To keep things simple, I am going to keep track of the pseudo-code for this solution
instead of the actual code.  While it is true that the code needs some major refactoring
to occur, the more important reason is that it is just very verbose.  The big reason
for me to relay this information is that I found this useful during my development
of the solution.  While the algorithm at its base components is simple, I just found
keeping it in my head in a clear and concise form was too much.</p>
<h3 id="step-1">Step 1<a class="headerlink" href="#step-1" title="Permanent link">¶</a></h3>
<p>The first issue was that I needed to have an anchor to base the consistency check’s
line/column numbers from.  As the end Link token does not have a line/column
number associated with it, I first needed to add some code to look backwards in the
token stream for the first valid line/column number.   While I was initially worried
about possible interactions between the end Emphasis token and the end Link token,
I eventually determined that exploring that path was a dead end.  Because the end
Emphasis token has a line/column number, it can serve as an anchor token just as
well as any other token.</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nv">search</span> <span class="nv">backwards</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">token</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">last</span> <span class="nv">token</span> <span class="nv">to</span> <span class="nv">have</span> <span class="nv">a</span> <span class="nv">valid</span> <span class="nv">line</span><span class="o">/</span><span class="nv">column</span> <span class="nv">number</span>
</pre></div>
<h3 id="step-2">Step 2<a class="headerlink" href="#step-2" title="Permanent link">¶</a></h3>
<p>With that anchor in place, it was then possible to apply the translations to the
line/column number.  This was mostly due to how the link is constructed.  In the
case of a simple inline link such as <code>[link](/url)</code>, the <code>[</code> is processed,
then the link label text <code>link</code>, and then the rest of the link text.  When the
end Link token is encountered, the remaining text <code>](/url)</code> needs to be accounted
for.</p>
<p>Starting with the code for the handling of the Image token, I was able to quickly
build up a similar block of code that provided the translations for the line/column
number.  As I had a pattern to work off of, this work went by fairly quickly.</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nv">search</span> <span class="nv">backwards</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">token</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">last</span> <span class="nv">token</span> <span class="nv">to</span> <span class="nv">have</span> <span class="nv">a</span> <span class="nv">valid</span> <span class="nv">line</span><span class="o">/</span><span class="nv">column</span> <span class="nv">number</span>
<span class="o">-</span> <span class="nv">apply</span> <span class="nv">the</span> <span class="nv">translations</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">line</span><span class="o">/</span><span class="nv">column</span> <span class="nv">number</span> <span class="nv">due</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">rest</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">Link</span> <span class="nv">token</span>
</pre></div>
<h3 id="step-3">Step 3<a class="headerlink" href="#step-3" title="Permanent link">¶</a></h3>
<p>With that work in place, I then went to handle the previous token in the normal
case and hit an issue.  The anchor line/column number did not seem to be correctly
calculated. I double checked my code, and everything looked fine.  Doing some
deep digging, I started to understand why.  When I figured out which token to use as
the anchor, I did not take into account any changes introduced
to the line/column number by the anchor token itself.  Basically, if I was
using a Text token containing <code>text</code> at <code>(2,7)</code> as an anchor, I was using that
<code>(2,7)</code> as the starting point, ignoring any changes introduced by its contents.
Instead, I needed to use <code>(2,11)</code> as the starting point, taking the length of
the token’s original Markdown into account.</p>
<p>The saving grace here was that immediate calculations were okay, so I just added the
code following the previously added code.  While it does not affect the results, in
hindsight I might want to move the translation code for the anchor token up to make sure
that the code logically flows better.</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nv">search</span> <span class="nv">backwards</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">token</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">last</span> <span class="nv">token</span> <span class="nv">to</span> <span class="nv">have</span> <span class="nv">a</span> <span class="nv">valid</span> <span class="nv">line</span><span class="o">/</span><span class="nv">column</span> <span class="nv">number</span> <span class="ss">(</span><span class="nv">anchor</span> <span class="nv">token</span><span class="ss">)</span>
<span class="o">-</span> <span class="nv">apply</span> <span class="nv">the</span> <span class="nv">translations</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">line</span><span class="o">/</span><span class="nv">column</span> <span class="nv">number</span> <span class="nv">due</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">rest</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">Link</span> <span class="nv">token</span>
<span class="o">-</span> <span class="nv">apply</span> <span class="nv">the</span> <span class="nv">translations</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">line</span><span class="o">/</span><span class="nv">column</span> <span class="nv">number</span> <span class="nv">due</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">anchor</span> <span class="nv">token</span>
</pre></div>
<h3 id="testing-the-changes-and-further-adjustments">Testing the Changes and Further Adjustments<a class="headerlink" href="#testing-the-changes-and-further-adjustments" title="Permanent link">¶</a></h3>
<p>Having executed an isolated scenario test or two during these changes, I then went to
execute those tests again, and the results were hopeful.  From what I could see, the
line/column number calculations
were working properly, but another assert was getting fired.  After a quick check,
I came to an interesting observation: while looking at the line/column numbers and
making sure they were being adjusted properly, I totally forgot about the
<code>rehydrate_index</code> field.</p>
<p>Most of the adjusting went off without a hitch, but a couple of outlying tests
were still failing with the assert for the <code>rehydrate_index</code> field.  It took me
a good couple of hours of adding debug statements and scanning the consistency
check output before I found the pattern.  While I had just added code to adjust
the <code>rehydrate_index</code> field to account for the Link token, I had failed to adjust
the field to account for the anchor token.  As such, if the token before the end
Link token (the anchor token) contained one or more newline characters, those
newline characters were missed.</p>
<p>Fixing that problem took a bit of creativity.  I already had the code to properly
calculate the proper values, but they were in the <code>__process_previous_token</code> function.
The problem with reusing that function was that it modifies the <code>rehydrate_index</code> field
as a side effect, something I was not sure that I wanted to happen.  In the end, I
worked around this problem by doing a sample call to the <code>__process_previous_token</code>
function and getting the change in the line number, then invoking that function
again on the anchor token, applying the proper change and restoring the
<code>rehydrate_index</code> field.  It took a while to figure that out and get it working, but
it was worth it.</p>
<p>With that code in place, I ran those tests again, and the consistency checks for
the small sample of tests I was using passed.  Crossing my fingers, I ran it for
the entire set of scenario tests and was happy to see that they all had passed.
While it took quite the while to accomplish, it was good to finally put that issue
to rest.</p>
<h2 id="needing-some-extra-emphasis">Needing Some Extra Emphasis<a class="headerlink" href="#needing-some-extra-emphasis" title="Permanent link">¶</a></h2>
<p>While the description for this issue was:</p>
<div class="highlight"><pre><span></span>- add verification for links with the endlink as the last element
- add verification for links+emphasis as the last 2 inline elements
</pre></div>
<p>I felt that it really did not describe the problem properly.  Added when addressing
the previous issue, what I believe I was trying to note is that I wanted more
testing with the interaction with the end Link token and the end Emphasis token.  At
the time when I added that note, I remember thinking that there might be some weird
interaction between the two end tokens.  It was only later that I remembered that the
end Emphasis token was the rare end token that has a line/column number attached to it.</p>
<p>Still, it made sense to add some extra tests for emphasis and interactions with the
link tokens, as I did not believe I had good coverage of that so far.  To remedy that,
I added test functions <code>test_paragraph_extra_d7</code> to <code>test_paragraph_extra_e0</code>, with
emphasis around the the link and image elements followed by emphasis within the link
label of the link and image elements.  These tests were not at all complicated to add
and I am also not sure they are actually needed.  However, as I perceived testing in
that area to be a bit thin, adding those tests just seems to me to be a good idea.
And luckily, after running those new tests, everything passed without incident.</p>
<h2 id="just-before-the-end">Just Before the End<a class="headerlink" href="#just-before-the-end" title="Permanent link">¶</a></h2>
<p>I remember looking at the clock and noticing that I had around 20 minutes left before I
started writing that week’s article at noon.  While I used to start writing first thing
Sunday morning, as
of recently I have tried to keep my notes in a way that I could more easily mine them
for the articles.  Still in the proving stage, it has helped me out with the writing
process, allowing me to find my flow more easily on Sunday at noon when I now start
writing.</p>
<p>Anyhow, with somewhere near 20 minutes left before noon on a Sunday and me wanting to
milk the clock for every minute that I could, I quickly looked at the issues list.
I was hopeful that I could find some
<a href="https://www.merriam-webster.com/dictionary/low-hanging%20fruit">low-hanging-fruit</a>
to work on in the time remaining, and quickly came across this little gem:</p>
<div class="highlight"><pre><span></span>- code span
  - multiple lengths of ticks, whitespace
</pre></div>
<p>I felt that this was a good candidate, but I still needed to investigate it.  At the
very least, I could get the research done and have it ready for next week.</p>
<h3 id="the-research">The Research<a class="headerlink" href="#the-research" title="Permanent link">¶</a></h3>
<p>After some quick research, I found out that while the scenario tests between (and
including) the <code>test_code_spans_338</code> function and the <code>test_code_spans_359</code>
function has some interesting variations, I felt that they were missing some basic
coverage.  Looking at those tests, it was pretty evident that tests with variations
on the number of backticks and the amount of whitespace were in the minority.  Doing
some quick scans for the number of backticks in the tests, my suspicions were confirmed
with only 4 tests dealing with double backticks and no tests dealing with more than two
backticks.  As for whitespace, the tally was similar: 5 tests with one whitespace
character and 1 test with 2 whitespace characters.</p>
<h3 id="fixing-the-issue_1">Fixing the Issue<a class="headerlink" href="#fixing-the-issue_1" title="Permanent link">¶</a></h3>
<p>With that research in hand, I could either document the issue more thoroughly, or fix
the issue.  Looking back at the description of the issue, I inferred that what I was
really looking for was a centralized place where those tests kept, not having to look
for them all over the place.  If that were the case, I figured I could solve the issue
by adding 3 new tests, so I decided to fix the issue.</p>
<p>The 3 new tests?  I started with the text <code>aa`aa`aa</code>, adding one backtick and
one whitespace in critical areas to get <code>aa `` aa `` aa</code> and then finally
<code>aa  ```  aa  ```  aa</code>.  I just kept it simple and created 3 new tests, each
one clearly handling an increasing number of backticks and whitespace.   A quick
execution of the new scenario tests, and… no issues.  Assuming my inference was
correct, problem solved!</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>While there were only a couple of issues that made me really think about how
to solve them, this was a good week for just getting some issues taken care of.
At this point in the project, I am confident that I have 95 percent of the
code working properly.  My hope is that by adding new tests and making sure
that existing tests are grouped properly, I can find those outlier scenarios
that I have not thought of.  Whether those scenarios end up working or failing
is something I cannot control.  But I can strive to find as many of those
scenarios as possible.</p>
<p>And I have noticed that this hope is being largely reflected in the work I am
doing.  Less and less work is in the project’s parser itself, with more
changes being attributed to improving the verification of the parser.  From where
I sit, that is a good place to be in.  The other observation?  In times when I do
need to change the parser, those changes are usually small changes of five lines or
less.  That statistic alone fills me with confidence.</p>
<p>Now, while I do want to find as many scenarios as possible, I need to balance that
with trying to wrap up the initial phase of this project so I can use it and get the
project out there.  For me, that means I need to start buckling down and shifting
my focus away from issues in the “Nice to Have” category and work on the other
issues.  Here’s hoping I can action on that!</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>From my viewpoint, next week’s article will be interesting as I talk about my
efforts to group the tests together more concisely, with documentation to back
up the reasons for those tests.</p>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Delving%20Into%20the%20Issues%20-%206&url=https%3A//jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Delving%20Into%20the%20Issues%20-%206&amp;body=https%3A//jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-delving-into-the-issues-6"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/10/26/markdown-linter-delving-into-the-issues-5/" title="Previous: Markdown Linter - Delving Into the Issues - 5">Markdown Linter - Delving Into the Issues - 5</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/11/09/markdown-linter-delving-into-the-issues-7/" title="Next: Markdown Linter - Delving Into the Issues - 7">Markdown Linter - Delving Into the Issues - 7</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~18 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-11-02T00:00:00-08:00">Nov 2, 2020</time>
        <h4>Markdown Linter Issues</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/09/28/markdown-linter-delving-into-the-issues-1/" title="Markdown Linter - Delving Into the Issues - 1">Part 1: Markdown Linter - Delving Into the Issues - 1</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/" title="Markdown Linter - Delving Into the Issues - 2">Part 2: Markdown Linter - Delving Into the Issues - 2</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/12/markdown-linter-delving-into-the-issues-3/" title="Markdown Linter - Delving Into the Issues - 3">Part 3: Markdown Linter - Delving Into the Issues - 3</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/19/markdown-linter-delving-into-the-issues-4/" title="Markdown Linter - Delving Into the Issues - 4">Part 4: Markdown Linter - Delving Into the Issues - 4</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/26/markdown-linter-delving-into-the-issues-5/" title="Markdown Linter - Delving Into the Issues - 5">Part 5: Markdown Linter - Delving Into the Issues - 5</a>
            </li>
            <li  class="active-part">
            Part 6: Markdown Linter - Delving Into the Issues - 6
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/09/markdown-linter-delving-into-the-issues-7/" title="Markdown Linter - Delving Into the Issues - 7">Part 7: Markdown Linter - Delving Into the Issues - 7</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/16/markdown-linter-delving-into-the-issues-8/" title="Markdown Linter - Delving Into the Issues - 8">Part 8: Markdown Linter - Delving Into the Issues - 8</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/23/markdown-linter-delving-into-the-issues-9/" title="Markdown Linter - Delving Into the Issues - 9">Part 9: Markdown Linter - Delving Into the Issues - 9</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/30/markdown-linter-delving-into-the-issues-10/" title="Markdown Linter - Delving Into the Issues - 10">Part 10: Markdown Linter - Delving Into the Issues - 10</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/07/markdown-linter-delving-into-the-issues-11/" title="Markdown Linter - Delving Into the Issues - 11">Part 11: Markdown Linter - Delving Into the Issues - 11</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/14/markdown-linter-delving-into-the-issues-12/" title="Markdown Linter - Delving Into the Issues - 12">Part 12: Markdown Linter - Delving Into the Issues - 12</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/21/markdown-linter-delving-into-the-issues-13/" title="Markdown Linter - Delving Into the Issues - 13">Part 13: Markdown Linter - Delving Into the Issues - 13</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/28/markdown-linter-delving-into-the-issues-14/" title="Markdown Linter - Delving Into the Issues - 14">Part 14: Markdown Linter - Delving Into the Issues - 14</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/04/markdown-linter-delving-into-the-issues-15/" title="Markdown Linter - Delving Into the Issues - 15">Part 15: Markdown Linter - Delving Into the Issues - 15</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/11/markdown-linter-delving-into-the-issues-16/" title="Markdown Linter - Delving Into the Issues - 16">Part 16: Markdown Linter - Delving Into the Issues - 16</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/" title="Markdown Linter - Delving Into the Issues - 17">Part 17: Markdown Linter - Delving Into the Issues - 17</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/25/markdown-linter-delving-into-the-issues-18/" title="Markdown Linter - Delving Into the Issues - 18">Part 18: Markdown Linter - Delving Into the Issues - 18</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/02/01/markdown-linter-delving-into-the-issues-19/" title="Markdown Linter - Delving Into the Issues - 19">Part 19: Markdown Linter - Delving Into the Issues - 19</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>57</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>75</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2021 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>