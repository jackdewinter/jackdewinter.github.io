<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I increased the coverage provided by the token to Markdown transformer by adding support for the link related tokens. In this article, I take another large step towards completing the consistency checks by adding support for list related tokens. Introduction¶ Having implemented the link related …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Adding Lists to the Markdown Transformer "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" />
<meta property="og:description" content="Summary¶ In my last article, I increased the coverage provided by the token to Markdown transformer by adding support for the link related tokens. In this article, I take another large step towards completing the consistency checks by adding support for list related tokens. Introduction¶ Having implemented the link related …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-08-17T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Adding Lists to the Markdown Transformer ">
<meta name="twitter:description" content="Summary¶ In my last article, I increased the coverage provided by the token to Markdown transformer by adding support for the link related tokens. In this article, I take another large step towards completing the consistency checks by adding support for list related tokens. Introduction¶ Having implemented the link related …">

        <title>Markdown Linter - Adding Lists to the Markdown Transformer  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/">
                Markdown Linter - Adding Lists to the Markdown Transformer
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#starting-with-unordered-lists">Starting with Unordered Lists</a><ul>
<li><a href="#thinking-about-the-design">Thinking About the Design</a></li>
<li><a href="#and-go">And… Go!</a></li>
<li><a href="#first-step-list-indentation">First Step: List Indentation</a></li>
<li><a href="#indented-code-blocks">Indented Code Blocks</a></li>
<li><a href="#handling-lazy-continuations-lines">Handling Lazy Continuations Lines</a></li>
<li><a href="#new-list-item-tokens">New List Item Tokens</a></li>
</ul>
</li>
<li><a href="#taking-care-of-stragglers">Taking Care of Stragglers</a></li>
<li><a href="#second-verse">Second Verse…</a></li>
<li><a href="#cleanup">Cleanup</a></li>
<li><a href="#fixing-example-528">“Fixing” Example 528</a><ul>
<li><a href="#kudos">Kudos</a></li>
<li><a href="#side-by-side-comparisons">Side by Side Comparisons</a></li>
<li><a href="#fixing-the-issue">Fixing the Issue</a><ul>
<li><a href="#reminder-to-self-be-humble">Reminder to Self: Be Humble</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/">last article</a>,
I increased the coverage provided by the token to Markdown transformer by adding
support for the link related tokens. In this article, I take another large step
towards completing the consistency checks by adding support for list related tokens.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>Having implemented the link related tokens, I was now down to one large group:
the container related tokens.  Even with the confidence I gained from the work that
I performed with link related tokens, I felt that “container related tokens” was
too large of a group for me to be comfortable working with.  Given that the container
related tokens group contained only 2 types of tokens, it only seemed natural to focus
on one of those two tokens: the list tokens.  More specifically, I was going to
start with the Unordered List tokens.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/6f7fa825b3cd6bad52cd5b9772a0f35dc816b629">04 Aug 2020</a>
and
<a href="https://github.com/jackdewinter/pymarkdown/commit/07d6f81c6c6b46c3ae9c526a3d176d65ddf06c54">08 Aug 2020</a>.</p>
<h2 id="starting-with-unordered-lists">Starting with Unordered Lists<a class="headerlink" href="#starting-with-unordered-lists" title="Permanent link">¶</a></h2>
<p>Taking a wander through the scenario tests with unordered lists in their examples,
two things were clear to me.  The first thing is that with few exceptions, they were all
working well from the point of view of existing consistency checks.  Those few examples
were 1 case with nested links and 4 cases which mixed up block quotes with list.
Those examples are
<a href="https://github.github.com/gfm/#example-528">example 528</a>,
<a href="https://github.github.com/gfm/#example-237">example 237</a>,
<a href="https://github.github.com/gfm/#example-238">example 238</a>,
<a href="https://github.github.com/gfm/#example-270">example 270</a>, and
<a href="https://github.github.com/gfm/#example-271">example 271</a>.
The second thing that was clear was that because of the first
point, I had a high degree of confidence that I was going to be addressing issues that
almost exclusively focused on whitespace.  With the HTML output already being verified,
I was certain that properly transforming Unordered List tokens back into list Markdown
would mostly boil down to whitespaces.</p>
<h3 id="thinking-about-the-design">Thinking About the Design<a class="headerlink" href="#thinking-about-the-design" title="Permanent link">¶</a></h3>
<p>Before I leapt into the coding, I sat back and thought long and hard about the approach
I was going to take with the transformation of these tokens.  When I started sketching
out what my approach would be, I started to understand that there would be two issues
I would have to deal with.  They were the transformation of the tokens themselves, and
the whitespace they would inject before other tokens.  The first part was the easy
part: see
an unordered list token, use the elements in the token to figure out its transformed
form, and emit that transformed form.  Done.</p>
<p>Managing the whitespace was going to be a lot more difficult.  The thing that helped
me was that I knew I already had experience with handling that initial whitespace from
writing the main parser.  What helped me immeasurably in the
parser was to keep the processing of the two container elements, lists and block
quotes, separate from the processing of the leaf tokens.  By only passing “container
element free” text to the
leaf token processor, that processor was kept simple.  To keep the container handling
for the Markdown transformer simple, I decided that employing the same approach was
pivotal.</p>
<p>But even with the decision to keep that processing separate, I figured that it would
only get me
part of the way there.  To complete the management of the whitespaces, I would need to
be able to calculate the whitespace used before each line contained within a list block.
The more I looked at the problems to be solved, the more I was sure that most of my
time was going to be managing that initial whitespace.</p>
<p>It was not going to be fun getting the transformations done for the Unordered List
tokens, but I had a feeling that it would be really satisfying when it was done!</p>
<h3 id="and-go">And… Go!<a class="headerlink" href="#and-go" title="Permanent link">¶</a></h3>
<p>I began this block of work with the moving of the if statement that avoided processing
any scenario test that included block quotes or lists starts.  Before that move, it
was buried in a large collection of if statements, and I wanted to make sure I called
it out until it was fixed. Making it even better, when I moved it, I broke that single
statement into three explicit statements. As I knew I was going to be enabling
each one in the next week or so, being explicit about that work just seemed like the
right thing to do.  But even though the move was mostly for aesthetics, I confess
that it was also to remind me that I only had those tokens left to go.</p>
<p>Once that was completed, I did the easy work first and added the
<code>rehydrate_unordered_list_start</code> function and the <code>rehydrate_unordered_list_start_end</code>
function to the main processing loop.  After running the scenario tests again, I
was reminded by the test output that the <code>rehydrate_next_list_item</code> function would have
to be added to deal with the Next List Item tokens in the stream.  Another quick run of
the tests and a lot of comparison failures, but no missing token failures.  A good
step in the right direction!</p>
<h3 id="first-step-list-indentation">First Step: List Indentation<a class="headerlink" href="#first-step-list-indentation" title="Permanent link">¶</a></h3>
<p>With the actual token handlers dealt with, it was time to focus on the effects that
those tokens had
on the leaf blocks.  Following my usual pattern, instead of immediately creating a
new function to specifically handle the lists, I kept that code inline with the
existing <code>transform</code> method the Markdown transformer.  While I recognize that it
looks messy and sloppy and the outset, it helps me think more clearly without worrying
about that I need to pass where.</p>
<p>Therefore, following my usual pattern, I first added a simple post-processing step that
took the
contents of the variable <code>continue_seq</code> and applied them to start of the output of
specific tokens.  The <code>continue_seq</code> variable was initialized with an empty string,
but I altered the <code>rehydrate_unordered_list_start</code> function to reset this variable
to the amount of indent specified by the list.  With the change in place, the end
of the loop processing was simple:</p>
<div class="highlight"><pre><span></span>        <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="n">continue_seq</span><span class="p">)</span>
</pre></div>
<p>This gained some traction in getting the
scenario tests passing, but that processing needed to be made a bit more complicated.  </p>
<p>The first complication that needed to be addressed was that both list starts, and list
ends modified the <code>continue_seq</code> variable, but needed to avoid applying it to
the line on which they element resided.  This was because the processing of the
Unordered List start token
already had the required indenting taking care of, so the postprocessing would just
add extra “garbage” whitespace. To remedy this, I added the <code>skip_merge</code> variable to
allow the Unordered
List token handlers to inform the main loop to skip any post-processing.</p>
<p>The second complication was the handling the list terminations using the
<code>rehydrate_unordered_list_start_end</code> function.  In some of the easy cases, what was
there was fine, but as soon a list was nested in another list, that processing fell
apart.  What was missing was a recalculation of the indent level once the prior list
ends.  That was quickly addressed by doing a recalculation of the contents for the
<code>continue_seq</code> variable for the new list token at the top of the stack.</p>
<p>With those easy fixes, and with the main replacement call in the main loop, a lot
of the scenario tests were passing, while keeping the processing simple.</p>
<p>That simplicity would soon change.</p>
<h3 id="indented-code-blocks">Indented Code Blocks<a class="headerlink" href="#indented-code-blocks" title="Permanent link">¶</a></h3>
<p>As I went through the test failures, there were a few failures that stood out as an odd
grouping: indented code blocks and lists.  Doing some more research, I found out
that due to a bug in my code, the indented code blocks were not being checked
properly.  It only involved one list item scenario test, but nonetheless,
it still needed to be fixed.</p>
<p>In that newly found bug, the problem was that the indented code blocks were always
adding their indented padding at the beginning of the lines.  This was not usually a
problem, but with any examples that contained blank lines within the indented code
block, it was an issue.  A good example of this is
<a href="https://github.github.com/gfm/#example-81">example 81</a>:</p>
<div class="highlight"><pre><span></span>    <span class="n">chunk1</span>

    <span class="n">chunk2</span>
<span class="err">{</span><span class="k">space</span><span class="err">}{</span><span class="k">space</span><span class="err">}</span>
<span class="err">{</span><span class="k">space</span><span class="err">}</span>
<span class="err">{</span><span class="k">space</span><span class="err">}</span>
    <span class="n">chunk3</span>
</pre></div>
<p>When the parser tokenizes this example, the Blank Line tokens that are generated
already include any whitespace that is present on that line.  Taking care of their own
whitespace data, when the Markdown transformer interprets those Blank Line tokens,
it needs to accept those Blank Line elements as they are.
Modifications were needed to enforce this behavior.  The <code>combine</code> function of the
<code>TextMarkdownToken</code> class containing the indented blank line was changed to insert
a NOOP character and then a newline character.  As text used in an indented code
block was the only <code>paragraph-like</code> encapsulating token that inserted a blank line
into the composed text, had confidence this was isolated.</p>
<p>With those NOOP characters in place, the Markdown transformer needed some modifications
to
understand how to deal with this.  Before proceeding with the normal insertion of
any whitespace in the <code>continue_seq</code> variable, a quick check was made to see if
the <code>new_data</code> variable contained a NOOP character.  If so, the string in the
<code>new_data</code> variable was split and processed.  For each element in the split list,
the element was checked to see if it started with a NOOP character.  If it did it
simply removed the NOOP character by setting the <code>replacement_data</code> variable to
the contents of the <code>new_data</code> variable after that first NOOP character.  If it did not
find it, it set the <code>replacement_data</code> variable to the contents of the <code>continue_seq</code>
variable plus the contents of the <code>new_data</code> variable.  Once that was done, the value
was put back in into the array at the same index.  Then,
when the processing was done, it reconstituted the <code>new_data</code> variable by joining the
elements of the list back together using the <code>\n</code> character as a joining character.</p>
<p>While I was not looking for that, I was glad I found it. A bit embarrassed that I
did not find it right away, but I did find it!</p>
<h3 id="handling-lazy-continuations-lines">Handling Lazy Continuations Lines<a class="headerlink" href="#handling-lazy-continuations-lines" title="Permanent link">¶</a></h3>
<p>With most of the scenario tests now passing, my focus was centered on a set of tests
that dealt with lists and lazy handling.  While this took me a bit to get my head
around, it basically says:</p>
<blockquote>
<p>If a string of lines Ls constitute a list item with contents Bs, then the result of deleting some or all the indentation from one or more lines in which the next non-whitespace character after the indentation is paragraph continuation text is a list item with the same contents and attributes. The unindented lines are called lazy continuation lines.</p>
</blockquote>
<p>Huh?  Let me translate:</p>
<blockquote>
<p>If you have a list already started, and you encounter lines that should be in the list except for the fact that they are not indented properly, they are lazy continuation lines, and are included.</p>
</blockquote>
<p>The best way to explain is with an example:<sup id="fnref:lazyList"><a class="footnote-ref" href="#fn:lazyList">1</a></sup></p>
<div class="highlight"><pre><span></span><span class="nv">first</span> <span class="nv">list</span> <span class="nv">item</span>
<span class="k">next</span> <span class="nv">line</span> <span class="nv">of</span> <span class="nv">first</span> <span class="nv">list</span> <span class="nv">item</span>
 <span class="k">next</span> <span class="k">next</span> <span class="nv">line</span> <span class="nv">of</span> <span class="nv">first</span> <span class="nv">list</span> <span class="nv">item</span>
</pre></div>
<p>In that example, all three of those lines are considered part of the list item, even
though the line is indented less than the indent of 2 specified by the initial list
item element.  But that presented a bit of a problem.</p>
<p>When parsing the Markdown document, the indent level was being tracked, and any
additional whitespace was added to the contained token.  But as I was writing the
Markdown transformer, I noticed that I had missed the case where the amount of indent
was less than the current list’s indent level.  This was not an issue with the HTML
transformer, as that transformer does not rely on any of the extracted whitespace.
However, the Markdown transformer does.</p>
<p>To fix this issue, I needed to first make a change in the <code>parse_paragraph</code> function of
the <code>LeafBlockProcessor</code> class.  In that function, I reconstituted the actual indent
of the given line and compared it against the indent level from the dominant unordered
list item token.  If that actual indent level was less than the dominant indent level,
I adjusted the actual whitespace by prefacing that whitespace with…well… blech
characters.</p>
<p>Yes, blech characters.  Blech, according to
<a href="https://www.merriam-webster.com/dictionary/blech">Webster’s</a> means “used to express
disgust”.  While I knew I had to track those indenting characters somehow, I really
was not happy with it.  Disgust may be a bit too intense of an emotion, but when I
figured out what I had to do, that was the most printable word that I uttered.</p>
<p>Using the above example, the tokenized text looks like:</p>
<div class="highlight"><pre><span></span>- first list item{newline}
{blech}{blech}next line of first list item{newline}
{blech}next next line of first list item{newline}
</pre></div>
<p>In this way, the indent was properly represented in the token, and the Markdown
transformer had enough information to rehydrate the data afterwards.  With those
changes locked into the tokens, the Markdown transformer was then able to be
changed to understand those tokens.  That processing was simple.  If a line of
the text output started with a blech character, those blech characters were
replaced with a space character.  If no blech characters were there, the normal
replacement of the newline character would occur.</p>
<p>And I could
have changed the name of the character from “blech character”, but after a while,
it just kind of stuck with me.</p>
<h3 id="new-list-item-tokens">New List Item Tokens<a class="headerlink" href="#new-list-item-tokens" title="Permanent link">¶</a></h3>
<p>It was about this time when I decided to tackle the New List Item tokens.  While I had
been working around them somewhat, it was starting to get to the point where they were
unavoidable.  At first, I did not think these tokens would be an issue, but I forgot
about one little part of the New List Item tokens: they reset the indent for the
list.</p>
<p>A good example of this is <a href="https://github.github.com/gfm/#example-290">example 290</a>:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">a</span>
 <span class="o">-</span> <span class="n">b</span>
  <span class="o">-</span> <span class="k">c</span>
   <span class="o">-</span> <span class="n">d</span>
  <span class="o">-</span> <span class="n">e</span>
 <span class="o">-</span> <span class="n">f</span>
<span class="o">-</span> <span class="k">g</span>
</pre></div>
<p>In this case, the first line starts a list and each line after that starts a new list
item.  As the new list items are gradually increasing and then decreasing the indent,
the 3 middle lines (<code>c</code>, <code>d</code>, and <code>e</code>) are interpreted as a new list item element,
rather than a sublist.  If it was not for the new list item elements resetting that
indent, those 3 lines are indented to the point where their indent would make them
eligible to start a new sublist.</p>
<p>But to properly track this indent change, it required some interesting thinking.  If
I tracked the indent change in the actual token, it would mean changing that token.
To me, that was a non-starter.  Instead, I added a separate stack for container tokens
in the Markdown transformer and added copies of the container tokens to this stack.
As I added copies of the tokens to the stack, I was free to change the indent value
located within the Unordered List token without worrying about side effects.</p>
<p>With those changes in place, the Markdown transformer was able to reset the indent
level and make sure it was being properly tracked.  This meant that the indents
were able to be properly reset to the correct value once a List Item end token was
received for a sublist.</p>
<p>Taking a bit of a deep breath and a pause, I noticed that I was close to finishing
off the Unordered List Item tokens.  That gave me a bit of a jump in my step to
clean things up!</p>
<h2 id="taking-care-of-stragglers">Taking Care of Stragglers<a class="headerlink" href="#taking-care-of-stragglers" title="Permanent link">¶</a></h2>
<p>With all the major and minor cases of lists dealt with, I started going through
the other scenario tests, fixing up the token lists after verifying that the new
tokens were correct.  Everything else was easily resolved at this point, except for
some lists in a couple of cases.  Those cases were interesting in that there was
actually too much whitespace, not too little.  And in this case, it was a newline
character, not a space.</p>
<p>The Fenced Code Block element and the SetExt Heading element are unique in that they
have a line-based sequence that delimits the end of the element.  Usually this is not
a problem, but in the case of interacting with lists, the transformer was inserting
a newline after the element itself, and then another newline to make the end of that
line.  While this duplication did not occur all the time, it took a bit to figure
the exact sequence that triggered this.</p>
<p>After doing some research, it was weird to me, but it only occurred if:</p>
<ul>
<li>it was one of these two elements</li>
<li>the new block of data ends with a newline character</li>
<li>the next token to be processed is a New List Item token</li>
</ul>
<p>While the sequence of thing that had to occur was weird, the solution was easy:</p>
<div class="highlight"><pre><span></span>        <span class="n">block_should_end_with_newline</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">next_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="s2">"end-fcode-block"</span><span class="p">:</span>
            <span class="n">block_should_end_with_newline</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">delayed_continue</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="k">elif</span> <span class="n">next_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="s2">"end-setext"</span><span class="p">:</span>
            <span class="n">block_should_end_with_newline</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="o">...</span>
        <span class="n">block_ends_with_newline</span> <span class="o">=</span> \
            <span class="n">block_should_end_with_newline</span> <span class="ow">and</span> <span class="n">new_data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">block_ends_with_newline</span>
            <span class="ow">and</span> <span class="n">next_one</span>
            <span class="ow">and</span> <span class="n">next_one</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_new_list_item</span>
        <span class="p">):</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">continue_seq</span><span class="p">)]</span>
</pre></div>
<p>Basically, if we hit that situation, just remove the excess character.  I was
hoping to refactor it into something more elegant, but it worked at the time and
I wanted to get on to the handling of Ordered List Item tokens.</p>
<h2 id="second-verse">Second Verse…<a class="headerlink" href="#second-verse" title="Permanent link">¶</a></h2>
<p>I fondly remember being a kid at a summer camp and hearing the words “Second verse, same
the first, a little bit louder, and a little bit worse!”.  Working on the ordered list
tokens made me think of that saying almost immediately.  Except for the fact that it
was not a little bit worse, it was a lot easier.</p>
<p>There were two main reasons for that.  The first reason is that looking at the samples as
a group, there are objectively fewer examples with ordered lists than unordered lists.
In the
<a href="https://spec.commonmark.org/0.29/#list-items">list items section</a>
of the GFM specification, there are 20 of each, but in the
<a href="https://spec.commonmark.org/0.29/#lists">lists section</a>
of the specification, there are 20 examples of unordered lists and 7 examples of ordered
lists.  The second reason was that most of the work was either completed when working on
the unordered list token transformations, or it was used in a copy-and-paste manner.</p>
<p>However, knowing that lists are one of the two container elements in Markdown, I took
some extra time and reverified all the scenario tests, both ordered lists and unordered
lists.  I was able to find a couple of small things that were quickly fixed, but other
than that, everything looked fine!</p>
<h2 id="cleanup">Cleanup<a class="headerlink" href="#cleanup" title="Permanent link">¶</a></h2>
<p>As with a lot of my free project time recently, I used some extra time that I had to
focus on a few cleanup items for the project.  While none of them was important
on its own, I just felt that the project would be cleaner with them done.</p>
<p>The first one was an easy one, going through the HTML transformer and the Markdown
transformer, and ensuring that all the token handlers were private.  There really
was not any pressing need to do this, but it was just cleaner.  The only code that was
using those handlers was in the same class, so it was just tidier that way.</p>
<p>Next was the creation of the <code>__create_link_token</code> function to help tidy up the
<code>__handle_link_types</code> function.  The <code>__handle_link_types</code> function was already messy
enough handling the processing of the link information, the creating of the normal or
image link was just complicating things.  While I still want to go back and clean
functions like that up, for the time, moving the creation code to <code>__create_link_token</code>
was a good step.</p>
<p>Finally, there was the case of the justification function calls throughout the code.
Not to sound like a purist, but I felt that they were messy.  I often had to remind
myself of what the three operands were: string to perform on, the justification amount,
and the character to use for the justification.  The actual use of the function was
correct, it just felt like its usage was not clear.  So instead of having code
like this around the code base:</p>
<div class="highlight"><pre><span></span>        <span class="n">some_value</span> <span class="o">=</span> <span class="s2">""</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">repeat_count</span><span class="p">,</span> <span class="n">character_to_repeat</span><span class="p">)</span>
</pre></div>
<p>I replaced it with:</p>
<div class="highlight"><pre><span></span>        <span class="n">some_value</span> <span class="o">=</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">repeat_string</span><span class="p">(</span><span class="n">character_to_repeat</span><span class="p">,</span> <span class="n">repeat_count</span><span class="p">)</span>
</pre></div>
<p>While the code for this operation was a one-line function, now located in the
<code>ParserHelper</code> class, I felt it now made sense and was in an easy to find
place.</p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">repeat_string</span><span class="p">(</span><span class="n">string_to_repeat</span><span class="p">,</span> <span class="n">repeat_count</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Repeat the given character the specified number of times.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">repeat_count</span><span class="p">,</span> <span class="n">string_to_repeat</span><span class="p">)</span>
</pre></div>
<h1 id="fixing-example-528">“Fixing” Example 528<a class="headerlink" href="#fixing-example-528" title="Permanent link">¶</a></h1>
<p>I do not want to spoil the surprise too much, but the fact that I have a section called
<code>"Fixing" Example 528</code> probably gives it away.  I fixed it.  But the story is more
interesting than that.</p>
<p>In the last article, I talked about
<a href="https://github.github.com/gfm/#example-528">example 528</a>
and how I was having problems getting it to
<a href="https://jackdewinter.github.io/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/#example-528">parse properly</a>.
Even having done thorough research on the example and the algorithm, I came up with
nothing.  To me, it looked like the parsing was being performed according to the
<a href="(https://github.github.com/gfm/#phase-2-inline-structure)">GFM specification’s algorithm</a>,
but the parsing was just off.  After yet another attempt to figure this example out
and get it working, I posted my research and a request for help to the CommonMark
<a href="https://talk.commonmark.org/t/spec-algorithm-error-in-links-within-links-within-images/3571">discussion forums.</a>.</p>
<p>Keeping my head down and focused on writing that week’s article, I did not notice that I
had received a reply the very next day.  As a matter of fact, while I did notice that I
had a response to my post, it was not until Friday night that it clicked that it was a
response to “THAT” post.  After getting the cleanup documented in the previous section
taken care of, I reserved some dedicated time to walk through the reply.</p>
<h2 id="kudos">Kudos<a class="headerlink" href="#kudos" title="Permanent link">¶</a></h2>
<p>First off, I would like to extend kudos to the replier, John MacFarlane, one of the
maintainers of the Markdown GFM specification.  While he would have been within his
right to tell me to RTFM<sup id="fnref:RTFM"><a class="footnote-ref" href="#fn:RTFM">2</a></sup>, he took some time to walk me through the algorithm
as it applied to that example, even providing me with some debug output from his
program for that example.  His response was just a classy response with just the
right amount of information.</p>
<h2 id="side-by-side-comparisons">Side by Side Comparisons<a class="headerlink" href="#side-by-side-comparisons" title="Permanent link">¶</a></h2>
<p>Armed with that new information, I turned on the debug output and ran through the output
from my implementation of the algorithm again.  Slowly, with my own written notes as an
additional guide, I began to walk through the output.  <code>Found closer at 8</code>.  Check.
<code>Found matching opener at 4</code>. Check.  <code>Deactivating opener at 3</code>. Check.
<code>Found closer at 15</code>.  Check.  <code>Popping inactive opener at 3</code>.  Ch…er… what?
“Popping”?</p>
<p>Going back to the algorithm and the text that John provided, it hit me.  The popping that
he was referring to was this part of the algorithm:</p>
<blockquote>
<p>If we do find one, but it’s not active, we remove the inactive delimiter from the stack, and return a literal text node ].</p>
</blockquote>
<p>For some reason, when I read that before, I thought it was referring to removing the
token from consideration, not actually removing it from the stack.  It probably also
confused things in that I did not maintain a separate stack for the link resolution.
Instead, I added an instance of the <code>SpecialTextMarkdownToken</code> token to the inline block
list whenever I hit a link sequence.  In either case, I was not doing that.  To compound
the issue, I did not stop at that inactive token, I just kept on looking for the next
active <code>SpecialTextMarkdownToken</code> token, finding the image start token.  Ah… everything
was now falling into place in my mind.</p>
<h2 id="fixing-the-issue">Fixing the Issue<a class="headerlink" href="#fixing-the-issue" title="Permanent link">¶</a></h2>
<p>The fix was very anticlimactic.  I created the new
<code>__revert_token_to_normal_text_token</code> function, which removed the
<code>SpecialTextMarkdownToken</code> token and replaced it with a normal <code>TextMarkdownToken</code>
token.  In addition, I changed the algorithm to make sure that when this happened,
it stopped processing for that link end sequence, as per the algorithm.  With the start
character sequence now being effectively invisible to the algorithm, the rest of the
parsing went fine, with the correct results coming out.  Well, almost.  A small fix was
needed to the
<code>__consume_text_for_image_alt_text</code> function to make it properly emit the correct text
if an instance of a <code>SpecialTextMarkdownToken</code> token was encountered.</p>
<p>With the big fix and the little fix both completed, the scenario test for Example 528
was fully enabled and fully passing.  Finally!</p>
<h3 id="reminder-to-self-be-humble">Reminder to Self: Be Humble<a class="headerlink" href="#reminder-to-self-be-humble" title="Permanent link">¶</a></h3>
<p>Having taken a quite a few attempts at implementing the algorithm and making sure it
passed all test cases, I hit a wall. A seemingly rock-solid wall.  That was fine.
During any project, be it software or hardware, things happen.  When it got to
that point, I gave myself some time, I knuckled down<sup id="fnref:knuck"><a class="footnote-ref" href="#fn:knuck">3</a></sup>, and I did some solid
research on the problem.  Keeping good notes, I was then able to share those notes with
peers in the community, along with a sincere and humble request for help.</p>
<p>I do not always get a good response to requests for help.  However, I have noticed that
doing good research and presenting that research with humility increases the chance of
getting a positive response.  At no point did I rant and say, “it’s broken” or
“my way works, what is wrong with yours”.  Instead I said, “Is there something wrong
with the algorithm?” and
“Based on my implementation of that algorithm”.  By acknowledging that it could be an
issue with my implementation, I feel that I opened the doors for someone to help, rather
than slamming them shut with negative talk.</p>
<p>And as I mentioned in the Kudos section above, mostly in what I believe was a humble
approach to asking for help, I got a real good response.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>Wow… that work was intense.  For one, I was right, it was a lot of addressing issues
with whitespace and running scenario tests repeatedly.  But it was more than
that for me.  I knew I had the leaf blocks taken care of, but I was really concerned
about how difficult the implementation of the container transformations would be. If
I did it right and kept to my design, I was confident that I could keep the complexity
down, but I still figured it would be complex.</p>
<p>I guess that led to me second guessing every line of code and getting in the way of
myself a bit.  I did prevail, but that concern or fear of damaging existing tests was
somewhat paralyzing at times.  And while the logical half of my brain was telling me
that I had plenty of tests to reinforce my completed work, the emotional half was
another story.  That is where that fear was coming from, my emotional side.  Only
when I took a moment to take another breath and focus on the tests was I able to banish
that concern for a while.</p>
<p>And it also helped me to do a bit of self-analysis on why I was concerned.  After a lot
of thinking, I came to a simple conclusion. The closer I get closer to getting a
complete project, the more I am concerned that I have not architected and designed it
properly.  If I have done that, small changes can be accomplished with few or no
unintended side effects.  If not, encountering side effects should be frequent.
Seeing as I know I have identified some areas of the code
base that I want to refactor, I questioned whether the current state was good enough.</p>
<p>Knowing that, it helped me figure it out for myself.  I do believe that I have
confidence with my
architecture and design, and at the same time, I believe that I can improve it.
It might seem like a dichotomy, but I am starting to think that both can be correct
at the same time.  But knowing that was the issue that was causing me concern helps
me combat it.  I am a lot less worried about it, but it is a work in progress,
much like the project.</p>
<p>With that information in hand, I felt better.  Cautious about the next steps in getting
the checks closer to the finish line, but better! And let’s not forget about finally
closing the issue with Example 528.  That was good!</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>With the Markdown transformer almost completed, the only tokens left that need a
transformation are the Block Quote tokens.  In addition, as the line/column number
consistency checks do not currently deal with Block Quote tokens either, I will need
to add both checks in the next block of work.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:lazyList">
<p>The only example 249, but ordered list. <a class="footnote-backref" href="#fnref:lazyList" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:RTFM">
<p>Read The F&amp;$#ing Manual… or I guess RTFS in this case. <a class="footnote-backref" href="#fnref:RTFM" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:knuck">
<p>According to <a href="https://www.merriam-webster.com/thesaurus/knuckle%20down">Webster’s</a>: “pitch in, dig in”. <a class="footnote-backref" href="#fnref:knuck" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Adding%20Lists%20to%20the%20Markdown%20Transformer&url=https%3A//jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Adding%20Lists%20to%20the%20Markdown%20Transformer&amp;body=https%3A//jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-adding-lists-to-the-markdown-transformer"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/08/14/python-projects-using-pipenv/" title="Previous: Python Projects - Using PipEnv">Python Projects - Using PipEnv</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/08/25/markdown-linter-adding-consistency-to-block-quotes/" title="Next: Markdown Linter - Adding Consistency to Block Quotes">Markdown Linter - Adding Consistency to Block Quotes</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~19 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-08-17T00:00:00-07:00">Aug 17, 2020</time>
        <h4>Markdown Linter Core</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" title="Markdown Linter - Core - Pre-Rule Improvements">Part 1: Markdown Linter - Core - Pre-Rule Improvements</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Markdown Linter - Taking Time To Evaluate">Part 2: Markdown Linter - Taking Time To Evaluate</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Markdown Linter - Adding Line and Column Support">Part 3: Markdown Linter - Adding Line and Column Support</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" title="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks">Part 4: Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Markdown Linter - Rabbit Hole 2 - Losing My Way">Part 5: Markdown Linter - Rabbit Hole 2 - Losing My Way</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Markdown Linter - Weeding the Project's Issue List">Part 6: Markdown Linter - Weeding the Project's Issue List</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" title="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out">Part 7: Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" title="Markdown Linter - Improving Consistency">Part 8: Markdown Linter - Improving Consistency</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Markdown Linter - Transforming Back to Markdown">Part 9: Markdown Linter - Transforming Back to Markdown</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/27/markdown-linter-addressing-the-initial-markdown-transformer-issues/" title="Markdown Linter - Addressing the Initial Markdown Transformer Issues">Part 10: Markdown Linter - Addressing the Initial Markdown Transformer Issues</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/03/markdown-linter-improving-the-markdown-transformer/" title="Markdown Linter - Improving the Markdown Transformer">Part 11: Markdown Linter - Improving the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/" title="Markdown Linter - Adding Links to the Markdown Transformer">Part 12: Markdown Linter - Adding Links to the Markdown Transformer</a>
            </li>
            <li  class="active-part">
            Part 13: Markdown Linter - Adding Lists to the Markdown Transformer
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/25/markdown-linter-adding-consistency-to-block-quotes/" title="Markdown Linter - Adding Consistency to Block Quotes">Part 14: Markdown Linter - Adding Consistency to Block Quotes</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/31/markdown-linter-adding-consistency-to-token-heights/" title="Markdown Linter - Adding Consistency to Token Heights">Part 15: Markdown Linter - Adding Consistency to Token Heights</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/" title="Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens">Part 16: Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/14/markdown-linter-adding-consistency-checks-for-emphasis-and-text-tokens/" title="Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens">Part 17: Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/21/markdown-linter-adding-remaining-inline-tokens/" title="Markdown Linter - Adding Remaining Inline Tokens">Part 18: Markdown Linter - Adding Remaining Inline Tokens</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>22</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>40</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>