<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ At the end of my last article, I talked about how I felt a lack of confidence in the work that I had just completed, primarily due to the large number of scenario tokens that I added line/column numbers to. This article documents the work to increase my …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" />
<meta property="og:description" content="Summary¶ At the end of my last article, I talked about how I felt a lack of confidence in the work that I had just completed, primarily due to the large number of scenario tokens that I added line/column numbers to. This article documents the work to increase my …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-06-15T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks ">
<meta name="twitter:description" content="Summary¶ At the end of my last article, I talked about how I felt a lack of confidence in the work that I had just completed, primarily due to the large number of scenario tokens that I added line/column numbers to. This article documents the work to increase my …">

        <title>Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/">
                Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#a-quick-aside">A Quick Aside</a></li>
<li><a href="#starting-with-some-refactoring">Starting with Some Refactoring</a><ul>
<li><a href="#why-not-static-variables">Why not static variables?</a></li>
</ul>
</li>
<li><a href="#starting-with-the-plumbing">Starting with the Plumbing</a></li>
<li><a href="#verifying-the-line-numbers-start-at-1">Verifying the Line Numbers Start At 1</a><ul>
<li><a href="#classifying-the-tokens">Classifying the Tokens</a></li>
<li><a href="#adding-the-first-verification">Adding the First Verification</a></li>
<li><a href="#looking-for-issues-link-reference-definitions">Looking for Issues - Link Reference Definitions</a></li>
<li><a href="#looking-for-issues-setext-headings">Looking For Issues - SetExt Headings</a></li>
<li><a href="#adapting-the-token-to-properly-represent-its-data">Adapting the Token to Properly Represent Its Data</a></li>
<li><a href="#changing-the-scenario-tests">Changing the Scenario Tests</a></li>
<li><a href="#before-going-on">Before Going On</a></li>
</ul>
</li>
<li><a href="#adding-more-consistency-checks">Adding More Consistency Checks</a><ul>
<li><a href="#duplicated-tokens">Duplicated Tokens</a></li>
</ul>
</li>
<li><a href="#adding-in-more-line-number-checks">Adding in More Line Number Checks?</a></li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>At the end of my
<a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/">last article</a>,
I talked about how I felt a lack of confidence in the work that I had just completed,
primarily due to the large number of scenario tokens that I added line/column numbers
to. This article documents the work to increase my confidence in those line/column
numbers
by starting to add consistency checks to all the scenario tests.  Additionally, I talk
about the bad line/column numbers that were found by the new consistency checks and how
I addressed those issues.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>Why am I referring to this work as a
<a href="https://www.merriam-webster.com/dictionary/rabbit%20hole">rabbit hole</a>?
It is because this kind of verification can be easy, but if things are not done right,
the verification itself can be very messy and seemingly endless.  As with many things
in this project, whether or not to do this is a balancing act between the risk of doing
(or not doing) it, the
cost of doing it, and the impact if the risk comes to pass. The risk of not doing this
type of verification is that I may have miscalculated one of the line number/column
number pairs for one of the tokens in the 700+ examples that make up the scenario
tests. The cost of doing this is a small amount of code for the verification part of
the code, but it could also add tons of code to the actual parser to track additional
elements.  The impact is even more difficult to pin down.</p>
<p>While part of the impact is measurable, namely the number of line number and column
number errors found, the other part of the impact is not measurable: confidence.
There is my confidence that I have those numbers right and there is the confidence of
any users that I have those numbers right.  And if I do not reach the minimum confidence
level for any users of the project, I am certain that I will lose those users.  It will
be a balancing act that I will need to be aware of, and to monitor going forward, even
after this work is finished.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits after
<a href="https://github.com/jackdewinter/pymarkdown/commit/9a2196b4dfd9948ef188e40c2619346bc4e673be">30 May 2020</a> up to
<a href="https://github.com/jackdewinter/pymarkdown/commit/4bb4034ec69bc0aa67552f08c986ff94632e1e82">14 Jun 2020</a>.</p>
<h2 id="a-quick-aside">A Quick Aside<a class="headerlink" href="#a-quick-aside" title="Permanent link">¶</a></h2>
<p>Yes, one of these again!  I have been trying to figure out a good way to talk about
the line number and column numbers as a pair, trying out various combinations over
the last article and during the writing of this article.  The most descriptive and most
compact wording that I believe captures the information is: line/column number.  It
both indicates that they are a pair and that the pair has two distinct parts.  From
this point forward, I am going to strive to consistently use this format.</p>
<h2 id="starting-with-some-refactoring">Starting with Some Refactoring<a class="headerlink" href="#starting-with-some-refactoring" title="Permanent link">¶</a></h2>
<p>I am always looking for ways to make the project better, and this was no exception.
During the addition of the <code>position_marker</code> variables throughout the parsing code,
I noticed there were four variables that were usually getting passed around together:
<code>token_stack</code>, <code>token_document</code>, <code>close_open_blocks_fn</code> and <code>handle_blank_line_fn</code>.
While these variables might have slightly different names in the functions that used
them, their usage pattern was very consistent.  In each case, they were defined once in
the <code>TokenizedMarkdown</code> class, and passed without change down throughout the rest of the
parser.  If Python had a good concept of a read-only variable, I would have used that
concept to decorate these variables.  Another alternative was to make these variables
static variables, but it did not feel right to me to make them into 4 different
static variables.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ParserState</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Class to provide for an encapsulation of the high level state of the parser.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">token_stack</span><span class="p">,</span> <span class="n">token_document</span><span class="p">,</span> <span class="n">close_open_blocks_fn</span><span class="p">,</span> <span class="n">handle_blank_line_fn</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_stack</span> <span class="o">=</span> <span class="n">token_stack</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_document</span> <span class="o">=</span> <span class="n">token_document</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_open_blocks_fn</span> <span class="o">=</span> <span class="n">close_open_blocks_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_blank_line_fn</span> <span class="o">=</span> <span class="n">handle_blank_line_fn</span>
</pre></div>
<p>As I did want to reduce the overhead of passing these around, I created a new class
<code>ParserState</code>, initialized an instance of it in the <code>__parse_blocks_pass</code> function of
the <code>TokenizedMarkdown</code> class, and added those four variables to that class as member
variables.  Then I worked my way through the parser, passing that object down further
and further into the parser.  Along the way, where possible, I removed PyLint
<code>too-many-arguments</code> warnings and a couple of <code>too-many-locals</code> warnings as well.  To
me, it just left things a bit cleaner, and ready for the next
step: starting to add the consistency checks.</p>
<h3 id="why-not-static-variables">Why not static variables?<a class="headerlink" href="#why-not-static-variables" title="Permanent link">¶</a></h3>
<p>Perhaps it is my object-oriented background or perhaps it is
my test automation background, but both of those backgrounds note that static variables
are bad.  From the object-oriented point of view, static variables cause issues because
you must be very aware of what is changing and observing those variables at every
moment.  From the test automation point of view, static variables are just hard to
test.  Because
everything in the project that uses that static variable has access to it, it can be
the result of a direct or indirect change from almost anywhere in that project.  If it
is only accessible from a static method, then there are problems with clearing out the
value of that variable so it can be properly tested under all circumstances.  Basically,
most of my experience tells me to stay away from static variables if possible.</p>
<h2 id="starting-with-the-plumbing">Starting with the Plumbing<a class="headerlink" href="#starting-with-the-plumbing" title="Permanent link">¶</a></h2>
<p>With any sort of verification code, it is always a good idea to start with something
simple, slowly building on top of that work.  As this was just normal verification code,
the first thing I did was to add this function to the <code>utils.py</code> module:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assert_token_consistency</span><span class="p">(</span><span class="n">source_markdown</span><span class="p">,</span> <span class="n">expected_tokens</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Just a simple function that could be called from each of the scenario tests, starting
out with a skeleton function that does nothing.  With that in place, I started the
laborious task of going to each of the <code>test_markdown_*.py</code> files and changing the
tests at the end of each scenario test from:</p>
<div class="highlight"><pre><span></span>    <span class="c1"># Assert</span>
    <span class="n">assert_if_lists_different</span><span class="p">(</span><span class="n">expected_tokens</span><span class="p">,</span> <span class="n">actual_tokens</span><span class="p">)</span>
    <span class="n">assert_if_strings_different</span><span class="p">(</span><span class="n">expected_gfm</span><span class="p">,</span> <span class="n">actual_gfm</span><span class="p">)</span>
</pre></div>
<p>to:</p>
<div class="highlight"><pre><span></span>    <span class="c1"># Assert</span>
    <span class="n">assert_if_lists_different</span><span class="p">(</span><span class="n">expected_tokens</span><span class="p">,</span> <span class="n">actual_tokens</span><span class="p">)</span>
    <span class="n">assert_if_strings_different</span><span class="p">(</span><span class="n">expected_gfm</span><span class="p">,</span> <span class="n">actual_gfm</span><span class="p">)</span>
    <span class="n">assert_token_consistency</span><span class="p">(</span><span class="n">source_markdown</span><span class="p">,</span> <span class="n">actual_tokens</span><span class="p">)</span>
</pre></div>
<p>This was a simple task, but by making sure it was completed, I was able to go ahead
and add in any consistency checks between the Markdown and the tokens without wondering
if I had missed any of the tests.  And yes, I was paranoid and double checked all
the scenario tests at least one more time to make sure I did not miss any of the tests.</p>
<p>Why did I take such a small step?  While other people’s mileage may vary, I find that
adding multiple consistency checks in a single step compounds the errors that
can occur if you get that check wrong.  Unless I can avoid it, I choose small changes
to the verification that I can easily validate manually, getting those changes addressed
solidly before moving on.  The base calculus that I am betting on is that the time
taken to complete multiple steps independently is less than the time taken to combine
them together.  Based on my experience, including implementing, testing, debugging, and
maintenance as factors into that equation usually favors the independent steps.</p>
<h2 id="verifying-the-line-numbers-start-at-1">Verifying the Line Numbers Start At 1<a class="headerlink" href="#verifying-the-line-numbers-start-at-1" title="Permanent link">¶</a></h2>
<p>I was sure that verifying column numbers was going to be messy, but I was confident
that verifying line numbers would be more simplistic.  When it comes down to it, the
base part of verifying line numbers is making sure that each block token starts on
its own new line, except for a block that is within a container block.  In those cases,
and only those cases, can the line number be the same.</p>
<p>But even before I started down that path, the first verification that I wanted to do
was to make sure that each array of tokens started with a block token on line 1.  It
was the simplest verification that I could think of, and from previously discovered
issues, I knew there were at least a couple of reported issues in this area.  If I
coded it properly, not only would I validate that the verification was working, but
I could also detect and fix an issue or two at the same time.</p>
<h3 id="classifying-the-tokens">Classifying the Tokens<a class="headerlink" href="#classifying-the-tokens" title="Permanent link">¶</a></h3>
<p>Up to this point in the project, I had little need to classify any of the Markdown
tokens as anything other than Markdown tokens.  When I addressed a block of tokens,
those tokens were always as a single token or as a small group of 2-3 tokens.  But,
to verify the line numbers properly, I was going to need to group the tokens on a
larger scale.  To accomplish that, I was going to have to add classification to the
tokens.</p>
<p>In re-reading the verification steps outlined at the start of the previous section, I
realized at the minimum I was going to need to add the concept of each token belonging
to a specific class of token.
In this context, I was defining the class of the token as the grouping assigned to the
Markdown element in the GFM specification.  Using that as a template, along with some
previous work with Python enumerations, I was able to quickly set up this enumeration:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkdownTokenClass</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Enumeration to provide guidance on what class of token the token is.</span>
<span class="sd">    """</span>

    <span class="n">CONTAINER_BLOCK</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LEAF_BLOCK</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">INLINE_BLOCK</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
<p>While Python supports four types of enumerations, I was confident that the simple
type of enumeration was the right fit to solve this issue.  I did not need the
enumeration to do anything fancy, just provide a simple property value for each token
that specifies what the class of that token is: container block, leaf block, or inline.
With the enumeration in place, it was a simple task to go through all the tokens in the
<code>markdown_token.py</code> module and associate each token with its respective class. Using
the GFM specification as a guide, each token was matched up to its owning element and
assigned the proper class instance for that element.</p>
<h3 id="adding-the-first-verification">Adding the First Verification<a class="headerlink" href="#adding-the-first-verification" title="Permanent link">¶</a></h3>
<p>With each token classified, the first part of the token verification was to only focus
on the blocks, as inline line/column numbers were not yet implemented.  Using the new
classification variable <code>token_class</code> this was easily accomplished by adding a simple
loop over all the non-inline tokens:</p>
<div class="highlight"><pre><span></span>    <span class="k">for</span> <span class="n">current_token</span> <span class="ow">in</span> <span class="n">expected_tokens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">INLINE_BLOCK</span><span class="p">:</span>
            <span class="k">continue</span>
</pre></div>
<p>Next, this was expanded to remember the last token, as such:</p>
<div class="highlight"><pre><span></span>    <span class="n">last_token</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">current_token</span> <span class="ow">in</span> <span class="n">expected_tokens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">INLINE_BLOCK</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">last_token</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">current_token</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="n">last_token</span> <span class="o">=</span> <span class="n">current_token</span>
</pre></div>
<p>While these were not big changes, it was a good start.  It made sure that the first
token in the document was always positioned on line number 1, which it should always
be.  If not,
the verification code asserts on the failure.  Simple.  And while I could have added
more
checks, I decided that was complex enough for now, and stopped there.  As I mentioned
above, taking small steps with the verification is a far safer bet.  And as I would
soon discover, it was already bearing fruit!</p>
<h3 id="looking-for-issues-link-reference-definitions">Looking for Issues - Link Reference Definitions<a class="headerlink" href="#looking-for-issues-link-reference-definitions" title="Permanent link">¶</a></h3>
<p>When implementing the line/column numbers for each block tokens, as documented in the
<a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/#lather-rinse-repeat">last article</a>,
I noted down scenario
tests that looked dodgy for later examination.  At that time, I tagged the scenario
tests for examples 166 and 168 as being incorrect as they started off with an
extra blank line that started on line 2.  With this new verification code in place, when
those scenario tests were executed again, those new verification tests failed right
away.</p>
<p>The output of the test was not an issue, as the HTML output for a blank line token in
the current output formatter is to output nothing.  However, when I added in the
line/column number check, it failed as it was the first block token in the output, and
it reported that it started on line 2.  The blank line was indeed on line 2, but the
token was being output at the start of the token array, and then again in the middle of
the <code>actual_tokens</code> array.</p>
<p>After some digging, I was able to find the error. During the processing of the blank
line, the parser checks to see whether there is an active link reference definition,
and if so, stops the definition.  However, regardless of whether a definition
was found, that blank line token is appended to the <code>token_document</code> array.  With any
other token, this would be the correct thing to do.  However, as the processing of
the link reference definition
<a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/#hitting-implementation-issues">requires rewinding on failures</a>,
the blank line was output, the parsing was rewound for the failed link reference
definition, and then the blank line was output again.  Once I figured out what the
problem was, it was easily remedied by seeing if a rewind was in progress by checking
the <code>force_ignore_first_as_lrd</code> variable, and only emitting the token if it was not set.</p>
<p>After some double checking, the scenario tests for example 166 and 168 were executed
again, verifying that they were indeed fixed.  I then ran the tests again to see what
other tests were failing, and it was a mass of SetExt heading failures that caught
my eye right away.</p>
<h3 id="looking-for-issues-setext-headings">Looking For Issues - SetExt Headings<a class="headerlink" href="#looking-for-issues-setext-headings" title="Permanent link">¶</a></h3>
<p>It was very evident that more than half of the SetExt heading tests were failing
from the scenario test summary line.  Performing a quick count of the failing tests,
there were 13 SetExt heading tests failures out of a total 25 scenario tests.  As I
have put significant time into making sure that both the SetExt and Atx headings are
working properly, I was surprised to see that there were any verification failures, let
alone 13 of them.</p>
<p>Within seconds of looking at the first of those tests, it was easy to see why the
verification was failing.  In the scenario test for example 50, the first part of
the Markdown text is:</p>
<div class="highlight"><pre><span></span><span class="n">Foo</span> <span class="o">*</span><span class="n">bar</span><span class="o">*</span>
<span class="o">=========</span>
</pre></div>
<p>but the tokens being output by that block of Markdown text was:</p>
<div class="highlight"><pre><span></span>        "[setext(2,1):=:]",
        "[text:Foo :]",
        "[emphasis:1]",
        "[text:bar:]",
        "[end-emphasis::1]",
        "[end-setext::]",
</pre></div>
<p>From an HTML point of view, the tokens were correct, as the HTML output for that text:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Foo <span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>bar<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</pre></div>
<p>was correct.  But it was also obvious that the line/column number for the first token
was wrong.  As the first token, it should start on line 1, not line 2.  Even more
interesting is that if you visually look at the Markdown, it is obvious that it indeed
is the first Markdown element in the document.</p>
<p>Starting to debug this scenario test, the answer was quick to come.  In the processing
of a SetExt heading, as
<a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/#adjusting-the-parsing-of-whitespace-in-setext-tokens">talked about previously</a>,
the Markdown for a SetExt heading occurs after a paragraph has completed, transforming
that paragraph into a SetExt heading.  At the time that the SetExt heading token is
added to the markdown token array, the position that is associated with the token is
the start of the SetExt Markdown indicator.  As such, that is the position that is used
for the token.  And it does make sense that for every token, the position should
indicate where that token occurs.</p>
<h3 id="adapting-the-token-to-properly-represent-its-data">Adapting the Token to Properly Represent Its Data<a class="headerlink" href="#adapting-the-token-to-properly-represent-its-data" title="Permanent link">¶</a></h3>
<p>Despite the token position being technically correct, from a line/column number
verification point of view it did not make sense, and line/column numbers were what
was being verified.  As I thought about this, I vacillated between
representing the token with the position of the SetExt Markdown element and
the position of the block of text contained within the SetExt heading.  To me, there
just was not a good answer.  They both had a valid use and a valid reason to be the
one position that represented the token.</p>
<p>Battling back and forth, I finally came to the realization that I needed to break out
of my current thinking that a token must have only one position.  While it is
not a feature I want to use frequently, this was an honest case where the token
should contain two positions: the primary position to contain the location of the
SetExt element itself and the secondary position to contain the location of the block
of text contained within the SetExt heading.</p>
<p>To accomplish this, I added two new variables to the <code>SetExtHeadingMarkdownToken</code> class:
<code>original_line_number</code> and <code>original_column_number</code>.  These two variables would be used
independently of the <code>line_number</code> and <code>column_number</code> variables to track the position
of the block of text contained within the SetExt heading.  I wired up the necessary
code to pass in the correct values for the two new variables, included adjusting the
<code>__str__</code> function to present them as part of the token.</p>
<p>When I reran the scenario test for example 50, I was pleasantly greeted with the
following new set of tokens:</p>
<div class="highlight"><pre><span></span>        "[setext(2,1):=::(1,1)]",
        "[text:Foo :]",
        "[emphasis:1]",
        "[text:bar:]",
        "[end-emphasis::1]",
        "[end-setext::]",
</pre></div>
<h3 id="changing-the-scenario-tests">Changing the Scenario Tests<a class="headerlink" href="#changing-the-scenario-tests" title="Permanent link">¶</a></h3>
<p>Now that the SetExt heading token contained a good set of information, I needed to
change the scenario tests to understand the new information.  Without any change, those
tests would still only know about the primary position.  To address this issue, I added
the following code:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__calc_adjusted_position</span><span class="p">(</span><span class="n">markdown_token</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">markdown_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_setext_heading</span><span class="p">:</span>
        <span class="n">line_number</span> <span class="o">=</span> <span class="n">markdown_token</span><span class="o">.</span><span class="n">original_line_number</span>
        <span class="n">index_number</span> <span class="o">=</span> <span class="n">markdown_token</span><span class="o">.</span><span class="n">original_column_number</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_number</span> <span class="o">=</span> <span class="n">markdown_token</span><span class="o">.</span><span class="n">line_number</span>
        <span class="n">index_number</span> <span class="o">=</span> <span class="n">markdown_token</span><span class="o">.</span><span class="n">column_number</span>
    <span class="k">return</span> <span class="n">PositionMarker</span><span class="p">(</span><span class="n">line_number</span><span class="p">,</span> <span class="n">index_number</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
</pre></div>
<p>While it may seem like overkill to some people, the purpose of this function is to
keep the addition of this new logic contained within a single function.  This
encapsulation came in useful when I added it in to the consistency function:</p>
<div class="highlight"><pre><span></span>    <span class="n">last_token</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">current_token</span> <span class="ow">in</span> <span class="n">expected_tokens</span><span class="p">:</span>
        <span class="n">current_position</span> <span class="o">=</span> <span class="n">__calc_adjusted_position</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">INLINE_BLOCK</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">last_token</span><span class="p">:</span>
            <span class="n">last_position</span> <span class="o">=</span> <span class="n">__calc_adjusted_position</span><span class="p">(</span><span class="n">last_token</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="n">last_token</span> <span class="o">=</span> <span class="n">current_token</span>
</pre></div>
<p>Used for both the <code>current_token</code> and the <code>last_token</code>, the new function easily provides
the right position for both tokens, with only a small change to the target function. In
addition, the adding of the <code>last_position</code> variable gave me a bit of a reminder of the
direction that I needed to go in with the consistency checks.  More on that in a minute.</p>
<p>Refocusing myself on the work directly ahead of me, running all the scenario tests
yielded 20 test failures, the original 13 tests plus another 7 tests that contained
SetExt heading tokens, just not at the start of the array.  For each of those 20 tests,
I manually checked the new tokens against the Markdown sample, and once I was satisfied
that they were accurate, I adjusted the expected tokens for that test to match the new
tokens.</p>
<p>And this time, when I ran all the scenario tests, I was greeted with a clean slate
of no test failures.</p>
<h3 id="before-going-on">Before Going On<a class="headerlink" href="#before-going-on" title="Permanent link">¶</a></h3>
<p>Up to this point, when adding the consistency checks, I was mostly invoking the
tests with the following line:</p>
<div class="highlight"><pre><span></span>pipenv run pytest -m gfm
</pre></div>
<p>As the new consistency checks were only concerned with the scenario tests, this was
the fastest method to run all those tests.  However, before continuing, I wanted
to make sure those changes did not have any adverse side effects, so I ran the all
the tests in the project using:</p>
<div class="highlight"><pre><span></span>pipenv run pytest
</pre></div>
<p>While running all the tests may not have been necessary, I wanted to run them to
be confident that I did not introduce any bad side effects.  As the complete group of
tests can be executed in less than half a minute, the cost of the little bit of extra
confidence was easy for me to justify.</p>
<h2 id="adding-more-consistency-checks">Adding More Consistency Checks<a class="headerlink" href="#adding-more-consistency-checks" title="Permanent link">¶</a></h2>
<p>With the SetExt heading tokens addressed and all the scenario tests passing again,
it was time to add more consistency checking.  As alluded to in the last section,
now that the line numbers are being verified for the first token, it was time to
add verification of container blocks and leaf blocks on the same line.</p>
<p>In this case, the smallest step I could take was to check for two blocks that had the
same line number.  When this condition is true, the previous block must be a container
block, otherwise some error has just occurred.  In addition, without worrying about
column number accuracy yet, I can also state that that the current position must be to
the right of the enclosing block.  Adding those changes into the consistency checking
was therefore just as easy as its description:</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="n">last_token</span><span class="p">:</span>
            <span class="n">last_position</span> <span class="o">=</span> <span class="n">__calc_adjusted_position</span><span class="p">(</span><span class="n">last_token</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">last_position</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="n">current_position</span><span class="o">.</span><span class="n">line_number</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">last_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">CONTAINER_BLOCK</span>
                <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">&gt;</span> <span class="n">last_position</span><span class="o">.</span><span class="n">index_number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
<p>While this was not checking everything yet, it was a good step forward.  While I was
certain that I did not mess anything up with the container tokens, it was
good to have the validation that I did not miss anything.  It was to my surprise
that when ran the scenario tests again, two failures were reported.</p>
<h3 id="duplicated-tokens">Duplicated Tokens<a class="headerlink" href="#duplicated-tokens" title="Permanent link">¶</a></h3>
<p>After I got over my surprise at there being two possible container block failures, I
started to investigate those two tests.  It was with relief that I noticed that both
tests, 218 and 219, were noted as being suspicious during the work from my last
article. From a quick glance at the test output, it was easy to spot that the check
was not failing due to container block issues, but due to almost duplicate blank line
tokens present in the
<code>actual_tokens</code> array.  Because the line number was the same in both tokens,
it looked like a case of a leaf block within a leaf block instead of a duplicated
token.</p>
<p>Debugging through this, it took me a while to figure this issue out.  After a lot
of head scratching, I finally had added enough debug information that I noticed that
in the code for the <code>parse_line_for_container_blocks</code> function, once the calling of the
<code>handle_block_quote_block</code> function was completed, the blank line had already been
handled, but the processing continued.  After verifying this a couple of times, I tried
removing the first call to process the blank line, but some of the other cases where
I handled blank lines stopped working.  While it did seem a bit of a kludge<sup id="fnref:kludge"><a class="footnote-ref" href="#fn:kludge">1</a></sup>,
on the return from the <code>handle_block_quote_block</code> function, I simply verified that the
blank line process was handled already.  If that, then the tokens were added to the
markdown token array, and the function was returned from.</p>
<p>As the scenario test for example 261 was also flagged in the same line as 218 and 219,
I took a similar look at the output, of that, but did not notice any issues.  I even
tried some variations on the data to see if there was an error that was previously
exposed, and now fixed, and I was not able to reproduce it.  Confident that 218 and 219
were fixed and that I could not reproduce 261, I removed those issues from my
issues list.</p>
<p>Once again, I re-ran the scenario tests, and all the test passed.  Executing the
entire batch of tests for the project, I was also greeted with a clean set of tests,
each one of them passing.  Now to figure out what to do next.</p>
<h2 id="adding-in-more-line-number-checks">Adding in More Line Number Checks?<a class="headerlink" href="#adding-in-more-line-number-checks" title="Permanent link">¶</a></h2>
<p>Taking a good look at adding more line number verification, I had a hard choice to
make.  Either I could try and add more line number verification, or I could start
working on column number verification.  There were good reasons for both paths, but
I had to make a choice.</p>
<p>I went back and forth on this decision before taking another look at the existing
scenario tests, trying to figure out what I was most concerned about.  I decided that
while
it would be nice to get the line numbers completed, I was more concerned about the
column numbers.  In the token array for each scenario tests, I was able to track
the lines and line numbers more easily that I was able to track the column numbers.
In the end, that one observation is what affected my decision: I needed to start
verifying the column numbers next.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>For any consistency checking being implemented, it is often useful to have a handful
of issues that you know should fail, and then see the new consistency logic
failing.  The new checks passed that part of the test.  In addition, the
consistency checks add so far pointed out an issue with how I assigned line/column
numbers to the SetExt heading token.  Having caught and
reported failures on those issues, I was confident that adding consistency checking
for the line/column numbers was a good thing to do.  Seeing as the cost was still
very low, it seemed that the cost:benefit ratio was still heavily in favor of
continuing, so that is what I decided to do.</p>
<p>Going back to my main issue regarding my confidence with line/column numbers and
their accuracy, if anything, I think I believed that I had lost ground.  With each
check finding something, it was both an affirmation that I was right to question
my manual verification abilities and a challenge to find more issues with more
consistency checking.  Basically, it was both “good job” and “what else ya got?” in
the same sentence.</p>
<p>If I am honest, I felt it was a bit of a setback.  I had hoped it was going to lift
my confidence a bit, instead of a give-and-take that balanced each other out.  I
knew I needed to do something to boost my confidence, and I just hoped that adding
column number consistency checks would be the key to that.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Having reached a good point in my verification for line numbers, it was time to proceed
further down the
<a href="https://www.merriam-webster.com/dictionary/rabbit%20hole">rabbit hole</a>
that is consistency checking by starting to verify the column numbers.  And what a
rabbit hole it would end up being!</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:kludge">
<p>According to Merriam-Webster: “a haphazard or makeshift solution to a problem and especially to a computer or programming problem” <a class="footnote-backref" href="#fnref:kludge" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Rabbit%20Hole%201%20-%20Adding%20Consistency%20Checks&url=https%3A//jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Rabbit%20Hole%201%20-%20Adding%20Consistency%20Checks&amp;body=https%3A//jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-rabbit-hole-1-adding-consistency-checks"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Previous: Markdown Linter - Adding Line and Column Support">Markdown Linter - Adding Line and Column Support</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Next: Markdown Linter - Rabbit Hole 2 - Losing My Way">Markdown Linter - Rabbit Hole 2 - Losing My Way</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~18 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-06-15T00:00:00-07:00">Jun 15, 2020</time>
        <h4>Markdown Linter Core</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" title="Markdown Linter - Core - Pre-Rule Improvements">Part 1: Markdown Linter - Core - Pre-Rule Improvements</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Markdown Linter - Taking Time To Evaluate">Part 2: Markdown Linter - Taking Time To Evaluate</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Markdown Linter - Adding Line and Column Support">Part 3: Markdown Linter - Adding Line and Column Support</a>
            </li>
            <li  class="active-part">
            Part 4: Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Markdown Linter - Rabbit Hole 2 - Losing My Way">Part 5: Markdown Linter - Rabbit Hole 2 - Losing My Way</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Markdown Linter - Weeding the Project's Issue List">Part 6: Markdown Linter - Weeding the Project's Issue List</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" title="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out">Part 7: Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" title="Markdown Linter - Improving Consistency">Part 8: Markdown Linter - Improving Consistency</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Markdown Linter - Transforming Back to Markdown">Part 9: Markdown Linter - Transforming Back to Markdown</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/27/markdown-linter-addressing-the-initial-markdown-transformer-issues/" title="Markdown Linter - Addressing the Initial Markdown Transformer Issues">Part 10: Markdown Linter - Addressing the Initial Markdown Transformer Issues</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/03/markdown-linter-improving-the-markdown-transformer/" title="Markdown Linter - Improving the Markdown Transformer">Part 11: Markdown Linter - Improving the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/" title="Markdown Linter - Adding Links to the Markdown Transformer">Part 12: Markdown Linter - Adding Links to the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" title="Markdown Linter - Adding Lists to the Markdown Transformer">Part 13: Markdown Linter - Adding Lists to the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/25/markdown-linter-adding-consistency-to-block-quotes/" title="Markdown Linter - Adding Consistency to Block Quotes">Part 14: Markdown Linter - Adding Consistency to Block Quotes</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/31/markdown-linter-adding-consistency-to-token-heights/" title="Markdown Linter - Adding Consistency to Token Heights">Part 15: Markdown Linter - Adding Consistency to Token Heights</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/" title="Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens">Part 16: Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/14/markdown-linter-adding-consistency-checks-for-emphasis-and-text-tokens/" title="Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens">Part 17: Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/21/markdown-linter-adding-remaining-inline-tokens/" title="Markdown Linter - Adding Remaining Inline Tokens">Part 18: Markdown Linter - Adding Remaining Inline Tokens</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>26</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>44</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>