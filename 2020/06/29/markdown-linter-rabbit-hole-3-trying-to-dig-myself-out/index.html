<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I talked about how I quickly found myself descending into a rabbit hole while addressing an issue with my PyMarkdown project. From experience, that behavior is a pattern that I personally must work hard at to avoid. In this article I talk about mentally digging …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" />
<meta property="og:description" content="Summary¶ In my last article, I talked about how I quickly found myself descending into a rabbit hole while addressing an issue with my PyMarkdown project. From experience, that behavior is a pattern that I personally must work hard at to avoid. In this article I talk about mentally digging …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-06-29T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out ">
<meta name="twitter:description" content="Summary¶ In my last article, I talked about how I quickly found myself descending into a rabbit hole while addressing an issue with my PyMarkdown project. From experience, that behavior is a pattern that I personally must work hard at to avoid. In this article I talk about mentally digging …">

        <title>Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/">
                Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#mental-and-emotional-stuff-is-important-too">Mental and Emotional Stuff Is Important Too</a></li>
<li><a href="#how-does-this-relate-to-my-current-situation">How Does This Relate to My Current Situation?</a></li>
<li><a href="#where-to-start">Where to Start?</a><ul>
<li><a href="#keeping-the-scope-small">Keeping the Scope Small</a></li>
<li><a href="#adding-the-consistency-token-stack">Adding the Consistency Token Stack</a></li>
<li><a href="#getting-the-stack-code-working">Getting the Stack Code Working</a></li>
<li><a href="#removing-block-quotes">Removing Block Quotes</a></li>
<li><a href="#ignoring-tabs-for-now">Ignoring Tabs for Now</a></li>
</ul>
</li>
<li><a href="#adding-the-basic-enhancement">Adding the Basic Enhancement</a><ul>
<li><a href="#going-through-the-failures">Going Through the Failures</a></li>
<li><a href="#dealing-with-consistency-and-lists">Dealing with Consistency and Lists</a></li>
<li><a href="#almost-there">Almost There</a></li>
</ul>
</li>
<li><a href="#the-inevitable-bug-fixes">The Inevitable Bug Fixes</a></li>
<li><a href="#importance-of-starting-small">Importance of Starting Small</a></li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/">last article</a>,
I talked about how I quickly found myself descending into a rabbit hole while
addressing an issue with my PyMarkdown project.  From experience, that behavior is a
pattern that I personally must work hard at to avoid.  In this article I talk about
mentally digging myself out of that hole while extending the consistency checks for the
PyMarkdown linter to tokens beyond the initial token.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>At the
<a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/#what-was-my-experience-so-far">end of the last article</a>,
I talked about how I started chasing a feature down multiple rabbit holes, noticing that
behavior a good 4-5 days after I felt that I should have noticed it.  As part of who I
am, I find certain types of puzzles very hard to put down and almost addictive in
nature.  During the development of the PyMarkdown
project, I have had my share of these puzzles, so I have had to
be very vigilant that I take a measured approach when solving each issue in an
attempt to keep that behavior in check.</p>
<p>As this was the first time during this project that I have travelled down this route so
completely, I was slightly proud of myself.  Usually, for a project of this complexity
and duration, I would have expected to descend to those depths an extra 2-3 more times,
if not more. From experience, I find that it is during those times that I
lose my perspective on a project, and either go for perfection, give up the project
that I am working on, or both.  I am not sure, but my current belief is that by taking
a look at the bigger picture, and looking at it frequently, I have mostly mitigated my
desire for perfection by moderating it with other grounding concepts like feasibility.</p>
<p>Having noticed that I dug myself into that hole, it was now time to try and figure
out what to do.  Stay where I was? Go forward? Go backward?  It really was my choice
on how I handled that situation.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commit of
<a href="https://github.com/jackdewinter/pymarkdown/commit/4bb4034ec69bc0aa67552f08c986ff94632e1e82">14 Jun 2020</a>.</p>
<h2 id="mental-and-emotional-stuff-is-important-too">Mental and Emotional Stuff Is Important Too<a class="headerlink" href="#mental-and-emotional-stuff-is-important-too" title="Permanent link">¶</a></h2>
<p>I am not one for using excuses when something does not work out, but I am also not one
to keep on knocking someone down for failing.  Keep in mind the saying I
<a href="https://jackdewinter.github.io/2020/02/10/markdown-linter-adding-html-blocks/#changing-the-narrative">have adopted</a>:</p>
<blockquote>
<p>Stuff happens, pick yourself up, dust yourself off, and figure out what to do next.</p>
</blockquote>
<p>For me and my family, there are two parts of that statement are important to
realize: the trying part and the figure out/learning part.</p>
<p>In all honesty, I have every reason to not write this blog or work on this project.
I could spend more time interacting with my family,
fiddling around with home automation (how this blog started), watching movies (the more
b-movie or “hard” sci-fi the better), reading books (see movies), or any number of other
things.  At the time that I am writing this article, it is just shy of 4 months that I
have been working from home, due to
<a href="https://www.cdc.gov/coronavirus/2019-ncov/index.html">COVID-19</a>.  There is the
stress related to thinking about the 500,000 fatalities and 10 million infected
people worldwide.  Let’s face it.  The mere thoughts of that scale of death and
disease are somewhat crippling to me on good days. Add to that the normal stress of
making sure I am being a good worker, colleague, husband, and father.  Pick any 1 or 2
of those reason, and most people would understand my reasons if I said “I started
writing a blog, but I stopped when…”</p>
<p>But I continue writing this blog and continue developing the project.  I have good days
and I have bad days, and I also have just, well, days.  But I keep on trying.
I know I am not going to get the blog right each time, but I try, and I improve.
I know I am not going to get the PyMarkdown project right on the first try,
and I am probably at my tenth or eleventh try if I add all the small tries
together.  But I keep on trying.</p>
<p>And that is where the second half of the saying comes into play: figure out what to do
next.  There is a great quote that may or may not be attributed to
<a href="https://quoteinvestigator.com/2017/03/23/same/">Albert Einstein</a>:</p>
<blockquote>
<p>Insanity is doing the same thing over and over again and expecting different results.</p>
</blockquote>
<p>Figuring out what to do next for me is learning from what just happened, trying to avoid
the same mistakes in the future.  Does it always work? Nope.  Sometimes it takes a
couple of times for me to figure things out.  Sometimes I do not figure them out and
have to ask for help on how to deal with those mistakes or how to prevent them.  And
in some rare cases, I just need to let them be.  But that is also learning: learning
what I can do, what I cannot do, and trying to understand the effort required for each.</p>
<h2 id="how-does-this-relate-to-my-current-situation">How Does This Relate to My Current Situation?<a class="headerlink" href="#how-does-this-relate-to-my-current-situation" title="Permanent link">¶</a></h2>
<p>I went down a rabbit hole and lost 4-5 days of productive work, only to realize that
when I was completely obsessed with the solution.  While I did struggle to find some
positive spin on the situation, it was
a rough break to deal with. Mentally, it took me about a week to get over the “oh no, I
went there
again” thoughts in my head.  Emotionally, I was hard on myself because I had “let
myself” not pay attention and lost my way.  Then add the weight of the elements in
my environment that were going on around the world at that time.  It took me a bit to
work through that quagmire.</p>
<p>But I do not believe on giving up on something without a good reason.  I have learned a
lot about Python, writing, and myself by working on the PyMarkdown project and writing
about it in this blog.  The things that I have learned are in all sorts of areas, not
just the technical areas that I expected.  And personally, I have committed to this
path: to learning and helping others learn.  Basically, I have too many good reasons
to keep going, and not many reasons to give up.</p>
<p>And yes, it was hard to push myself forward for the first couple of
weeks, through all the emotional and mental debris in the way.  I did a lot of
falling in that time, deciding each time to pick myself up.  There were times when the
words flew out of my fingers, and times where I could not type the next line in either
the project or the blog.  But I had confidence that I would work through it, and that
I would not give up.  This was something I knew I could do, I just had to push through
some bad stuff to get there.</p>
<h2 id="where-to-start">Where to Start?<a class="headerlink" href="#where-to-start" title="Permanent link">¶</a></h2>
<p>I knew that I had to push forward with something positive, but what to do?  After a
bit of thinking, hoping to get myself back into the writing mood, I decided that I
would make some enhancements to the work already done.
In the last article, I described how I added code to validate the initial token in the
token stream.  This was done by only adding logic into the function for the cases where
the <code>last_token</code> variable was <code>None</code> for any block tokens.  The plan for this
enhancement was to keep the focus on block tokens, but to focus on the other block
tokens in the arrays. That is, focus on the cases where the the <code>last_token</code> variable
was not <code>None</code>.</p>
<h3 id="keeping-the-scope-small">Keeping the Scope Small<a class="headerlink" href="#keeping-the-scope-small" title="Permanent link">¶</a></h3>
<p>After being burnt by the events documented in the previous article, I wanted to be extra
careful by setting myself up for success.  If I started with a small scope and found
that I was able to get it working quickly, I could always do more work on a subsequent
enhancement.  Knowing how I work; I knew that it would be far more difficult for me to
reduce the work’s scope once I had started it.  Especially when my confidence needed
a boost, I needed a solid, yet achievable, goal that I could complete with confidence.</p>
<p>The question was where to start?  I had a feeling that dealing with leaf blocks which
started on the same line as container blocks were going to be a headache, so I removed
them from the scope.  I knew that I had issues with tab characters from the last
enhancement, so I removed them as well.  Was there anything else I could remove?</p>
<p>Looking over the scenario tests and their data while scribbling some notes for myself,
I quickly came to two conclusions.
The first was that verifying the consistency of list-related objects would be relatively
easy, as the token contained all the necessary data.  Because of the presence of the
<code>indent_level</code> variable and extracted whitespace in those tokens, I was able to quickly
figure out how to check their consistency.  After a couple of mental dry runs with my
solution and the real test data, I had confidence I could complete those checks.</p>
<p>The second conclusion was that handling the block quote tokens were going to be
a completely different issue. Those tokens did not have a concept like
an <code>indent_level</code> that could be generally applied, nor any memory of the whitespace
that they extracted from the line.  Supporting consistency checking with block quotes
was going to take some decent changes to the block quote tokens, something that was
going to take a lot of time and planning to properly execute.</p>
<p>With these considerations in mind, I decided that
this enhancement would not address any token arrays with block
quote tokens or tab characters.  To keep things more manageable, I would restrict
any checking to leaf block tokens on new lines.  With this in place, it was good to go!
But I needed to add one thing first: a consistency token stack.</p>
<h3 id="adding-the-consistency-token-stack">Adding the Consistency Token Stack<a class="headerlink" href="#adding-the-consistency-token-stack" title="Permanent link">¶</a></h3>
<p>The necessity for adding this stack to the consistency check was not a surprise to me.
To allow the parser to maintain a proper understanding of what the scope of the active
container blocks was, I added a stack to the parser explicitly for those container
blocks.  With the task of validating the consistency of the tokens and without access
to that internal stack, I knew that I needed to replicate some of the functionality
of that stack.</p>
<p>Before any of the serious checking of the tokens took place, I needed a simple
stack that would track which container tokens were currently active.  The first pass at
this was really simple, with the
<a href="https://en.wikipedia.org/wiki/Pseudocode">pseudocode</a>
being as follows:</p>
<div class="highlight"><pre><span></span>for each token:
  if the token is a container block:
    add the token to the stack
  else if the token ends a container block:
    remove the last item from the stack

  do the rest of the processing
</pre></div>
<p>This pseudocode is part of my mental algorithm repository that I lovingly refer to as
Parser 101.  Except in the case
of very simple parsers, almost every other parser I have written has had to maintain
some manner of stack to track context.  While the consistency checker is not a
full-fledged parser, it is operating on the tokens generated by a legitimate
full-fledged parser.  As such, it made sense that some of my parser experience would
assist me with this enhancement.</p>
<p>The first pass at implementing this algorithm was a simple translation of the above
pseudocode fragment into Python code.  The <em>if the token is a container block</em>
translation was simple, due to a previous refactoring:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">CONTAINER_BLOCK</span><span class="p">:</span>
</pre></div>
<p>and the <em>add the token to the stack</em> part of the translation was just as simple:</p>
<div class="highlight"><pre><span></span>    <span class="n">container_block_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
</pre></div>
<p>The <em>if the token ends a container block</em> part of the translation was a bit more
tedious to implement.  This was primarily due to end tokens not having any concept of
the token that started that block, only the name.  As such, after adding a comment and
a note to improve this, the following code was written to figure out if the container
block was ending:</p>
<div class="highlight"><pre><span></span>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_token</span><span class="p">,</span> <span class="n">EndMarkdownToken</span><span class="p">):</span>
        <span class="n">token_name_without_prefix</span> <span class="o">=</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span><span class="p">[</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">EndMarkdownToken</span><span class="o">.</span><span class="n">type_name_prefix</span><span class="p">)</span> <span class="p">:</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">token_name_without_prefix</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_block_quote</span><span class="p">,</span>
            <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_unordered_list_start</span><span class="p">,</span>
            <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_ordered_list_start</span><span class="p">,</span>
            <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_new_list_item</span><span class="p">,</span>
        <span class="p">):</span>
</pre></div>
<p>Finally, the <em>remove the last item from the stack</em> was translated into:</p>
<div class="highlight"><pre><span></span>            <span class="k">assert</span> <span class="n">container_block_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">token_name_without_prefix</span>
            <span class="k">del</span> <span class="n">container_block_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
<p>After all that was added, I quickly ran the tests and… tests were failing all over
the place.  But why?</p>
<h3 id="getting-the-stack-code-working">Getting the Stack Code Working<a class="headerlink" href="#getting-the-stack-code-working" title="Permanent link">¶</a></h3>
<p>Looking at the stack code, something became obvious almost immediately. If my
observation was correct, the processing of the <code>EndMarkdownToken</code> was never being
invoked. A couple of quick debug statements verified that observation.  Doing a bit
more digging, I found out that I had set the class of the <code>EndMarkdownToken</code> to
<code>INLINE_BLOCK</code>.  This meant at the start of the consistency check loop, the code:</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">INLINE_BLOCK</span><span class="p">:</span>
</pre></div>
<p>would prevent the <code>EndMarkdownToken</code> from ever getting through.  A quick fix changed
that statement to:</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="p">(</span>
            <span class="n">current_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">INLINE_BLOCK</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_token</span><span class="p">,</span> <span class="n">EndMarkdownToken</span><span class="p">)</span>
        <span class="p">):</span>
</pre></div>
<p>and the test all ran… er… not fine?  With echoes of “what now?” ringing through
my ears, and debugging some more, the answer took a while to find.  Using extra
debug statements, I was able to pull some additional information out of the tests.
It became apparent that the second half
of the function had many issues with those end tokens.  However, addressing that
issue was easy, by adding the following code:</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_token</span><span class="p">,</span> <span class="n">EndMarkdownToken</span><span class="p">):</span>
            <span class="k">continue</span>
</pre></div>
<p>after the stack code and before the remaining code.  A couple of extra test runs, both
with and without debug statements and… everything was working with the new stack code.
On to the next issue!</p>
<h3 id="removing-block-quotes">Removing Block Quotes<a class="headerlink" href="#removing-block-quotes" title="Permanent link">¶</a></h3>
<p>With the stack code in place and running cleanly, I needed to add the code to
prevent checking for the consistency for block quotes.  As previously decided, block
quotes were outside the scope of the current enhancement, and as such the following
code was added to check for block quotes:</p>
<div class="highlight"><pre><span></span>            <span class="n">found_block_quote</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">container_block_stack</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_block_quote</span><span class="p">:</span>
                    <span class="n">found_block_quote</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">found_block_quote</span><span class="p">:</span>
                <span class="n">last_token</span> <span class="o">=</span> <span class="n">current_token</span>
                <span class="k">continue</span>
</pre></div>
<p>While this code may seem flawed, it was written this way on purpose.  I did not want
to have to validate any tokens that were contained within a block quote block, but I
did not want to remove the validation of the non-contained tokens either.  The above
block of code simply checks to see if there is a block quote on the container block
stack, skipping over any token while that condition is true.  This allows for any
block quote contained tokens to be avoided, while still validating any other tokens
present in that test sample.</p>
<h3 id="ignoring-tabs-for-now">Ignoring Tabs for Now<a class="headerlink" href="#ignoring-tabs-for-now" title="Permanent link">¶</a></h3>
<p>The other big thing to take care of was to ignore any tabs that occurred in the
initial whitespace for any of the block tokens.  This was accomplished by changing the
return value of <code>__calc_initial_whitespace</code> to be a pair of values, the first being the
same <code>indent_level</code> as before and the second was a new <code>had_tab</code> variable.  By setting
this variable, it was then possible to change this assert:</p>
<div class="highlight"><pre><span></span>            <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">init_ws</span>
</pre></div>
<p>to:</p>
<div class="highlight"><pre><span></span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">had_tab</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">init_ws</span>
</pre></div>
<p>As I knew tabs were going to be a problem until they are properly and thoroughly
addressed, this change circumvented the assert statement when a tab was encountered.</p>
<h2 id="adding-the-basic-enhancement">Adding the Basic Enhancement<a class="headerlink" href="#adding-the-basic-enhancement" title="Permanent link">¶</a></h2>
<p>With those changes in place and the tests passing, it felt that it was the right time
to add the code for the planned enhancement.  The basic part of this change was
easy, adding an else statement that followed the <em>same line number</em> check, as such:</p>
<div class="highlight"><pre><span></span>            <span class="k">if</span> <span class="n">last_position</span><span class="o">.</span><span class="n">line_number</span> <span class="o">==</span> <span class="n">current_position</span><span class="o">.</span><span class="n">line_number</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">last_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">CONTAINER_BLOCK</span>
                <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">&gt;</span> <span class="n">last_position</span><span class="o">.</span><span class="n">index_number</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init_ws</span><span class="p">,</span> <span class="n">had_tab</span> <span class="o">=</span> <span class="n">__calc_initial_whitespace</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">had_tab</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">init_ws</span>
</pre></div>
<p>This part of the algorithm makes clear sense.  Leaf blocks always start on a new
line, except for when they are started on the same line as a container block. As such,
the token starts right after any leading whitespace.  Since this enhancement focuses
solely on leaf block tokens on a new line, and due to the previous work to ignore any
tabs in the consistency checks, this code was kept simple.</p>
<p>Testing this code out in my head, it was all sound except for when the token was in
a container block.  While
block quote blocks were excluded, that still left list blocks.  As such, when I ran the
tests this time, I expected failures to occur with leaf blocks that are started on their
own line but are contained within a list block.  As I went through the test run
failures, it was affirming to see that each of the failures that were now showing up
were squarely within those parameters.</p>
<h3 id="going-through-the-failures">Going Through the Failures<a class="headerlink" href="#going-through-the-failures" title="Permanent link">¶</a></h3>
<p>As I went through the failures from the last set of code changes, I scribbled down notes
about the failure patterns that I saw.  The big pattern that I observed is, what I felt,
was a very obvious one.
When a leaf block was created within a list block, the reported column number was
always one more than the <code>indent_level</code> variable for the list token.  That pattern does
make sense, as the list block contains the new leaf block, calculated from the indent
level of the list.</p>
<p>The first pass at modifying the check to take this into account was the following:</p>
<div class="highlight"><pre><span></span>                <span class="n">top_block</span> <span class="o">=</span> <span class="n">container_block_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">top_block</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_unordered_list_start</span>
                    <span class="ow">or</span> <span class="n">top_block</span><span class="o">.</span><span class="n">token_name</span>
                    <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_ordered_list_start</span>
                    <span class="ow">or</span> <span class="n">top_block</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_new_list_item</span>
                <span class="p">):</span>
                    <span class="n">init_ws</span> <span class="o">+=</span> <span class="n">top_block</span><span class="o">.</span><span class="n">indent_level</span>
</pre></div>
<p>This code almost worked but reported errors with the first line.  That was quickly
addressed with a simple change to the code, checking to make sure that the
<code>container_block_stack</code> variable containing the container stack is not empty:</p>
<div class="highlight"><pre><span></span>                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">container_block_stack</span>
                <span class="p">):</span>
                    <span class="n">top_block</span> <span class="o">=</span> <span class="n">container_block_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">top_block</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_unordered_list_start</span>
                        <span class="ow">or</span> <span class="n">top_block</span><span class="o">.</span><span class="n">token_name</span>
                        <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_ordered_list_start</span>
                        <span class="ow">or</span> <span class="n">top_block</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_new_list_item</span>
                    <span class="p">):</span>
                        <span class="n">init_ws</span> <span class="o">+=</span> <span class="n">top_block</span><span class="o">.</span><span class="n">indent_level</span>
</pre></div>
<h3 id="dealing-with-consistency-and-lists">Dealing with Consistency and Lists<a class="headerlink" href="#dealing-with-consistency-and-lists" title="Permanent link">¶</a></h3>
<p>At this point, the only tests that were failing were tests related to list blocks.
Most of those tests were either contained in the <code>test_markdown_list_blocks.py</code> module
or the <code>test_markdown_lists.py</code> module.  Doing a bit more digging, the reason for a lot
of the failures was visible within seconds of looking at the failing scenario tests.
To make sure that lists and their inevitable sublists can be controlled properly, the
<code>indent_level</code> variable contains the required indentation from the beginning of the
line, not since the end of the last list block.  To
complement this, any whitespace that occurs before that list block is saved within
the list block token.  The effect of this is that both ordered and unordered list
start tokens did not require any further modification, containing all the required
information within their own token.</p>
<p>To address this, the check for adjusting the calculation if the token is in a list
was changed to:</p>
<div class="highlight"><pre><span></span>                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">container_block_stack</span>
                    <span class="ow">and</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span>
                    <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_unordered_list_start</span>
                    <span class="ow">and</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span>
                    <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_ordered_list_start</span>
                <span class="p">):</span>
</pre></div>
<p>Furthermore, on additional examination, blank lines were in a similar situation.  Blank
lines contain complete information on how they were derived, so no manipulation of the
token’s column number was required.  Hence, another slight modification of the check
resulted in the code:</p>
<div class="highlight"><pre><span></span>                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">container_block_stack</span>
                    <span class="ow">and</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_blank_line</span>
                    <span class="ow">and</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span>
                    <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_unordered_list_start</span>
                    <span class="ow">and</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span>
                    <span class="o">!=</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_ordered_list_start</span>
                <span class="p">):</span>
</pre></div>
<h3 id="almost-there">Almost There<a class="headerlink" href="#almost-there" title="Permanent link">¶</a></h3>
<p>Running the tests again, the number of failures remaining was now a much smaller set of
tests.  Once again doing my due diligence,
I discovered an interesting issue with the new list item token: I had left out an
important field out of the token.  Unlike the ordered and unordered list start tokens,
the contents of
the new list item
token only had the <code>indent_level</code> field, with the <code>extracted_whitespace</code> field being
added to try and solve the failures.  But without the proper values for the
<code>extracted_whitespace</code> field, it was not a proper solution to the problem.  I even
made modifications to the container block stack to properly deal with the new list
tokens. But even with those two changes in place, it just was not enough to solve all
the issues.</p>
<p>Once I determined that it was not enough, I knew that I had to fix this properly at a
later date and close out this enhancement.  To accomplish that, I made a small change
to the code as part of the main consistency check: </p>
<div class="highlight"><pre><span></span>            <span class="k">elif</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_new_list_item</span><span class="p">:</span>
                <span class="c1"># TODO later</span>
                <span class="k">pass</span>
</pre></div>
<p>I did not feel that it was a great solution, but it was a decent stop-gap until I
could address those tokens.</p>
<h2 id="the-inevitable-bug-fixes">The Inevitable Bug Fixes<a class="headerlink" href="#the-inevitable-bug-fixes" title="Permanent link">¶</a></h2>
<p>Along the way, there were some small issues that were uncovered in the parser code,
fixed almost immediately due to their small nature.  There was a small fix made to the
<code>list_in_process</code> function to make sure that the line was adjusted properly in some
edge cases.  There was another fix to the <code>__adjust_for_list_start</code> function to make
sure that it returned an indication of whether it processed the list start index or not.
And finally, even though the tabs were not part of the enhancement, there was a bit
of cleanup to do in the area of the dual-purpose code used to handle list indents and
block quotes.  None of these were big bugs, but little issues that the consistency
checker was uncovering, and getting dealt with up front before they became a larger
issue.</p>
<p>And that is where I stopped.  I knew that if I started trying to get more of the tab
code to work, it would be another rabbit hole.  Reminding myself of the big picture and
the current goals for the enhancement, I backed off.  And after a couple of minutes,
I felt good about it.  Tabs would wait for another enhancement, and then I would spend
a good amount of time working on tabs.  But for now, it could wait.</p>
<h2 id="importance-of-starting-small">Importance of Starting Small<a class="headerlink" href="#importance-of-starting-small" title="Permanent link">¶</a></h2>
<p>I needed this enhancement to be a win, and I think I achieved that by keeping my
goals in mind. Rather than trying to do everything and having my effort be scattered,
I kept my work focused within the boundaries of a simple goal, one that I had
confidence that I would be able to achieve.  With this progress, I felt more confident
about myself and the project, and I knew I was on my way back to building a solid and
stable foundation that I could build further on.</p>
<p>While my previous experience guided me towards this approach as I needed a win, it is
a solid approach regardless.  One of my managers at a previous company used to say:</p>
<blockquote>
<p>It is better to under promise and over perform than the other way around.</p>
</blockquote>
<p>I prefer another quote that was relayed to me by a friend at my current company:</p>
<blockquote>
<p>Having a conversation with someone about resetting expectations is always troubling for me.  I would rather my reports take small bites of work and get better estimates on those bites of work, than take huge chunks of works and get lost and need help finding their way.</p>
</blockquote>
<p>Those words have stayed with me for a long while, and I have tried to live up to the
essence of that quote.  I cannot tell anyone when the PyMarkdown linter is going to be
ready.  The scope is big enough that I cannot accurately judge that span of time.  But
I can let people know what my next 3 items on the issue list are, and approximately how
long it will take to complete them.  Those items are my small bites, something I can
solidly analyze and realistically figure out a time frame for their completion.</p>
<p>For me, I feel that it is better to complete 10 tasks that work together than to
complete 1 task that will not work until it is completely done.  There just is no
comparison in my mind.  And having just completed one of those smaller tasks, my
confidence was returning.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>After my experience with the rabbit hole called <em>Tabs</em>, I was worried that I was
going to focus more on the negative aspects of the project, rather than making
some good progress.  Would I repeat the behavior that I documented in my last article,
or would I correct that behavior and move the project forward?  While the
enhancements I made to the consistency checking were small, I was convinced that they
were solid enhancements.  That was exactly the type of win that I needed.</p>
<p>This enhancement was not about technical feasibility, it was about getting myself out of
a negative headspace.  I believe it is true of most people that we are own worst
enemies, as we are privy to those thoughts and emotions that we keep private.  I know
that I am my own worst enemy for those reasons.  And while I did try hard with the
last enhancement, I know I was harder on myself that others would have been.  Not for
going down the rabbit hole, but because I did not notice I had slipped down there and
needed to get out of there before getting lost.</p>
<p>I started this enhancement trying to get rid of the “oh no, here we go again” mindset.
Based on where my confidence was at finishing this enhancement, I am proud to report a
lot of positive work has been done.  My confidence was by no means back to where it
should be, but I was on my way there.  I developed a plan, made certain limitations,
and stuck by those limitations while delivering a well thought out enhancement.</p>
<p>This was definitely a step in the right direction.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Having added a few issues to my issues log, mostly to verify certain scenarios I tested
or wrote about, I knew that I had some technical debt building up.  Along with the
new list item token issue, I felt it was a good time to build up some more confidence
by knocking some more of those issues out of the way.</p>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Rabbit%20Hole%203%20-%20Trying%20To%20Dig%20Myself%20Out&url=https%3A//jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Rabbit%20Hole%203%20-%20Trying%20To%20Dig%20Myself%20Out&amp;body=https%3A//jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-rabbit-hole-3-trying-to-dig-myself-out"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Previous: Markdown Linter - Rabbit Hole 2 - Losing My Way">Markdown Linter - Rabbit Hole 2 - Losing My Way</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Next: Markdown Linter - Weeding the Project&#39;s Issue List">Markdown Linter - Weeding the Project's Issue List</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~18 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-06-29T00:00:00-07:00">Jun 29, 2020</time>
        <h4>Markdown Linter Core</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" title="Markdown Linter - Core - Pre-Rule Improvements">Part 1: Markdown Linter - Core - Pre-Rule Improvements</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Markdown Linter - Taking Time To Evaluate">Part 2: Markdown Linter - Taking Time To Evaluate</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Markdown Linter - Adding Line and Column Support">Part 3: Markdown Linter - Adding Line and Column Support</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" title="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks">Part 4: Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Markdown Linter - Rabbit Hole 2 - Losing My Way">Part 5: Markdown Linter - Rabbit Hole 2 - Losing My Way</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Markdown Linter - Weeding the Project's Issue List">Part 6: Markdown Linter - Weeding the Project's Issue List</a>
            </li>
            <li  class="active-part">
            Part 7: Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" title="Markdown Linter - Improving Consistency">Part 8: Markdown Linter - Improving Consistency</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Markdown Linter - Transforming Back to Markdown">Part 9: Markdown Linter - Transforming Back to Markdown</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>12</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>30</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2019 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>