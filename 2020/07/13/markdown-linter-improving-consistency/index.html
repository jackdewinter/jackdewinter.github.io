<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I talked about how I “weeded” the project’s issues list to build up my confidence that the PyMarkdown project was going in the right direction. In this article, I talk about how I used that confidence to get back to work on the consistency …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Improving Consistency "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" />
<meta property="og:description" content="Summary¶ In my last article, I talked about how I “weeded” the project’s issues list to build up my confidence that the PyMarkdown project was going in the right direction. In this article, I talk about how I used that confidence to get back to work on the consistency …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-07-13T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Improving Consistency ">
<meta name="twitter:description" content="Summary¶ In my last article, I talked about how I “weeded” the project’s issues list to build up my confidence that the PyMarkdown project was going in the right direction. In this article, I talk about how I used that confidence to get back to work on the consistency …">

        <title>Markdown Linter - Improving Consistency  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/">
                Markdown Linter - Improving Consistency
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#is-the-cost-worth-the-benefit">Is the Cost Worth The Benefit?</a></li>
<li><a href="#lists-and-blank-lines">Lists and Blank Lines</a><ul>
<li><a href="#identifying-the-issue">Identifying the Issue</a></li>
<li><a href="#working-the-problem">Working the Problem</a></li>
<li><a href="#improving-consistency">Improving Consistency</a></li>
</ul>
</li>
<li><a href="#making-position-markers-immutable">Making Position Markers Immutable</a><ul>
<li><a href="#benefits-of-immutable-objects">Benefits of Immutable Objects</a></li>
<li><a href="#making-the-change">Making the Change</a></li>
<li><a href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li><a href="#preventing-consistency-checks-for-tabs">Preventing Consistency Checks for Tabs</a></li>
<li><a href="#extracting-list-item-whitespace">Extracting List Item Whitespace</a><ul>
<li><a href="#correctly-extracting-the-whitespace">Correctly Extracting the Whitespace</a></li>
<li><a href="#properly-enabling-consistency-checks">Properly Enabling Consistency Checks</a></li>
</ul>
</li>
<li><a href="#this-all-leads-up-to-this">This All Leads Up to This</a></li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/">last article</a>,
I talked about how I “weeded” the project’s issues list to build up my confidence that
the PyMarkdown project was going in the right direction.  In this article, I talk about
how I used that confidence to get back to work on the consistency checker for the
tokenizer that is the backbone of the PyMarkdown linter.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>At the
<a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/#what-was-my-experience-so-far">end of the last article</a>,
I talked about how confidence is more emotional than logical.  From that point of view,
resolving items off my issues list was more to fan my passion for the PyMarkdown
project that any logical reason.  And while there are logical components to my
desire to instill quality to the project at every stage, it is mostly an emotional
desire to make it better.  It is true that part of that desire is due to my experience.
I know the large cost of fixing a bug once a product is released, and I want to avoid
as many of those issues as possible as soon as possible.
But another part of that desire is because that I know that once I put the project out
there, it will be considered a reflection of my abilities. Due to both reasons
and others, I just want the project to have a healthy level of quality that I have
confidence that I can maintain.</p>
<p>It was because of that desire to maintain or increase quality on the project that I
started to think about whether the cost of my efforts was worth the benefits that I
was seeing.  Was it worth it?</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/4b681751cae38ce2007f3b0ada6158ed9a15f353">28 Jun 2020</a> and
<a href="https://github.com/jackdewinter/pymarkdown/commit/e1fad8fc839d78f52040ef849e444d1d9b623c4a">05 Jul 2020</a>.</p>
<h2 id="is-the-cost-worth-the-benefit">Is the Cost Worth The Benefit?<a class="headerlink" href="#is-the-cost-worth-the-benefit" title="Permanent link">¶</a></h2>
<p>In the end, the tokens that are generated by the project’s parser are just a series of
letters and numbers that must be verified for each scenario.  For the parser’s
scenarios alone, there are 728 scenario tests that are used to verify that parser’s
output whenever a change is made. The validation of those same tests is made easier by
the test foundations that are already in place: checking the produced tokens against a
static list for that scenario, and checking the output from transforming those tokens
against the HTML snippet for that scenario.</p>
<p>The HTML part of that verification is easy: it either matches the reference HTML output
or it does not.  The tokens are a lot more difficult to verify.  Is the actual content
correct?  Are the line number and column number correct?  Was the correct amount of
whitespace stored in the token to allow us to generate the HTML properly?  While I try
my hardest to ensure that the token information is correct, I do make mistakes.</p>
<p>And that is where I see the benefit of consistency checks.  As I documented in
<a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/">my last article</a>,
there are enough parser rules to remember that I regularly add items to the project’s
issues list to check later.  But I have also noticed that even the act of answering
those questions and whether those rules were applied properly can increase my
confidence in the project.  And if those answers can increase my confidence by
themselves, working on
completing those checks should have an even larger impact.</p>
<p>From where I was, even though the cost of adding the consistency checks was starting to
grow, I felt that my increased confidence in the project was an acceptable
benefit given that cost.  As such, it was forward with the consistency checks!</p>
<h2 id="lists-and-blank-lines">Lists and Blank Lines<a class="headerlink" href="#lists-and-blank-lines" title="Permanent link">¶</a></h2>
<p>Sometimes it is the large issues that bother us the most. But often, I
find it is the smaller items that really grind away at my mind.  If I have not started
a task, I try to make sure that I have lined up as many of the requirements for that
task as possible up before I start on the task.  This preparation helps me to focus on
the task and
to work on that task without too many interruptions.  But, as is normal in my line of
work, I have had to adapt to make sure that I can switch away from a
task before it is completed.  I am usually okay with this, as I often I find a good
stopping point and document why I stopped and what I was thinking, hoping that it
helps me pick it up later.  But if I am close to finishing a task and I know
there are only a “couple” of things left to go on that task, it is hard for me to
resist getting it over that finish line.  Just so very tough.</p>
<h3 id="identifying-the-issue">Identifying the Issue<a class="headerlink" href="#identifying-the-issue" title="Permanent link">¶</a></h3>
<p>This was the case with lists and blank lines, the subject of an item being researched
and further documented in
<a href="{filename}/articles/SoftwareQuality/core-7.md.#scenarios-197-257-and-262-blank-lines-and-lists#scenarios-197-257-and-262-blank-lines-and-lists">the last article</a>
This issue was not an overly big issue per se, but it was the issue that was gnawing at
me.  Specifically, I looked at one of the two list examples that start with a blank
line, <a href="example-257">example 257</a>:</p>
<div class="highlight"><pre><span></span><span class="o">-</span><span class="err">{</span><span class="k">space</span><span class="err">}{</span><span class="k">space</span><span class="err">}{</span><span class="k">space</span><span class="err">}</span>
</pre></div>
<p>and the text before example 257, which clearly states:</p>
<blockquote>
<p>When the list item starts with a blank line, the number of spaces following the list marker doesn’t change the required indentation:</p>
</blockquote>
<p>Based on that information, a start unordered list token occupies column 1, and the
number of spaces following the list marker is 1, for a total of 2.  As such, the
blank line, being contained within the list, starts at column number 2, with the extra
whitespaces added to the end of the line.  So why was I seeing the token <code>[BLANK(1,5):]</code>
instead of the expected token <code>[BLANK(1,2):  ]</code>?</p>
<h3 id="working-the-problem">Working the Problem<a class="headerlink" href="#working-the-problem" title="Permanent link">¶</a></h3>
<p>Doing some research, the answer was easy.  The blank line token was not wired up to
capture the following spaces, something that was quickly fixed.  But even with that
fixed, when the whitespace went to the end of the line, the count of the following
spaces was simply zeroed out within the list handler.  To fix this, I had to take
some time and create a new algorithm from scratch, paying extra attention to ensure
that trailing spaces were put in the right location.</p>
<p>I knew that the block quote tokens needed a rewrite to track the skipped block quote
characters and their trailing space characters, so I left that part alone.  But I did
update the issue to note that the list case had been fixed.  </p>
<h3 id="improving-consistency">Improving Consistency<a class="headerlink" href="#improving-consistency" title="Permanent link">¶</a></h3>
<p>With the blank token issue fixed, I then was able to add needed logic to the consistency
checker.  Previously, the content of the <code>__validate_same_line</code> function was pretty
sparse:</p>
<div class="highlight"><pre><span></span>    <span class="k">assert</span> <span class="n">last_token</span><span class="o">.</span><span class="n">token_class</span> <span class="o">==</span> <span class="n">MarkdownTokenClass</span><span class="o">.</span><span class="n">CONTAINER_BLOCK</span>
    <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">&gt;</span> <span class="n">last_position</span><span class="o">.</span><span class="n">index_number</span>
</pre></div>
<p>It was time to change that!</p>
<p>Keeping in mind that I had only addressed the above issue for blank line tokens within
a list token, the first thing I did was to exclude
the block tokens from the new code.  Then, remembering some previous work that I did,
I knew there were going to be three different asserts that
I would need to do: one for blank lines, one for indented code blocks, and one for
everything else.</p>
<div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_blank_line</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">==</span> <span class="n">last_token</span><span class="o">.</span><span class="n">indent_level</span>
        <span class="k">elif</span> <span class="n">current_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_indented_code_block</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_token</span><span class="o">.</span><span class="n">extracted_whitespace</span><span class="p">)</span>
                <span class="o">==</span> <span class="n">last_token</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">current_position</span><span class="o">.</span><span class="n">index_number</span> <span class="o">==</span> <span class="n">last_token</span><span class="o">.</span><span class="n">indent_level</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
<p>For blank lines tokens on the same line as a list token, the blank line tokens start
right after the list token, so the <code>index_number</code> is the same as the list’s
<code>indent_level</code>.  Because the indented code block token includes whitespace in its
column number, there is a bit of correction to do to take that into account.  Other than
that, the remaining leaf block tokens verify that they start at the <code>indent_level</code>
specified by the list.</p>
<p>After testing and manual verification, that change to the check was completed and
verified.  I examined around ten related scenario tests, and double checked the
results from the new modifications. But even after that extra validation, I was left
with a feeling that something was left undone.  I was not sure what it was, but
it was something to think about as I worked.</p>
<h2 id="making-position-markers-immutable">Making Position Markers Immutable<a class="headerlink" href="#making-position-markers-immutable" title="Permanent link">¶</a></h2>
<p>Honestly, the title that I was thinking of for this section was “Making Position
Markers as Immutable as Python Will Allow”, but I thought that was too long.  But let’s
get that out of the way upfront.  Python does not have a concept of an
immutable complex object.  Like most languages, the base objects (such as strings,
integers, and floats) are immutable, meaning they cannot be changed once instantiated.
To me, this makes perfect sense. If you create one of these base objects, it always
retains its properties.  If you add two of these objects together, you create a
third object to contain the results.  Basic computer science 101.</p>
<p>Python complex objects are not so nice with respect to immutability.  Sure, there are
tricks to
prevent overwriting of well-known objects within a class, but there is no built-in
support for creating an immutable complex object in Python.<sup id="fnref:norOthers"><a class="footnote-ref" href="#fn:norOthers">1</a></sup> Conveniently,
I did not need
the <code>PositionMarker</code> class to be 100% immutable, just immutable enough that I do not add
code that overwrites the member variables from that class by accident.</p>
<h3 id="benefits-of-immutable-objects">Benefits of Immutable Objects<a class="headerlink" href="#benefits-of-immutable-objects" title="Permanent link">¶</a></h3>
<p>Why is this important to me?  Partly cleanliness and partly experience.  Immutable
objects are just cleaner, as you can guarantee that their values will never change. If
you instantiate an immutable object as the first object in your program, it will still
have the same value that it was instantiated with when the program ends.  From
experience, immutability provides a level of safety that is desirable.</p>
<p>This sense of safety is because immutable objects are useful where there
is a concern about <em>random</em> side effects introduced by child objects and functions.
In the case of the parser, I know that before some previous refactorings, I
was passing the variables <code>text_to_parse</code> and <code>start_index</code> all over the place.  Even
after that refactoring, I remained concerned that the parser code could <em>accidentally</em>
alter the existing <code>PositionMarker</code> objects without a good way for me to detect it
or prevent it.  </p>
<p>By changing the <code>PositionMarker</code> class into a <em>mostly</em> immutable object, those concerns
could be largely eliminated.  Any concerns of side effects would be mitigated by the
simple fact that once the value for the member variable was specified upon creation,
it cannot be changed.  Before this change was put in place, I knew where there were
cases where I was not 100% sure that I understood where the values in the object came
from.  If I did things right, after this change I would probably have a couple of extra
instantiations in the code, but I would know that the values were solid.</p>
<h3 id="making-the-change">Making the Change<a class="headerlink" href="#making-the-change" title="Permanent link">¶</a></h3>
<p>Far from one of the bulletproof approaches talked about on
<a href="https://stackoverflow.com/questions/4828080/how-to-make-an-immutable-object-in-python">Stack Overflow</a>,
I just needed something simple to prevent accidental overwrites.  For my lightweight
approach, I chose to change the <code>PositionMarker</code> class to expose its member variables
exclusively through properties.</p>
<p>Before this change, the <code>line_number</code> member variable was defined in the constructor with:</p>
<div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">line_number</span> <span class="o">=</span> <span class="n">line_number</span>
</pre></div>
<p>When I needed to access the line number, I would simple take the instance name of
the <code>PositionMarker</code> class, say <code>position_marker</code>, and append <code>.line_number</code> to it:
<code>position_marker.line_number</code>.  Clean, simple, and neat, but also mutable.  Just
as:</p>
<div class="highlight"><pre><span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">position_marker</span><span class="o">.</span><span class="n">line_number</span>
</pre></div>
<p>assigns the value of the <code>position_marker</code> instance’s <code>line_number</code> member variable to
the local variable <code>x</code>, the following:</p>
<div class="highlight"><pre><span></span>    <span class="n">position_marker</span><span class="o">.</span><span class="n">line_number</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
<p>assigns the value of the local variable <code>x</code> to the <code>line_number</code> member variable.</p>
<p>To make the <code>line_number</code> member variable <em>mostly</em> immutable, I simply changed its
instantiation to:</p>
<div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">__line_number</span> <span class="o">=</span> <span class="n">line_number</span>
</pre></div>
<p>and added a property getter named after the original variable name, but without adding
a property setter:</p>
<div class="highlight"><pre><span></span>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">line_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Gets the line number.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__line_number</span>
</pre></div>
<p>By doing this for each member variable, two things were accomplished.  The first thing
was that by prefacing the member variable’s name with <code>__</code>, I declared it as a
private variable.  Variables declared as such are only able to be changed from within
the class that declared them.<sup id="fnref:caveat"><a class="footnote-ref" href="#fn:caveat">2</a></sup>  Then, by adding a property that has the name
of the variable without the prefix (<code>line_number</code> vs. <code>__line_number</code>), I provided
a simple read-only access to the object’s properties.  It was simple, and it
did not require any renaming of read-only references to the member variables.</p>
<h3 id="cleanup">Cleanup<a class="headerlink" href="#cleanup" title="Permanent link">¶</a></h3>
<p>The cleanup that occurred as part of that change was mostly contained within the
<code>ContainerBlockProcessor</code> class.  That made sense to me, as that is where most of the
manipulation of the position occurred after the block quote tokens and list tokens were
processed.  In that class, there were a handful of cases where I was directly
manipulating the
<code>PositionMarker</code> member variables, which now required new <code>PositionMarker</code> objects.
But since those new objects were all created within the <code>ContainerBlockProcessor</code>
class, where I expected them to be created, it
was okay.  As a nice benefit, once that cleanup was completed, there were a few
functions where the passing in of a new <code>PositionMarker</code> class was no longer needed,
resulting in some bonus dead code deletion.</p>
<p>What did I gain by doing this?  Mostly confidence.  Before that change, I was
concerned that I would introduce some <em>random</em> side effect in one of the processors.
Since the class became <em>mostly</em> immutable and was only changed in the
<code>ContainerBlockProcessor</code> class, I gained the confidence that a leaf block cannot
change any <code>PositionMarker</code> object.  Furthermore, I can easily scan to see where
that class in instantiated, knowing in an instant where any changes are occurring,
and therefore why they occurred.</p>
<h2 id="preventing-consistency-checks-for-tabs">Preventing Consistency Checks for Tabs<a class="headerlink" href="#preventing-consistency-checks-for-tabs" title="Permanent link">¶</a></h2>
<p>With all those changes in place, I was able to go back and add extra logic
to prevent the consistency checks from executing if they encountered tab characters.
Until I was able to work on proper tab character support, I felt that this was a
good way to keep the consistency checks active without having to disable them in
scenario tests that dealt with tabs.  From a quality point of view, that felt like
a short-term solution to me, not something I wanted to use long term.</p>
<p>The change side of this was implemented very quickly.  Within
the <code>utils.py</code> module, I added calls to the <code>__calc_initial_whitespace</code> function.
If the second returned value (often called <code>had_tab</code>) was <code>True</code>, the whitespace
contains a tab character.  Due to the simple nature of the consistency check
function, when this happened, I simply returned from the function at that point.</p>
<p>With those changes made, I started to work on the testing and was surprised by the
result.  I was only able to uncomment one scenario test, <code>test_tabs_004</code>. Digging
into the cases a bit, I came to an interesting realization.  I was missing the most
obvious use of tabs: in the prefixes of list content.</p>
<h2 id="extracting-list-item-whitespace">Extracting List Item Whitespace<a class="headerlink" href="#extracting-list-item-whitespace" title="Permanent link">¶</a></h2>
<p>During the early design stages of the parser, I made a simple design choice that I
believe has saved me hours of work.  I designed the container block handlers to remove
any processed text before passing the remaining text on for further processing.  That
design allowed the leaf block processing to be kept simple.  The leaf block processor
only sees the text that it needs to see to do its processing, and nothing more.
Basically, the design
choice was to make sure that each processor, container block and leaf block, had a solid
definition of their responsibilities, and to keep to those responsibilities.</p>
<p>Following that design, when the list block processing was added, the <code>indent_level</code> was
used to figure out where the encompassed leaf block tokens would start.  Before the
<code>ListBlockProcessor</code> passed the line to the <code>LeafBlockProcessor</code>, it removed exactly
<code>indent_level</code> characters from the start of the line, per that design.  As those
characters were part of the list’s structural indent, it was the list’s responsibility
to deal with those characters, not the <code>LeafBlockProcessor</code>.</p>
<p>This approach
worked fine until I needed to understand the composition of that extracted whitespace
to validate the token.  At that time, if the whitespace was composed of space
characters, everything remained fine.  One character of indent equals one space
character, and everything balances out.  But when one of those characters is a tab
character, that calculation was thrown out of whack.</p>
<p>While properly handling tab characters was out of scope, being able to detect them to
properly disable the consistency check was not.  As far as I could tell, all the
remaining scenario cases that I wanted to uncomment contained a tab character in the
list part of the line.  If done properly, it would keep the responsibility of when
to enable and disable the consistency check in the purview of the check itself.
To me, that was the desired goal.</p>
<h3 id="correctly-extracting-the-whitespace">Correctly Extracting the Whitespace<a class="headerlink" href="#correctly-extracting-the-whitespace" title="Permanent link">¶</a></h3>
<p>To be able to detect the tab characters properly, a bit of juggling had to be done.
As the best way to know which container is active was still the token stack,
I modified all three list stack tokens to allow them to keep the instance of the
list markdown token that they started.  This allowed me to add the <code>add_leading_space</code>
function to the two main list markdown tokens, effectively adding the whitespace
to the list markdown token that owns that whitespace. Once that foundation was setup,
I proceeded to modify the <code>__adjust_line_for_list_in_process</code> function from the
<code>ListBlockProcessor</code> to properly account for the leading spaces in the lines.</p>
<h3 id="properly-enabling-consistency-checks">Properly Enabling Consistency Checks<a class="headerlink" href="#properly-enabling-consistency-checks" title="Permanent link">¶</a></h3>
<p>Having completed that previous task, I knew that I was almost ready to go back and
clean up the work started in the previous section on
<a href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/#preventing-consistency-checks-for-tabs">Preventing Consistency Checks for Tabs</a>.
The only thing that I needed to do is to make
sure that if the leading spaces contained the tab character, that the leading spaces
would be set to a single tab character.  While this assignment was a large
simplification of how to handle the tab character, the proper implementation could
wait.  I just needed it to work well enough for me to detect it.</p>
<p>And it did work well enough.  By adding a couple of extra tab checks in the
right places, I was able to uncomment the remaining calls to the
<code>assert_token_consistency</code> function within the <code>test_markdown_tabs.py</code> module.
Between the previous tab checks and the extra tabs checks, the consistency checks were
now able to properly exclude any Markdown with a tab character from the checks.</p>
<p>For me, this was just the right way to do it.  While I needed to comment out those
function calls at that time, it always felt like I was cheating.  It was not the
test’s responsibility to know when to disable the consistency check, it was the
consistency check that needed to make that decision.  By moving the determination of
how to handle tabs into the consistency checks, I felt that I more properly
constrained the problem to the responsible object.  It did not feel like cheating
any more.  It just felt right.</p>
<p>But now that the consistency of the line/column numbers was in a better place, how
would I verify that the whitespace that I extracted was the correct whitespace?
If I wanted people to write solid linting rules, I want to give them solid data to
base those rules on.</p>
<h2 id="this-all-leads-up-to-this">This All Leads Up to This<a class="headerlink" href="#this-all-leads-up-to-this" title="Permanent link">¶</a></h2>
<p>Given my stated desires to check the consistency of the tokens, I could only see
one way to be sure of the content of the tokens.  While in previous weeks it was a
small voice, that small voice was now starting to speak with its outdoor voice.  To
check the content, I would need to write a Markdown transformer.</p>
<p>I had been thinking about working on this for a while, and even added an item to the
issues list to keep track of it:</p>
<div class="highlight"><pre><span></span>## <span class="nv">Features</span> <span class="o">-</span> <span class="nv">Correctness</span>

<span class="o">-</span> <span class="nv">can</span> <span class="nv">we</span> <span class="nv">generate</span> <span class="nv">Markdown</span> <span class="nv">from</span> <span class="nv">tokens</span>? <span class="k">do</span> <span class="nv">we</span> <span class="nv">have</span> <span class="nv">enough</span> <span class="nv">info</span>?
</pre></div>
<p>To me, it felt like I was trying to avoid going down this route, afraid that writing
a Markdown transformer would result in me going down another rabbit hole.  Given my
recent experience, I believe it was an acceptable concern that I needed to address
if I decided to write the Markdown transformer.</p>
<p>But from a quality point of view, I felt that writing the transformer was inevitable.
Outside of manual validation,
the only way that I could validate that that tokens were accurately representing the
Markdown document was to regenerate the original document from the tokens.  As much
as I tried to convince myself otherwise, I just could not see another path that would
provide me with the same level of quality and confidence I that I believe the project
deserves.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>While the actual work that was documented in this article varied from the work
documented in the last article, the goals driving both were the same:
quality and confidence.</p>
<p>For me, it is always important to make sure that
project responsibilities are defined and adhered to.  Some of those responsibilities
are people or role focused, and some of those responsibilities are assigned to
objects within the project.  In both cases, having those clear boundaries helps
to figure out where things go and what should be taking care of any issues.</p>
<p>Having completed this block of work, I felt good.  For me, commenting out or disabling
a test or a part of a test without a good reason just feels wrong.  Like “nails down
a chalkboard” wrong.  By properly assigning the responsibility for disabling the
consistency check to the consistency check itself, I was restoring the control of
that decision to the object that was responsible for it.  I had restored balance
to one small corner of the universe!</p>
<p>But it was hard for me not to think about doing a consistency check for the token
content.  But, like before, it boiled down to a cost-benefit analysis.  Did I
think that cost of a deep check like that would justify the benefit?  The more I
thought about it, the more it <em>just made sense</em>.  Once again, this was not a logical
decision, but an emotional one.  And as such, I did feel that the benefit justified
the cost.  I could not give a solid reason why, just a solid feeling that it would.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Once I acknowledged to myself the need for proper verification of the token’s content,
the only true viable path was to write a Markdown transformer.  While I knew that I had
a good foundation for checking the line/column numbers of the tokens, I could not see
any other alternative that would verify the tokens at a level that was acceptable to me.
But how could I start work on that massive task, and not lose myself like I did with
adding tab support?</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:norOthers">
<p>In all fairness to Python, most popular software languages do not natively support immutable complex objects without some sort of trick, pattern, or additional plugins. <a class="footnote-backref" href="#fnref:norOthers" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:caveat">
<p>As with everything, there are caveats.  If you understand the system that Python uses to mangle the names as part of making a variable private, you can <em>technically</em> get around this.  However, that effort is considered out of scope for this article.  Since all the member variables are base types, any consideration of modifying complex types exposed in this way by such an object are also considered out of scope. <a class="footnote-backref" href="#fnref:caveat" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Improving%20Consistency&url=https%3A//jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Improving%20Consistency&amp;body=https%3A//jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/07/13/markdown-linter-improving-consistency/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-improving-consistency"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Previous: Markdown Linter - Weeding the Project&#39;s Issue List">Markdown Linter - Weeding the Project's Issue List</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Next: Markdown Linter - Transforming Back to Markdown">Markdown Linter - Transforming Back to Markdown</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~16 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-07-13T00:00:00-07:00">Jul 13, 2020</time>
        <h4>Markdown Linter Core</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/05/04/markdown-linter-core-pre-rule-improvements/" title="Markdown Linter - Core - Pre-Rule Improvements">Part 1: Markdown Linter - Core - Pre-Rule Improvements</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/01/markdown-linter-taking-time-to-evaluate/" title="Markdown Linter - Taking Time To Evaluate">Part 2: Markdown Linter - Taking Time To Evaluate</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/08/markdown-linter-adding-line-and-column-support/" title="Markdown Linter - Adding Line and Column Support">Part 3: Markdown Linter - Adding Line and Column Support</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/15/markdown-linter-rabbit-hole-1-adding-consistency-checks/" title="Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks">Part 4: Markdown Linter - Rabbit Hole 1 - Adding Consistency Checks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/22/markdown-linter-rabbit-hole-2-losing-my-way/" title="Markdown Linter - Rabbit Hole 2 - Losing My Way">Part 5: Markdown Linter - Rabbit Hole 2 - Losing My Way</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/06/markdown-linter-weeding-the-projects-issue-list/" title="Markdown Linter - Weeding the Project's Issue List">Part 6: Markdown Linter - Weeding the Project's Issue List</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/06/29/markdown-linter-rabbit-hole-3-trying-to-dig-myself-out/" title="Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out">Part 7: Markdown Linter - Rabbit Hole 3 - Trying To Dig Myself Out</a>
            </li>
            <li  class="active-part">
            Part 8: Markdown Linter - Improving Consistency
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/20/markdown-linter-transforming-back-to-markdown/" title="Markdown Linter - Transforming Back to Markdown">Part 9: Markdown Linter - Transforming Back to Markdown</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/07/27/markdown-linter-addressing-the-initial-markdown-transformer-issues/" title="Markdown Linter - Addressing the Initial Markdown Transformer Issues">Part 10: Markdown Linter - Addressing the Initial Markdown Transformer Issues</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/03/markdown-linter-improving-the-markdown-transformer/" title="Markdown Linter - Improving the Markdown Transformer">Part 11: Markdown Linter - Improving the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/10/markdown-linter-adding-links-to-the-markdown-transformer/" title="Markdown Linter - Adding Links to the Markdown Transformer">Part 12: Markdown Linter - Adding Links to the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/17/markdown-linter-adding-lists-to-the-markdown-transformer/" title="Markdown Linter - Adding Lists to the Markdown Transformer">Part 13: Markdown Linter - Adding Lists to the Markdown Transformer</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/25/markdown-linter-adding-consistency-to-block-quotes/" title="Markdown Linter - Adding Consistency to Block Quotes">Part 14: Markdown Linter - Adding Consistency to Block Quotes</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/08/31/markdown-linter-adding-consistency-to-token-heights/" title="Markdown Linter - Adding Consistency to Token Heights">Part 15: Markdown Linter - Adding Consistency to Token Heights</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/07/markdown-linter-starting-to-add-linecolumn-numbers-for-inline-tokens/" title="Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens">Part 16: Markdown Linter - Starting to Add Line/Column Numbers For Inline Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/14/markdown-linter-adding-consistency-checks-for-emphasis-and-text-tokens/" title="Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens">Part 17: Markdown Linter - Adding Consistency Checks for Emphasis and Text Tokens</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/09/21/markdown-linter-adding-remaining-inline-tokens/" title="Markdown Linter - Adding Remaining Inline Tokens">Part 18: Markdown Linter - Adding Remaining Inline Tokens</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>54</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>72</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>