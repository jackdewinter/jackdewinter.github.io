<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Summary¶ In my last article, I started to tackle a few of the items on the project’s issues list. As the imaginative title for this article suggests, this article details more of the effort to reduce the items on the issues list. Introduction¶ As I mentioned in the last …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, core linter, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Delving Into the Issues - 2 "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/" />
<meta property="og:description" content="Summary¶ In my last article, I started to tackle a few of the items on the project’s issues list. As the imaginative title for this article suggests, this article details more of the effort to reduce the items on the issues list. Introduction¶ As I mentioned in the last …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-10-05T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Delving Into the Issues - 2 ">
<meta name="twitter:description" content="Summary¶ In my last article, I started to tackle a few of the items on the project’s issues list. As the imaginative title for this article suggests, this article details more of the effort to reduce the items on the issues list. Introduction¶ As I mentioned in the last …">

        <title>Markdown Linter - Delving Into the Issues - 2  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/">
                Markdown Linter - Delving Into the Issues - 2
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience for This Article?</a></li>
<li><a href="#rounding-out-coverage">Rounding Out Coverage</a><ul>
<li><a href="#what-did-i-find">What Did I Find?</a></li>
</ul>
</li>
<li><a href="#fixing-a-simple-yet-wincing-issue">Fixing A Simple, Yet Wincing Issue</a><ul>
<li><a href="#what-did-i-find_1">What Did I Find?</a></li>
</ul>
</li>
<li><a href="#verifying-the-rehydration-index">Verifying the Rehydration Index</a><ul>
<li><a href="#what-did-i-find_2">What Did I Find?</a></li>
</ul>
</li>
<li><a href="#fenced-code-blocks-and-blank-lines">Fenced Code Blocks and Blank Lines</a><ul>
<li><a href="#what-did-i-find_3">What Did I Find?</a></li>
<li><a href="#addressing-the-issue">Addressing the Issue</a></li>
</ul>
</li>
<li><a href="#testing-backslashes">Testing Backslashes</a><ul>
<li><a href="#what-did-i-find_4">What Did I Find?</a></li>
</ul>
</li>
<li><a href="#properly-escaping-special-characters">Properly Escaping Special Characters</a><ul>
<li><a href="#walking-on-the-shoulders-of-giants">Walking on The Shoulders of Giants</a></li>
<li><a href="#making-the-change">Making The Change</a></li>
<li><a href="#cleaning-up">Cleaning Up</a></li>
</ul>
</li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>In my
<a href="https://jackdewinter.github.io/2020/09/28/markdown-linter-delving-into-the-issues-1/">last article</a>,
I started to tackle a few of the items on the project’s issues list.  As the imaginative
title for this article suggests, this article details more of the effort to reduce the
items on the issues list.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>As I mentioned in the last article, this part of the project is not about anything
stellar, just going through the issues list and removing one item at a time.  Far from
moving a mountain by itself, it is all about moving that mountain one pebble at a time.
The work for this week was no different.  It was just about dealing with 6 items from
the issues list and either proving they are not an issue or fixing the item if it
really is an issue.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience for This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commits between
<a href="https://github.com/jackdewinter/pymarkdown/commit/57d7add2a3b51b0cfb9df9446f9c13b61f100ea4">15 Sep 2020</a>
and
<a href="https://github.com/jackdewinter/pymarkdown/commit/663191ae12e13fe058507b8c0f85dfc69ae38af5">20 Sep 2020</a>.</p>
<h2 id="rounding-out-coverage">Rounding Out Coverage<a class="headerlink" href="#rounding-out-coverage" title="Permanent link">¶</a></h2>
<p>While the entry for this issue:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="k">each</span> <span class="n">inline</span> <span class="n">token</span> <span class="n">surrounded</span> <span class="k">by</span> <span class="nb">text</span>
</pre></div>
<p>was short, I knew that this issue was all about completing the code coverage on
recently changed code.  I was already aware that more than half of the cases in the
consistency check
<code>__verify_first_inline_setext</code> function had the default <code>assert False</code> code put there as
a placeholder.  In addition, as soon as I looked the rest of the code, it was obvious
that I had not tested a lot of the inline sequences within an Atx Heading element or a
SetExt Heading element.  That entry was a reminder for me to circle back around 
and fix it!</p>
<p>To accomplish that, I started by working with each inline element and its relevant
position in a line of the Markdown document.  Tests 1 to 11 dealt with each inline
element at the
start of the line with text after it, tests 12 to 20 dealt with each element with text
on either side of it, and tests 21 to 31 dealt with each element at the end of the line
with text before it.  For good measure, I added tests 32 to 42 which were each inline
element by itself on a line.  Once that was accomplished for the simple case, the
Paragraph element, I cloned those tests into 2 other sets of tests, one for Atx Heading
elements and one for SetExt Heading elements. Once cloned, I introduce a small change
for both elements, the Atx Heading tests starting
with the sequence <code>#{space}</code> at the start of each line and the SetExt Heading tests
having the sequence <code>---</code> follow the test text on the next line.</p>
<h3 id="what-did-i-find">What Did I Find?<a class="headerlink" href="#what-did-i-find" title="Permanent link">¶</a></h3>
<p>Running the tests after completing those changes, I found two expected results and one
unexpected result.  The first expected result was that the new tests rounded out
the <code>__verify_first_inline_setext</code> function by providing good examples for each of
the inline elements, except for the Hard Line Break element.  The Hard Line Break element
has some special rules, so in most cases the setup caused the text to not be interpreted
into a Hard Line Break token, and just placed in a normal Text token.</p>
<p>The second expected result was that several of the <code>__handle_last_token_</code> functions
needed adjustment when evaluated within the bounds of a SetExt Heading element. During
the creation of those functions, as evidenced by the work required in the
<code>__verify_first_inline_setext</code> function, testing within a SetExt Heading element was
almost entirely missed.  While it was not difficult to address, the testing clearly
showed that I needed to add the following code to each <code>__handle_last_token_</code> function
to compensate:</p>
<div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">last_block_token</span><span class="o">.</span><span class="n">token_name</span> <span class="o">==</span> <span class="n">MarkdownToken</span><span class="o">.</span><span class="n">token_setext_heading</span><span class="p">:</span>
        <span class="n">inline_height</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
<p>Finally, the unexpected result was that the normal Paragraph processing and the Atx
Heading processing were fine, requiring no fine tuning.  While I had hoped for that
outcome, it was nice for it to happen.  I had expected at least one or two small issues
to show up, but none appeared.</p>
<h2 id="fixing-a-simple-yet-wincing-issue">Fixing A Simple, Yet Wincing Issue<a class="headerlink" href="#fixing-a-simple-yet-wincing-issue" title="Permanent link">¶</a></h2>
<p>Yes, I said a “wincing” issue.  While there are more colorful names for these issues,
I prefer the name “wincing” as I believe it is clear, descriptive, and obvious.  Quite
simply, these are a class of issues that are so simple that when I see them, I cannot
help but wince that the error made it through any of my commit processes without being
detected.  In this case, it was a typo where I typed <code>estiated_column_number</code> instead of
<code>estimated_column_number</code>, before I copied it into many places.  Yeah, I winced.</p>
<p>While I was at it, I also decided to also tackle the issue:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">52</span><span class="nv">e</span> <span class="o">-</span> <span class="nv">make</span> <span class="nv">new</span> <span class="nv">case</span> <span class="nv">with</span> <span class="nv">different</span> <span class="nv">indent</span> <span class="nv">levels</span> <span class="k">for</span> <span class="nv">each</span>`
</pre></div>
<p>Like my reasons for doing the work in the previous section on
<code>Rounding Out Coverage</code>, I just had doubts about whether I had missed anything
with the scenario test 52e.  With previous issues, I had seen a handful of false
positives occur from a test having a constant number of indent spaces. I believe my
feeling was that to truly test this scenario, I needed to add a test where the number of
ident spaces varied from line to line.  As such, I cloned scenario test 52e into 52f,
altering the indents on the second and third line to 3 spaces and 1 space, respectively.</p>
<h3 id="what-did-i-find_1">What Did I Find?<a class="headerlink" href="#what-did-i-find_1" title="Permanent link">¶</a></h3>
<p>One of the amusing things that I found out is that I get really embarrassed by simple
typos. Other than that, while I was right to question the indents from scenario test 52e,
the newly added scenario test 52f confirmed that the code was handling the indents
properly.</p>
<h2 id="verifying-the-rehydration-index">Verifying the Rehydration Index<a class="headerlink" href="#verifying-the-rehydration-index" title="Permanent link">¶</a></h2>
<p>In looking at this issue, I could easily tell beforehand that it was going to be
a research issue:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nv">why</span>?  <span class="nv">shouldn</span><span class="s1">'</span><span class="s">t each one be of the proper length?</span>
```
  <span class="k">if</span> <span class="nv">split_extracted_whitespace</span> <span class="nv">and</span> <span class="nv">last_token</span>.<span class="nv">rehydrate_index</span> <span class="o">&lt;</span> <span class="nv">len</span><span class="ss">(</span>
            <span class="nv">split_extracted_whitespace</span>
        <span class="ss">)</span>:
```
</pre></div>
<p>Introduced when I was working on the Markdown transformer, the <code>rehydrate_index</code> field
of the Paragraph token is not serialized with the other fields in the token.  It is used
exclusively for tracking the index into the Paragraph token’s <code>extracted_whitespace</code>
field.  When I reviewed this code for another issue, I believe that I saw something
about this statement that made me question why it was needed or what it was used for.</p>
<h3 id="what-did-i-find_2">What Did I Find?<a class="headerlink" href="#what-did-i-find_2" title="Permanent link">¶</a></h3>
<p>After adding extra debug statements and running through the tests, I started
to understand why I might have had issues with this code.  Normally, when software
developers talk about an index, they are referring to a number that is 0 based instead
of a position which is 1 based.  Basically, the difference is whether the counting
starts with 0, as with an index, or the counting starts with 1, as with a position.
From a purist point of view, this field
is named properly: if the field has a value of 0, it is referring to the set of
characters before the first newline character in the <code>extracted_whitespace</code> field.
Another way to look at this is that when the line is split on the newline character into
an array, as I often do for processing, the 0th element is the first element.</p>
<p>However, when this field is used, it has the appearance of being a position.  The
<code>extracted_whitespace</code> field holds any leading whitespace for a Paragraph token.
Accordingly, any whitespace
before the first newline in that field is applied as leading whitespace to that text
string as soon as that string’s processing starts.  As such, if there are multiple lines
in the paragraph, the <code>rehydrate_index</code> field is set to 1 almost from the very
beginning of processing.  So, while
it is properly called an index, it can appear to look like a position based on its usage.</p>
<p>Following that information back to the code sample above, my question now made sense.
However, while the naming could perhaps be better, it is indeed an index that somewhat
behaves like a position, with that duality causing the confusion.  In the end, after a
decent amount of review, I resolved this issue without any changes except for an extra
assert statement and some debug.  I felt that the name of the variable and the
variable’s use were both exactly what they should be.</p>
<h2 id="fenced-code-blocks-and-blank-lines">Fenced Code Blocks and Blank Lines<a class="headerlink" href="#fenced-code-blocks-and-blank-lines" title="Permanent link">¶</a></h2>
<p>This issue was an interesting one:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="nv">verify</span> <span class="nv">that</span> <span class="mi">2</span> <span class="nv">blank</span> <span class="nv">lines</span> <span class="nv">solution</span>
`<span class="k">if</span> <span class="nv">previous_inline_token</span>.<span class="nv">token_name</span> <span class="o">!=</span> <span class="nv">MarkdownToken</span>.<span class="nv">token_blank_line</span>`
<span class="nv">does</span> <span class="nv">not</span> <span class="nv">affect</span> <span class="nv">single</span> <span class="nv">line</span> <span class="nv">and</span> <span class="mi">3</span><span class="o">+</span> <span class="nv">line</span> <span class="nv">solutions</span>
  <span class="o">-</span> <span class="nv">why</span> <span class="nv">needed</span>?
</pre></div>
<p>From the start of the work on this issue, I knew it was going to either be
very simple or very complex.  The easy part of working on this issue was adding 4 new
scenario tests, 99f to 99i, to check for any abnormalities.  Based on the information
contained in the issue’s text, those new tests included multiple blank lines as well as
mixing blank lines and text lines within the Fenced Code Block element.</p>
<h3 id="what-did-i-find_3">What Did I Find?<a class="headerlink" href="#what-did-i-find_3" title="Permanent link">¶</a></h3>
<p>The first thing I did after running the tests was to adjust the produced tokens to the
new values, after manually verifying each one individually.  Considering how the
coalescing processor merged the Text tokens together, the text and the line/column
numbers for each token seemed fine.  What
was immediately different was the HTML that was produced.  Instead of being a direct
interpretation of the Markdown, the resultant HTML had a few newlines missing.</p>
<p>Far from being easy to find, this issue took me 2 days of research to find and diagnose,
revealing problems with both the HTML transformer and the Markdown transformer. This
issue just proved to be very difficult to isolate and identify.</p>
<h3 id="addressing-the-issue">Addressing the Issue<a class="headerlink" href="#addressing-the-issue" title="Permanent link">¶</a></h3>
<p>For
the HTML transformer, additional logic needed to be added to track past characters.
For whatever reason, when there are 2 blank lines in a Fenced Code Block element,
one of the newline characters is not emitted.  </p>
<p>To properly address this issue, newlines needed to be added in 3 areas.  The first
area was in the handling of the text token, where a Text token preceded by 2 Blank
Line tokens, requiring a newline to be added.  The second area was in the handling
of a Blank Line token to make sure that the newline was only added in the right cases.
Finally, at the end of a Fenced Code Block element, another check needed to be added
for the multiple Blank Line tokens, adding a newline if they were found.</p>
<p>After completing that grueling episode of debugging, my focus turned to the Markdown
transformer and consistency checks.  While I was dreading another 2 days of research
into the issue and how it affected the Markdown transformer, the results there was
very easy to see and diagnose.  When a switch is made from rehydrating a Text token
to rehydrating a Blank Line token, a newline is omitted in the process.  As such, it
was easy to identify this case and add an extra newline before focusing on the
rehydration of the Blank Line token.</p>
<p>Having fixed that issue, I reran the scenario tests and got a series of weird
errors complaining about <code>current_token</code> and <code>None</code>.  That was quickly tracked down
to working code for handling the last token in a consistency check, and checking
to see if the <code>inline_height</code> variable needed to be increased by 1 to take care of
the end Fenced Code Block token.  After adding a quick check to make sure that it was
not <code>None</code>, all the tests ran without issue.</p>
<p>I had mixed emotions about this issue as I worked through it.  On one hand, it was
not
a simple issue, so it was good to get it out of the way.  Whether it was pride or
confidence, I was pretty sure that most of the simple issues had been cleaned
up, and this easily was not a simple issue.  On the other hand, to find an issue
like this near the end of the first phase of the project was a bit disheartening.</p>
<p>In the end, I felt that the positives of finding and fixing this issue outweighed
the negatives.  It took a while to clean up, but that scenario was now running
properly.</p>
<h2 id="testing-backslashes">Testing Backslashes<a class="headerlink" href="#testing-backslashes" title="Permanent link">¶</a></h2>
<p>The item for this one was simple, yet descriptive:</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">backslashes</span> <span class="o">-</span> <span class="mi">600</span>
  <span class="o">-</span> <span class="n">verify</span> <span class="k">with</span> <span class="k">before</span> <span class="k">and</span> <span class="k">after</span> <span class="k">with</span> <span class="k">all</span> <span class="k">valid</span> <span class="n">inline</span>
</pre></div>
<p>During the various passes I have made through the code, one thing that I worried about
was whether each of the inline sequences properly handled the backslash character.
While I was confident that the start sequences of inline elements were decently
tested, I still retained a shred of doubt that I had missed something.  As for the
end of the inline elements, the confidence level was somewhere between a shred of doubt
and a hunch that I missed something.  Regardless, it was a good thing to check out
and then check off the list.</p>
<p>To complete this task, the first part was simple:  I needed to come up with a series
of scenario tests to cover all the cases for backslashes and inline character
sequences.  So, starting with the Code Span element, I started working my way through
the inline elements.  In each case, the main test was to make sure that a backslash
character before the start inline sequence prevented the inline element from starting.
Then, if there was an end inline sequence, I added an additional test to make sure that
a backslash used right before the end of the sequence had the intended result.</p>
<p>Finally, to make sure all inline sequences were covered properly, I replicated each of
the tests for all three inline blocks: Paragraph elements, Atx Heading elements, and
SetExt Heading elements.  Tests 1 to 13 were for Paragraph elements, tests 14 to 26 were
for SetExtHeading elements, and tests 27 to 39 were for the Atx Heading elements.</p>
<h3 id="what-did-i-find_4">What Did I Find?<a class="headerlink" href="#what-did-i-find_4" title="Permanent link">¶</a></h3>
<p>For this issue, I lucked out.  Each of the tests passed, without any issues.  But
far from being a disappointment, researching this issue and adding the additional
tests helped me put to rest any doubts that I had about backslash handling.</p>
<h2 id="properly-escaping-special-characters">Properly Escaping Special Characters<a class="headerlink" href="#properly-escaping-special-characters" title="Permanent link">¶</a></h2>
<p>Unlike a lot of the other issues in this block of work, this item was clearly a task:</p>
<blockquote>
<p>verify that any special characters used can be recognized and specially escaped</p>
</blockquote>
<p>To get to this point in the development of the project, I had to <em>enable</em> certain
characters to have additional meanings.  From the backspace character (\b) meaning
“do not consider the previous character” to the replacement character (\a) allowing
for a substitution to be documented, there were in all 5 characters that fit into
this group.</p>
<p>According to the Github Flavored Markdown (GFM) specification,
<a href="https://github.github.com/gfm/#character">a character is</a>:</p>
<blockquote>
<p>a Unicode code point. Although some code points (for example, combining accents) do not correspond to characters in an intuitive sense, all code points count as characters for purposes of this spec.</p>
</blockquote>
<p>Following this logically, any character that is a classic ASCII control character, that
is a character between 0 and 31, is considered part of the Unicode control characters
group.  As all the special characters are classic control characters, they also exist
as valid Unicode code points.  Therefore, if I wanted to use them as special characters,
I had to make sure to escape them if they appeared in input.</p>
<p>So now, to complete this task, I just needed to figure out how to do that.</p>
<h3 id="walking-on-the-shoulders-of-giants">Walking on The Shoulders of Giants<a class="headerlink" href="#walking-on-the-shoulders-of-giants" title="Permanent link">¶</a></h3>
<p>Many languages face the same problem that I was then facing: how do we represent a
control character in various formats while keeping the string readable?  In
the case of strings in languages such as Python, the backslash character is the go-to
choice.</p>
<p>A good example of this is the definition of the various special characters themselves.</p>
<div class="highlight"><pre><span></span>    <span class="n">__backspace_character</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\b</span><span class="s2">"</span>
    <span class="n">__alert_character</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\a</span><span class="s2">"</span>
    <span class="n">whitespace_split_character</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x02</span><span class="s2">"</span>
    <span class="n">replace_noop_character</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x03</span><span class="s2">"</span>
    <span class="n">blech_character</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x04</span><span class="s2">"</span>
</pre></div>
<p>In the first two cases, the backslash precedes a character which is a stand-in for the
control character.  In the two first cases, the <code>\b</code> character is standing in for the
backspace character (ASCII 08) and the <code>\a</code> character is standing in for the bell or
alert character (ASCII 07).  In the remaining cases, the <code>\x</code> informs the Python
interpreter that a 2-digit hexadecimal number will follow that is the actual character to
insert into the string.  In all cases, there is a clear understanding of what the
character is, due to the backslash character escaping the readable form of the character
to insert.</p>
<p>For the processing of Markdown documents, the backslash was not a good character to use.
The biggest advocate against its use was that it was already being used as an escape
character
for Markdown’s special characters.  To efficiently escape the desired character
sequences, the
chosen sequence would have to be one that rarely showed up in the normal Markdown
document.  Unimaginatively, I ended up choosing the character <code>\x05</code>.</p>
<p>I could try and explain why it was the best choice, giving lots of made up reasons, but
in this case, the reason was simple: 5 follows after 4.  It made a lot of sense to
pick another control character for the escaping character, as the other characters were
all in that group.  At that point, after eliminating any control characters that were
commonly used, there were roughly 25 characters left.  Any character would have been
just as good as the others, so I just picked the next one in the sequence.  Sometimes
you need to solidly think something through, and sometimes you just need to pick
something that just works.  This was definitely a “just works” moment.</p>
<h3 id="making-the-change">Making The Change<a class="headerlink" href="#making-the-change" title="Permanent link">¶</a></h3>
<p>From the outset, I knew that if I did this change properly, the bulk of the work would
be contained within the <code>ParserHelper</code> class and the <code>InlineProcessor</code> class.  The
changes to the <code>InlineProcessor</code> class were easy to define. When parsing inline blocks
of text, I would need to specifically look for any of the special characters, escaping
them before moving forward with the rest of the string.  For any processing after that
change had been made, I knew that is where the <code>ParserHelper</code> class came in.</p>
<p>Adding the following declaration to the top of the class:</p>
<div class="highlight"><pre><span></span><span class="n">escape_character</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x05</span><span class="s2">"</span>
</pre></div>
<p>the next function was easy.  To avoid a cycle in the module dependencies,
the <code>valid_characters_to_escape</code> function was added to allow the <code>InlineProcessor</code> class
query the <code>ParserHelper</code> class for the characters to escape.  After that, to make sure
that I had coded things properly, I added a series of 24 scenario tests prefixed with
<code>test_textual_content_extra_</code> to perform special character tests.  Starting with a
simple test with an example that contained each special character, those tests quickly
moved to testing various combinations of each character and normal text.  Each section
picked a specific type of escaped character, including it in a simple string and
interspersed with examples that produced the unescaped versions of those same characters.</p>
<p>A good example of this is the function <code>test_textual_content_extra_4</code>.  Used to test
the replacement character <code>\a</code>, the Markdown document is as follows:</p>
<div class="highlight"><pre><span></span><span class="err">\</span><span class="n">a</span><span class="o">&amp;</span><span class="err">\</span><span class="n">a</span><span class="o">&amp;</span><span class="err">\</span><span class="n">a</span>
</pre></div>
<p>To prove that the code is working properly, an escaped replacement character must appear
on either side of an actual replacement sequence, also using the <code>\a</code> character.  This
results in a Text token containing the text <code>\x05\a\a&amp;\a&amp;amp;\a\x05\a\a&amp;\a&amp;amp;\a\x05\a</code>,
as predicted.  It starts with the sequence <code>\x05\a</code> to provide for an actual <code>\a</code>
character to be output.  The following sequence, <code>\a&amp;\a&amp;amp;\a</code> then documents that the
<code>&amp;</code> character was replaced with the text <code>&amp;amp;</code>.  From there, it just repeats enough
times to make sure it works well.</p>
<p>Once that simple sequence and others like it with the <code>\a</code> character were verified,
this pattern was then repeated with the other inline containers: Atx Heading elements
and SetExt Heading elements.</p>
<h3 id="cleaning-up">Cleaning Up<a class="headerlink" href="#cleaning-up" title="Permanent link">¶</a></h3>
<p>While these changes sound good in theory, in practice there were some issues that needed
to be addressed.  The major change was the inclusion of the function
<code>remove_escapes_from_text</code>.  To ensure that those character were properly represented,
I needed to be able to present a text string and have any instances of the escape
character removed from them.  Basically, if I supplied a Markdown document of <code>\aa</code>,
that <code>\a</code> character is then escaped, producing a token with the text <code>\x05\aa</code>  When
I go to use that text, I need to remove the “protection” of the escape character before
rendering that text.</p>
<p>That was easy to do, and as I started adding calls to the <code>remove_escapes_from_text</code>
function, there were some previously working tests that started failing.  After doing a
bit of research, the cases that were failing were a portion of the tests that relied
on the <code>remove_x_from_text</code> and <code>resolve_x_from_text</code> functions.  In each of those
functions, something like the following was being done:</p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_backspaces_from_text</span><span class="p">(</span><span class="n">token_text</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">token_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ParserHelper</span><span class="o">.</span><span class="n">__backspace_character</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
</pre></div>
<p>While that was acceptable before this change, there was one glaring error with it after
this change: it was removing all backspace characters, including escaped ones.  Thought
it took a bit more code, that one function was transformed into the following:</p>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_backspaces_from_text</span><span class="p">(</span><span class="n">token_text</span><span class="p">):</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">adjusted_text_token</span> <span class="o">=</span> <span class="n">token_text</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>
        <span class="n">next_backspace_index</span> <span class="o">=</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">__find_with_escape</span><span class="p">(</span>
            <span class="n">adjusted_text_token</span><span class="p">,</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">__backspace_character</span><span class="p">,</span> <span class="n">start_index</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="n">next_backspace_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">adjusted_text_token</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">adjusted_text_token</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">next_backspace_index</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">adjusted_text_token</span><span class="p">[</span><span class="n">next_backspace_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
            <span class="p">)</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="n">next_backspace_index</span>
            <span class="n">next_backspace_index</span> <span class="o">=</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">__find_with_escape</span><span class="p">(</span>
                <span class="n">adjusted_text_token</span><span class="p">,</span> <span class="n">ParserHelper</span><span class="o">.</span><span class="n">__backspace_character</span><span class="p">,</span> <span class="n">start_index</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">adjusted_text_token</span>
</pre></div>
<p>While it was not as simple, it was correct.  Create a copy of the string, and then look
for the first occurrence of the backspace character that is not escaped.  When that
is done, adjust that copy to remove that backspace, and then continue searching from
there until there are no more backspaces to remove.</p>
<p>Finally, after all that work, there was only one set of cases left, special characters
within a code span.  This was a special case because the characters needed to be
preserved exactly, with no substitutions.  In the case of the code span, once the code
span start character sequence is found, a scan is made to locate a matching end character
sequence.  If it is found, the handler simply grabs and characters between the end of
the start sequence and the start of the end sequence.  To properly escape these
characters, the <code>escape_special_characters</code> function was added.</p>
<p>After a lot of work, and a fair number of changes, the parser was cleanly handling the
escaped characters.  From my point of view, that was a good, solid issue to end the work
for the week on!</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>While there were many little things to learn, the big thing that I am learning with
this phase of the project is that the bulk of this work is in the research.  If I
am having a good day, the research will take anywhere from 5 minutes to an hour,
followed by at least an hour of retesting, or adding a slew of new tests and then
retesting.  When that happens, I am grateful that it goes by so quickly.</p>
<p>And those positive experiences prepared me for experiences like the one that I had with
Fenced Code Blocks this week.  They are frustrating and can make me want to pull my
hair out.  I actually prefer the complex issues over these types of issues.  With those
issues, I can more clearly see the issue by breaking down that complex systems into
simpler systems that can then be analyzed individually.  For the Fenced Code Block
issue, it was just a small nitpicky issue that I had to calmly analyze, looking within a
small and complex set of variables to figure out.</p>
<p>It is at moments like that, when I am faced with tough issues, that I take the time
to step back and try and get a better perspective.  While there are some issues that
are more difficult like the Fenced Code Block issue, the bulk of the issues are
relatively easy to diagnose given the right debug statements.  And fortunately, the
bulk of the project’s design has held up nicely, so only a couple of small redesigns
needed to be done.  All in all, it is not a bad place to be in.  Stepping back and
really appreciating those parts of the project is what I believe keeps me sane.
In the end, the severity of the issues and features evens out, even reducing in scope
the further I get to the end of the project’s first phase.</p>
<p>Looking ahead, I know that I have a good handful of tough issues to deal with.
Knowing that I was still able to keep a good perspective and keep my wits around me,
I have confidence that I will be able to solve those issues.  Some of them may take
an hour to solve, some may take a couple of days to solve, but I will solve them!</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>Not to sound like I am repeating myself, but this part of the project is all about
keeping the momentum going and solving another handful of issues.</p>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Delving%20Into%20the%20Issues%20-%202&url=https%3A//jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/&hashtags=markdown-linter,core-linter" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Delving%20Into%20the%20Issues%20-%202&amp;body=https%3A//jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/10/05/markdown-linter-delving-into-the-issues-2/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-delving-into-the-issues-2"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/09/28/markdown-linter-delving-into-the-issues-1/" title="Previous: Markdown Linter - Delving Into the Issues - 1">Markdown Linter - Delving Into the Issues - 1</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/10/12/markdown-linter-delving-into-the-issues-3/" title="Next: Markdown Linter - Delving Into the Issues - 3">Markdown Linter - Delving Into the Issues - 3</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~17 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-10-05T00:00:00-07:00">Oct 5, 2020</time>
        <h4>Markdown Linter Issues</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2020/09/28/markdown-linter-delving-into-the-issues-1/" title="Markdown Linter - Delving Into the Issues - 1">Part 1: Markdown Linter - Delving Into the Issues - 1</a>
            </li>
            <li  class="active-part">
            Part 2: Markdown Linter - Delving Into the Issues - 2
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/12/markdown-linter-delving-into-the-issues-3/" title="Markdown Linter - Delving Into the Issues - 3">Part 3: Markdown Linter - Delving Into the Issues - 3</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/19/markdown-linter-delving-into-the-issues-4/" title="Markdown Linter - Delving Into the Issues - 4">Part 4: Markdown Linter - Delving Into the Issues - 4</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/10/26/markdown-linter-delving-into-the-issues-5/" title="Markdown Linter - Delving Into the Issues - 5">Part 5: Markdown Linter - Delving Into the Issues - 5</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/02/markdown-linter-delving-into-the-issues-6/" title="Markdown Linter - Delving Into the Issues - 6">Part 6: Markdown Linter - Delving Into the Issues - 6</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/09/markdown-linter-delving-into-the-issues-7/" title="Markdown Linter - Delving Into the Issues - 7">Part 7: Markdown Linter - Delving Into the Issues - 7</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/16/markdown-linter-delving-into-the-issues-8/" title="Markdown Linter - Delving Into the Issues - 8">Part 8: Markdown Linter - Delving Into the Issues - 8</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/23/markdown-linter-delving-into-the-issues-9/" title="Markdown Linter - Delving Into the Issues - 9">Part 9: Markdown Linter - Delving Into the Issues - 9</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/11/30/markdown-linter-delving-into-the-issues-10/" title="Markdown Linter - Delving Into the Issues - 10">Part 10: Markdown Linter - Delving Into the Issues - 10</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/07/markdown-linter-delving-into-the-issues-11/" title="Markdown Linter - Delving Into the Issues - 11">Part 11: Markdown Linter - Delving Into the Issues - 11</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/14/markdown-linter-delving-into-the-issues-12/" title="Markdown Linter - Delving Into the Issues - 12">Part 12: Markdown Linter - Delving Into the Issues - 12</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/21/markdown-linter-delving-into-the-issues-13/" title="Markdown Linter - Delving Into the Issues - 13">Part 13: Markdown Linter - Delving Into the Issues - 13</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/12/28/markdown-linter-delving-into-the-issues-14/" title="Markdown Linter - Delving Into the Issues - 14">Part 14: Markdown Linter - Delving Into the Issues - 14</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/04/markdown-linter-delving-into-the-issues-15/" title="Markdown Linter - Delving Into the Issues - 15">Part 15: Markdown Linter - Delving Into the Issues - 15</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/11/markdown-linter-delving-into-the-issues-16/" title="Markdown Linter - Delving Into the Issues - 16">Part 16: Markdown Linter - Delving Into the Issues - 16</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/18/markdown-linter-delving-into-the-issues-17/" title="Markdown Linter - Delving Into the Issues - 17">Part 17: Markdown Linter - Delving Into the Issues - 17</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/01/25/markdown-linter-delving-into-the-issues-18/" title="Markdown Linter - Delving Into the Issues - 18">Part 18: Markdown Linter - Delving Into the Issues - 18</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2021/02/01/markdown-linter-delving-into-the-issues-19/" title="Markdown Linter - Delving Into the Issues - 19">Part 19: Markdown Linter - Delving Into the Issues - 19</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#core-linter-ref">core linter
                    <span>55</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>73</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2020 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>