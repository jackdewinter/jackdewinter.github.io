<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Jack De Winter" />

        <meta name="description" content="Introduction¶ The end of the main parser is in sight! Two articles ago, the additional of support for inline links was documented, and the last article detailed the addition of support for link reference definitions. In terms of remaining work required to meet the GFM specification, only reference links and …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="markdown linter, linter tokenizer, Software Quality, " />

<meta property="og:title" content="Markdown Linter - Adding Reference Links "/>
<meta property="og:url" content="https://jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/" />
<meta property="og:description" content="Introduction¶ The end of the main parser is in sight! Two articles ago, the additional of support for inline links was documented, and the last article detailed the addition of support for link reference definitions. In terms of remaining work required to meet the GFM specification, only reference links and …" />
<meta property="og:site_name" content="Jack&#39;s Digital Workbench" />
<meta property="og:article:author" content="Jack De Winter" />
<meta property="og:article:published_time" content="2020-04-13T00:00:00-07:00" />
<meta name="twitter:title" content="Markdown Linter - Adding Reference Links ">
<meta name="twitter:description" content="Introduction¶ The end of the main parser is in sight! Two articles ago, the additional of support for inline links was documented, and the last article detailed the addition of support for link reference definitions. In terms of remaining work required to meet the GFM specification, only reference links and …">

        <title>Markdown Linter - Adding Reference Links  · Jack&#39;s Digital Workbench
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://jackdewinter.github.io/theme/css/style.min.css?bec7d543">

        <link href="https://jackdewinter.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack&#39;s Digital Workbench - Full Atom Feed" />


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://jackdewinter.github.io/"><span class=site-name>Jack's Digital Workbench</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://jackdewinter.github.io
                                    >Home</a>
                                </li>
                                <li ><a href="https://jackdewinter.github.io/categories">Categories</a></li>
                                <li ><a href="https://jackdewinter.github.io/tags">Tags</a></li>
                                <li ><a href="https://jackdewinter.github.io/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://jackdewinter.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/">
                Markdown Linter - Adding Reference Links
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-the-audience-for-this-article">What Is the Audience For This Article?</a></li>
<li><a href="#a-quick-aside">A Quick Aside</a></li>
<li><a href="#what-are-shortcut-reference-links">What Are Shortcut Reference Links?</a><ul>
<li><a href="#multiple-references-of-a-link-reference-definition">Multiple References of a Link Reference Definition</a></li>
</ul>
</li>
<li><a href="#what-are-full-reference-links">What Are Full Reference Links?</a></li>
<li><a href="#collapsed-reference-links">Collapsed Reference Links</a></li>
<li><a href="#normalizing-link-labels">Normalizing Link Labels</a></li>
<li><a href="#what-implementation-problems-did-i-have">What Implementation Problems Did I Have?</a></li>
<li><a href="#what-was-my-experience-so-far">What Was My Experience So Far?</a></li>
<li><a href="#what-is-next">What is Next?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>The end of the main parser is in sight!  Two articles ago, the additional
of support for
<a href="https://jackdewinter.github.io/2020/03/30/markdown-linter-adding-inline-links/#why-inline-links">inline links</a>
was documented, and the last article detailed the addition of support for
<a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/#what-are-link-reference-definitions">link reference definitions</a>.
In terms of remaining work required to meet the GFM specification, only reference links
and image links are left.  As image links are just reference links with a slightly
different syntax and slightly different rules, it made sense to focus on reference
links first.</p>
<h2 id="what-is-the-audience-for-this-article">What Is the Audience For This Article?<a class="headerlink" href="#what-is-the-audience-for-this-article" title="Permanent link">¶</a></h2>
<p>While detailed more eloquently in
<a href="https://jackdewinter.github.io/2020/04/05/what-is-the-audience-for-my-blog/#what-is-the-audience-for-my-blog">this article</a>,
my goal for this technical article is to focus on the reasoning behind my solutions,
rather that the solutions themselves.  For a full record of the solutions presented in
this article, please go to this project’s GitHub repository and consult the
commit of
<a href="https://github.com/jackdewinter/pymarkdown/commit/ed20bc4e38342b2c9e3fdebc691e2021c80c67b4">26 March 2020</a>.</p>
<h2 id="a-quick-aside">A Quick Aside<a class="headerlink" href="#a-quick-aside" title="Permanent link">¶</a></h2>
<p>I just wanted to take a moment to give some context on why I am providing many
examples in this article.  If it feels like I am providing a lot of “extra”
examples, that is because I initially had a few issues with the different link
types and their syntax.  For whatever reason, the different link types were just not
“clicking” inside of my head.  It was only after I started focusing equally on the rules
and the examples, that I was able to match the “abstract” text in the specification
with the “concrete” examples provided.  Together they provided the context that I
required to truly understand reference links.</p>
<p>I hope that by providing good examples in this article, I am providing a similar amount
of clarity to help any readers who may encounter similar issues to what I encountered.</p>
<h2 id="what-are-shortcut-reference-links">What Are Shortcut Reference Links?<a class="headerlink" href="#what-are-shortcut-reference-links" title="Permanent link">¶</a></h2>
<p>In the last article on
<a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/#what-are-link-reference-definitions">link reference definitions</a>,
I briefly introduced a concept called a shortcut reference link.  As that article was
focusing on link reference definitions and not reference links, I introduced it only
to show what link reference definitions were capable of
doing.  A good example of this is the following Markdown where the link reference
definition is specified on the first line and the shortcut reference link that utilizes
that definition is specified on the third line:</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="n">link</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="n">uri</span><span class="w"> </span><span class="ss">"title"</span><span class="w"></span>

<span class="o">[</span><span class="n">link</span><span class="o">]</span><span class="w"></span>
</pre></div>
<p>Shortcut reference links like this are the easiest of the three reference link types to
understand as everything is kept simple.  As with all types of reference links,
shortcut reference links are taken care of in the inline processing stage, long after
any link reference definitions have been collected.
To use a link reference definition, the
normalized version of the link label from the shortcut reference link must match a
link label from a previously defined link reference definition.<sup id="fnref:before"><a class="footnote-ref" href="#fn:before">1</a></sup>  To keep
things simple for now, I am going to assign
words like “normalized” to mean a case-insensitive comparison between two strings,
with no other modifications. While this is not completely accurate, it will help keep
things simple for now, and I promise to revisit it before the end of the article.</p>
<p>If the link’s link label matches a link reference definition, the shortcut reference
link uses the link label as the text within the anchor.  In the case of the above
example, this produces the following HTML:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/uri"</span> <span class="na">title</span><span class="o">=</span><span class="s">"title"</span><span class="p">&gt;</span>link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>When this HTML was generated, the text <code>link</code> was used from the shortcut reference link
and the rest of the anchor tag (the text between <code>&lt;a</code> and
<code>&lt;/a&gt;</code> excluding the text <code>link</code>) was composed using information from the link
reference definition.  The benefit of this approach is that the “marker” for the link
is inline with the rest of the text while the bulkier link data is located
elsewhere in the document.   This benefit allows the author to better control their own
authoring experience by controlling where the link reference definitions occur in their
document: after the paragraph containing the link, at the end of the section, or at the
end of the document.</p>
<p>Without exploring the normalization of link labels (yet!), each link label is parsed
to render inline processing for the link label.  A good instance of this is
<a href="https://github.github.com/gfm/#example-566">example 566</a>
from the GFM specification which adds inline emphasis to the link label:</p>
<div class="highlight"><pre><span></span><span class="k">[*foo* bar]</span>

<span class="na">[*foo* bar]: /url "title"</span>
</pre></div>
<p>and is rendered as:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/url"</span> <span class="na">title</span><span class="o">=</span><span class="s">"title"</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span> bar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>The key is that if the normalized link label of both the shortcut reference
link and the link reference definition match, everything works fine.  If the link
label does not match, the text is simply rendered as normal text:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[<span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span> bar]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>Other than that, the only other special thing is that the link label for a shortcut
reference link cannot contain another link.  This is explicitly stated in the
definition of <a href="https://github.github.com/gfm/#link-text">link text</a> which states:</p>
<blockquote>
<p>Links may not contain other links, at any level of nesting. If multiple otherwise valid link definitions appear nested inside each other, the inner-most definition is used.</p>
</blockquote>
<p>A good example of this is obtained when the following Markdown text is fed through a
GFM compliant parser:</p>
<div class="highlight"><pre><span></span><span class="k">[foo[foo]]</span>

<span class="na">[foo]: /url "title"</span>
</pre></div>
<p>generating the following HTML:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[foo<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/url"</span> <span class="na">title</span><span class="o">=</span><span class="s">"title"</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>Looking at the HTML, the inner shortcut reference link <code>[foo]</code> was interpreted and the
outer link <code>[foo[foo]]</code> was deemed invalid, therefore being rendered normally.</p>
<h3 id="multiple-references-of-a-link-reference-definition">Multiple References of a Link Reference Definition<a class="headerlink" href="#multiple-references-of-a-link-reference-definition" title="Permanent link">¶</a></h3>
<p>In the
<a href="https://github.github.com/gfm">GFM specification</a> there are instructions and examples
on what to do if there are multiple link reference definitions declared with the same
normalized link label.  However, after a couple of passes through the GFM specification,
I was unable to find any guidance on what to do if there are multiple reference links
that use a given link reference definition.  The closest that the specification gets to
this is near the start of the section on
<a href="https://github.github.com/gfm/#full-reference-link">full reference links</a>
(covered in the next section) which states:</p>
<blockquote>
<p>followed by a link label that matches a link reference definition elsewhere in the document.</p>
</blockquote>
<p>Based on this information, along with testing against the CommonMark reference parser,
I can safely state that the following example:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="o">*</span><span class="n">foo</span><span class="o">*</span> <span class="n">bar</span><span class="p">]</span> <span class="err">\</span>
<span class="p">[</span><span class="o">*</span><span class="n">foo</span><span class="o">*</span> <span class="n">bar</span><span class="p">]</span>

<span class="p">[</span><span class="o">*</span><span class="n">foo</span><span class="o">*</span> <span class="n">bar</span><span class="p">]:</span> <span class="o">/</span><span class="n">url</span> <span class="ss">"title"</span>
</pre></div>
<p>generates the following HTML:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/url"</span> <span class="na">title</span><span class="o">=</span><span class="s">"title"</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span> bar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/url"</span> <span class="na">title</span><span class="o">=</span><span class="s">"title"</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>foo<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span> bar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>Based on this information and the quote above, I feel that this is a good feature of
Markdown.  In certain cases where a link is used repeatedly, this behavior can be used
to have a single link reference definition to provide the link itself, and multiple
reference links pointed to that one definition.  In my mind, that is where full
reference links come in.</p>
<h2 id="what-are-full-reference-links">What Are Full Reference Links?<a class="headerlink" href="#what-are-full-reference-links" title="Permanent link">¶</a></h2>
<p>In
<a href="https://daringfireball.net/projects/markdown/syntax#link">John Gruber’s original specification</a>,
there were no shortcut links and full reference links were referred
to as “reference-style links”.  It was only with later parsers that the more compact
shortcut reference link was introduced.  In my mind, instead of the order in which
reference links were historically introduced, I prefer to see the hierarchy of
reference links in reverse chronological order, with the shortcut reference links first
and the full reference links second.</p>
<p>My reasoning for this is as follows.  Based purely on efficiency, I typically start
with the clearest construct that has the least amount of effort to add. With reference
links, my first instinct is to add a shortcut reference link with the
link label matching the link reference definition that I need to add to complete it.
In 95% of the cases that I come across, I need a single link reference definition and a
single reference link, so a shortcut reference link is the best option.  For the
remaining 5%, I usually have a case where I have multiple reference links referencing a
single link reference definition, and I need a reference link that I can use there to
good effect.</p>
<p>Consider the following example:</p>
<div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">is</span> <span class="n">a</span> <span class="n">sentence</span> <span class="n">that</span> <span class="n">refers</span> <span class="n">to</span> <span class="p">[</span><span class="n">my</span> <span class="n">link</span><span class="p">].</span>

<span class="n">Then</span><span class="p">,</span> <span class="k">in</span> <span class="n">a</span> <span class="n">separate</span> <span class="n">paragraph</span><span class="p">,</span> <span class="n">I</span> <span class="n">must</span> <span class="n">still</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">it</span> <span class="n">as</span> <span class="p">[</span><span class="n">my</span> <span class="n">link</span><span class="p">].</span>
</pre></div>
<p>When coming up with this example, I needed to take care to create my example second
paragraph in a way that <code>[my link]</code> would fit somewhat fluidly in the sentence.
It would be more useful to do the following:</p>
<div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">is</span> <span class="n">a</span> <span class="n">sentence</span> <span class="n">that</span> <span class="n">refers</span> <span class="n">to</span> <span class="p">[</span><span class="n">my</span> <span class="n">link</span><span class="p">].</span>

<span class="n">Then</span><span class="p">,</span> <span class="k">in</span> <span class="n">a</span> <span class="n">separate</span> <span class="n">paragraph</span><span class="p">,</span> <span class="n">I</span> <span class="n">can</span> <span class="n">then</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">it</span> <span class="n">as</span> <span class="p">[</span><span class="n">my</span> <span class="n">other</span> <span class="n">link</span><span class="p">][</span><span class="n">my</span> <span class="n">link</span><span class="p">].</span>
</pre></div>
<p>For me, that is where the benefit of full reference links come in.</p>
<p>As I alluded to
in the previous example, full reference links are of the form:</p>
<div class="highlight"><pre><span></span><span class="k">[text][link]</span>

<span class="na">[link]: /url "title"</span>
</pre></div>
<p>Where the first set of square brackets encloses link text and the second set of brackets
encloses the link label.  Unlike the shortcut reference link, where the link label
serves as both the text to match and the text around which to link, a full reference
link assigns a block of text to each of those responsibilities.  This allows a single
link reference definition to be referred to by multiple reference links, each one
having tailored link text.</p>
<p>The link text is defined in a manner very similar to link labels, including the
limitation that link text cannot include other links, demonstrated by the
<a href="https://github.github.com/gfm/#example-541">example 541</a>:</p>
<div class="highlight"><pre><span></span><span class="k">[foo *bar [baz][ref]*][ref]</span>

<span class="na">[ref]: /uri</span>
</pre></div>
<p>which generates the following HTML:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[foo <span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>bar <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/uri"</span><span class="p">&gt;</span>baz<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>]<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"/uri"</span><span class="p">&gt;</span>ref<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<p>Similar to how the link-within-a-possible-link example was handled for shortcut
reference links, the inner reference link text <code>[baz][ref]</code> is interpreted as a valid
link, with the rest of the possible-link’s link text being presented as plain text.
It is simply an act of serendipity that both the inner link and outer possible-link
used the link label <code>[ref]</code>.  Because of this act of serendipity, when the inline
processor gets to the <code>[ref]</code> text at the end of the line, it is interpreted as a
shortcut reference
link, in a separate context from the previous link.  As such, a second
link to the same URI is generated at the end of the HTML paragraph.</p>
<p>While I found it easier to visually see the how the above example should be parsed by
working through it in my head, it was examples of this flavor that I really struggled
with before I combined looking at rule with looking at examples, as detailed above.
To be honest, to properly figure these out, I used a pencil and a sheet of paper to
visually break down the problem.  Only when I had those scribbled notes in front of me
did I really get this example.  Perhaps it is only me, but it was by literally working
through the example and showing my work that I was able to really understand what
the parser needed to do.  After that, coding the parser to do it was simple.  As
I have mentioned a few times, figure out whatever works for you, and leverage
that.</p>
<h2 id="collapsed-reference-links">Collapsed Reference Links<a class="headerlink" href="#collapsed-reference-links" title="Permanent link">¶</a></h2>
<p>While the inclusion of collapsed link references into the specification may seem like
an unnecessary element, it is an alternative that offers the author leeway on how
their Markdown article is constructed.  For some authors, the full reference link of
<code>[label][label]</code> might be preferred.  For other authors, the shortcut reference link of
<code>[label]</code> might be preferred.  If the author is looking for something in between, the
collapsed reference link and it’s format of <code>[label][]</code> offers a middle ground.  All
three of the examples provided in this paragraph are semantically equal and will produce
the exacts same HTML.</p>
<p>In the end, it is just a matter of preference which of the reference link formats
that the author prefers and is comfortable with.</p>
<h2 id="normalizing-link-labels">Normalizing Link Labels<a class="headerlink" href="#normalizing-link-labels" title="Permanent link">¶</a></h2>
<p>Back in the section on
<a href="https://jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/#what-are-shortcut-reference-links">What Are Shortcut Reference Links?</a>,
I simplified
the term “normalized” to mean <code>case-insensitive comparison</code>.  The full definition of
<a href="https://github.github.com/gfm/#matches">normalized</a>
is a bit more complicated, but not by much.  In order of operation:</p>
<ul>
<li>grab the link text in its unprocessed form</li>
<li>remove the opening and closing brackets from the link label</li>
<li>perform a Unicode case fold (the Unicode equivalent of reducing all letters to lower case)</li>
<li>strip leading and trailing whitespace</li>
<li>collapse consecutive internal whitespace to a single space</li>
</ul>
<p>Once these steps have been applied to the link label’s text, it is that text that is
used to determine if it matches an existing link reference definition.  In cases where
the link label is <code>[foo]</code> or <code>[referenced document]</code>, this process may seem weird or
superfluous.  But, in the case of
<a href="https://github.github.com/gfm/#example-553">example 553</a>:</p>
<div class="highlight"><pre><span></span><span class="k">[bar][foo\!]</span>

<span class="na">[foo!]: /url</span>
</pre></div>
<p>the parsed inline text is equivalent, but the link is not interpreted as a full
reference link.  This is because the normalized text for the reference link is <code>foo\!</code>
while the normalized text for the link reference definition is
<code>foo!</code>.  While both of these strings will be equivalent to <code>foo!</code> after applying inline
parsing, their normalized values do not match, and as such, the above example is
rendered in HTML as:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[bar][foo!]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
<h2 id="what-implementation-problems-did-i-have">What Implementation Problems Did I Have?<a class="headerlink" href="#what-implementation-problems-did-i-have" title="Permanent link">¶</a></h2>
<p>Between the work previously done for
<a href="https://jackdewinter.github.io/2020/03/30/markdown-linter-adding-inline-links/#why-inline-links">inline links</a>
and
<a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/#what-are-link-reference-definitions">link reference definitions</a>,
most of the required foundation work was already in place when I started with
reference links.  As I required a simple implementation of shortcut reference
links to properly test link reference definitions, it was only the introduction of
link text for full reference links that required any real block of new code.</p>
<p>Even given that solid, tested foundation, there were two issues that gave me troubles
as I implemented reference links: using the correct text to determine matching and the
order of precedence between different types of reference links.</p>
<p>Adding the parsing for shortcut reference links as part of the work for link
reference definitions, I naturally did the bare minimum required to get it working.  For
the link label matching algorithm, it was a simple <code>a == b</code> comparison which worked
nicely for all the link reference definition examples except two.  To get it working
with those two examples, both dealing with case insensitivity, I changed the
comparison to <code>a.lower() == b.lower()</code> and then both examples parsed correctly.</p>
<p>When I reached the reference link examples that dealt with link label matching,
things got a bit more tricky, but not too tricky.  Use <code>.casefold()</code> instead of
<code>.lower()</code>? No problem.  Stripping various forms of whitespace from the link label?
No problem.  Using the right text as a basis for those transformations?  That took a
bit of work.</p>
<p>Given that link processing is handled in the inline processing phase, the easiest
solution was to add parallel text handling.  My thinking was that since the inline
processing is constrained to a single continuous grouping of text, I just needed
something simple that would only exist for the lifetime of that grouping.  To accomplish
this, I used the variable <code>current_string_unresolved</code> to keep track of a raw,
unresolved version of the string that was being processed in the variable
<code>current_string</code>.</p>
<p>While that
might seem a bit of a kludge<sup id="fnref:kludge"><a class="footnote-ref" href="#fn:kludge">2</a></sup>, for me it was a simple solution that was
contained to the area most affected by the issue.  The other option, using an
unresolved stream and then resolving it later, seemed to have too many
issues to deal with in a manner that I was sure was going to cover all the edge
cases.  I know this because I tried that first (and second and third), before sitting
back and rethinking what the best approach would be from a high level. After three
attempts with the unresolved stream and no success, the kludge solution worked on the
first try with no issues.  Guess it really was not a kludge!</p>
<p>Having found a decent solution for using the right text to match against, the only
issue I had left to deal with was in dealing with the order of precedence of reference
links with themselves and other elements.  Detailed in the examples between
<a href="https://github.github.com/gfm/#example-572">example 572</a> and
<a href="https://github.github.com/gfm/#example-579">example 579</a>, these examples give very
specific guidance on the precedence to use for each combination.  While the examples
provided good guidance, the implementation was not always so easy to get right.</p>
<p>While getting the order in which to check for
the various types of reference links took a bit, it was complicated by the determination
of whether a given reference link referenced a valid link reference definition.
Out of the 4 days it took for me to complete reference links, one of those days was
spent just going over all of the combinations, making sure that the specification
detailed them (it did!), and then checking and rechecking each modification that made
another of the above examples work.  It was only then that I staged my changes and moved
on to the next example.  In the end, it was very tedious work, but it was worthwhile
because it worked.</p>
<h2 id="what-was-my-experience-so-far">What Was My Experience So Far?<a class="headerlink" href="#what-was-my-experience-so-far" title="Permanent link">¶</a></h2>
<p>For the most part, the implementation of the reference links was a good experience,
combining a bit of “reuse foundation” work with some “how do I get this to work
properly” challenges.  There was just one dark sport on the implementation of the
feature.</p>
<p>I have already mentioned my issues with understanding the link specification in the
above sections, but I feel the topic is important enough topic to warrant more
discussion.  Unlike before where I was
<a href="https://jackdewinter.github.io/2020/03/30/markdown-linter-adding-inline-links/#what-was-my-experience-so-far">skipping parts</a>
of the specification, this challenge was a genuine case of me reading the specification
and not getting a good understanding of it.  Even with the provided examples, there
were still times where I was unable to comprehend what the specification was doing.  It
was only after going “old school” and getting out a pencil and some paper did I work
through it.</p>
<p>At one point, I remember thinking to myself:</p>
<blockquote>
<p>Writing parsers for 30 years and you still need a pencil and paper?</p>
</blockquote>
<p>It was not one of the brightest moments of the project, but it did happen. It
was after what I think was the 7th or 8th time of me trying to
understand the preventing the link within a link logic detailed in the section on
<a href="https://jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/#what-are-full-reference-links">reference links</a>.
Honestly, I am guessing it was the 7th or 8th time, I lost count of the number
of attempts. For whatever reason, it just was not clicking for
me.  It is times like those that I like to break a problem down to smaller components,
what I refer to the “boulders to pebbles” approach.  And for some reason, I needed to
break those pebbles down even smaller, and I was very hard on myself for it.</p>
<p>No matter who you are, you are going to have good days, bad days, and a lot of in
between days.  The more that you take care of yourself, the better your chance of
being on the positive end of that spectrum.  I did not need a pencil and paper because
I wasn’t capable of figuring out the problem myself, I needed them as a tool to
help me figure it out myself on that day.  I now look back at the problem and my
scribbles and have the mental capacity to understand it was just a bad day.  And
even if I am being more charitable about the day than it really was.  So what?
I used the tools that I needed to in order to solve the problem I faced.  Simple as
that.</p>
<p>I started this project with a need and a desire to learn.  I completed this feature
learning that I still have what it takes to solve the issues that I need to.  I also
learned that I need to focus a bit more on taking better care of myself and nudging
myself towards the positive end of that spectrum.  Guess what? I stumble, I learn,
and I get up and try and not do the same thing again.  Well… not too often at least.</p>
<h2 id="what-is-next">What is Next?<a class="headerlink" href="#what-is-next" title="Permanent link">¶</a></h2>
<p>While I know there is some “optional” stuff I need to add to the parser before I
can use it on my own website, there is only one more feature that I need to complete
before the parser is complete and GFM compliant.  With a bit of a mental drum roll…
image links are next!</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:before">
<p>As link reference definitions are parsed with the leaf blocks, and reference links are parsed later with inline processing, the term “previously defined” refers to any definition in the Markdown document that was parsed, and not “previously defined” with respect to the relative locations of the reference links and the definition within the Markdown document. <a class="footnote-backref" href="#fnref:before" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:kludge">
<p>According to Merriam-Webster: “a haphazard or makeshift solution to a problem and especially to a computer or programming problem” <a class="footnote-backref" href="#fnref:kludge" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
</ol>
</div>


             
 
                <p id="post-share-links">
    Like this post? Share on:
    <a href="https://twitter.com/intent/tweet?text=Markdown%20Linter%20-%20Adding%20Reference%20Links&url=https%3A//jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/&hashtags=markdown-linter,linter-tokenizer" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
    ❄
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
    ❄
    <a href="mailto:?subject=Markdown%20Linter%20-%20Adding%20Reference%20Links&amp;body=https%3A//jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>
    </p>

            
            






<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   href="https://jackdewinter.github.io/2020/04/13/markdown-linter-adding-reference-links/#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">

                        <script src="https://utteranc.es/client.js"
        data-repo="jackdewinter/jackdewinter.github.io"
        data-issue-term="markdown-linter-adding-reference-links"
        data-label="Comments"
        data-theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/" title="Previous: Markdown Linter - Adding Link Reference Definitions">Markdown Linter - Adding Link Reference Definitions</a></li>
                <li class="next-article"><a href="https://jackdewinter.github.io/2020/04/20/markdown-linter-adding-image-links-and-simple-cleanup/" title="Next: Markdown Linter - Adding Image Links and Simple Cleanup">Markdown Linter - Adding Image Links and Simple Cleanup</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
    <h4>Reading Time</h4>
    <p>~14 min read</p>
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-04-13T00:00:00-07:00">Apr 13, 2020</time>
        <h4>Markdown Linter</h4>
    <ul class="multi-parts-list">
            <li >
            <a href="https://jackdewinter.github.io/2019/12/08/markdown-linter-collecting-requirements/" title="Markdown Linter - Collecting Requirements">Part 1: Markdown Linter - Collecting Requirements</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2019/12/16/markdown-linter-setting-up-parser-tests/" title="Markdown Linter - Setting Up Parser Tests">Part 2: Markdown Linter - Setting Up Parser Tests</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2019/12/22/markdown-linter-parser-testing-strategy/" title="Markdown Linter - Parser Testing Strategy">Part 3: Markdown Linter - Parser Testing Strategy</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/01/27/markdown-linter-parsing-normal-markdown-blocks/" title="Markdown Linter - Parsing Normal Markdown Blocks">Part 4: Markdown Linter - Parsing Normal Markdown Blocks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/02/03/markdown-linter-adding-block-quotes-and-lists/" title="Markdown Linter - Adding Block Quotes and Lists">Part 5: Markdown Linter - Adding Block Quotes and Lists</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/02/10/markdown-linter-adding-html-blocks/" title="Markdown Linter - Adding HTML Blocks">Part 6: Markdown Linter - Adding HTML Blocks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/02/17/markdown-linter-taking-time-to-refactor-post-block-implementation/" title="Markdown Linter - Taking Time to Refactor -- Post-Block Implementation">Part 7: Markdown Linter - Taking Time to Refactor -- Post-Block Implementation</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/02/24/markdown-linter-starting-inline-processing/" title="Markdown Linter - Starting Inline Processing">Part 8: Markdown Linter - Starting Inline Processing</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/03/02/markdown-linter-taking-time-to-refactor-post-easy-inlines/" title="Markdown Linter - Taking Time to Refactor -- Post-Easy Inlines">Part 9: Markdown Linter - Taking Time to Refactor -- Post-Easy Inlines</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/03/09/markdown-linter-autolinks-raw-html-and-line-breaks/" title="Markdown Linter - Autolinks, Raw HTML, and Line Breaks">Part 10: Markdown Linter - Autolinks, Raw HTML, and Line Breaks</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/03/16/markdown-linter-verifying-base-scenarios/" title="Markdown Linter - Verifying Base Scenarios">Part 11: Markdown Linter - Verifying Base Scenarios</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/03/23/markdown-linter-adding-inline-emphasis/" title="Markdown Linter - Adding Inline Emphasis">Part 12: Markdown Linter - Adding Inline Emphasis</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/03/30/markdown-linter-adding-inline-links/" title="Markdown Linter - Adding Inline Links">Part 13: Markdown Linter - Adding Inline Links</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/04/06/markdown-linter-adding-link-reference-definitions/" title="Markdown Linter - Adding Link Reference Definitions">Part 14: Markdown Linter - Adding Link Reference Definitions</a>
            </li>
            <li  class="active-part">
            Part 15: Markdown Linter - Adding Reference Links
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/04/20/markdown-linter-adding-image-links-and-simple-cleanup/" title="Markdown Linter - Adding Image Links and Simple Cleanup">Part 16: Markdown Linter - Adding Image Links and Simple Cleanup</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/04/27/markdown-linter-reducing-the-parsers-technical-debt/" title="Markdown Linter - Reducing the Parser's Technical Debt">Part 17: Markdown Linter - Reducing the Parser's Technical Debt</a>
            </li>
            <li >
            <a href="https://jackdewinter.github.io/2020/05/03/markdown-linter-splitting-up-the-articles/" title="Markdown Linter - Splitting Up The Articles">Part 18: Markdown Linter - Splitting Up The Articles</a>
            </li>
    </ul>
            <h4>Category</h4>
            <a class="category-link" href="https://jackdewinter.github.io/categories#software-quality-ref">Software Quality</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://jackdewinter.github.io/tags#linter-tokenizer-ref">linter tokenizer
                    <span>14</span>
</a></li>
                <li><a href="https://jackdewinter.github.io/tags#markdown-linter-ref">markdown linter
                    <span>97</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/jackdewinter" title="github-alt" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.linkedin.com/in/jackdewinter/" title="linkedin" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://jackdewinter.github.io/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        
&copy; Copyright 2021 by Jack De Winter and licensed under a <a rel="license"
  href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
  Creative Commons Attribution 4.0 International License</a>.

    </div>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>